{
  "version": 3,
  "sources": ["../../blakejs/util.js", "../../blakejs/blake2b.js", "../../blakejs/blake2s.js", "../../blakejs/index.js", "../../@segment/analytics-next/src/core/arguments-resolver/index.ts", "../../@segment/analytics-page-tools/dist/esm/index.mjs", "../../@segment/analytics-next/src/lib/pick.ts", "../../@segment/analytics-next/src/core/page/add-page-context.ts", "../../@segment/analytics-next/src/core/events/index.ts", "../../@segment/analytics-next/src/core/plugin/index.ts", "../../@segment/analytics-next/src/core/queue/event-queue.ts", "../../@segment/analytics-next/src/lib/bind-all.ts", "../../js-cookie/dist/js.cookie.mjs", "../../@segment/analytics-next/src/core/user/tld.ts", "../../@segment/analytics-next/src/core/storage/cookieStorage.ts", "../../@segment/analytics-next/src/core/storage/localStorage.ts", "../../@segment/analytics-next/src/core/storage/memoryStorage.ts", "../../@segment/analytics-next/src/core/storage/types.ts", "../../@segment/analytics-next/src/core/storage/settings.ts", "../../@segment/analytics-next/src/core/storage/universalStorage.ts", "../../@segment/analytics-next/src/core/storage/index.ts", "../../@segment/analytics-next/src/core/user/index.ts", "../../@segment/analytics-next/src/lib/is-thenable.ts", "../../@segment/analytics-next/src/core/buffer/index.ts", "../../@segment/analytics-next/src/lib/on-page-change.ts", "../../@segment/analytics-next/src/plugins/segmentio/ratelimit-error.ts", "../../@segment/analytics-next/src/plugins/segmentio/shared-dispatcher.ts", "../../@segment/analytics-next/src/plugins/segmentio/batched-dispatcher.ts", "../../@segment/analytics-next/src/plugins/segmentio/fetch-dispatcher.ts", "../../@segment/analytics-next/src/plugins/segmentio/normalize.ts", "../../@segment/analytics-next/src/plugins/segmentio/schedule-flush.ts", "../../@segment/analytics-next/src/plugins/segmentio/index.ts", "../../@segment/analytics-next/src/core/analytics/index.ts", "../../@segment/analytics-next/src/lib/get-process-env.ts", "../../@segment/analytics-next/src/lib/client-hints/index.ts", "../../@segment/analytics-next/src/plugins/env-enrichment/index.ts", "../../@segment/analytics-next/src/plugins/remote-loader/index.ts", "../../@segment/analytics-next/src/core/inspector/index.ts", "../../@segment/analytics-next/src/browser/index.ts", "../../@segment/analytics-next/src/node/node.browser.ts", "../../@web3auth/no-modal/dist/lib.esm/base/analytics.js", "../../@web3auth/no-modal/dist/lib.esm/connectors/utils.js", "../../@web3auth/no-modal/dist/lib.esm/connectors/wallet-connect-v2-connector/config.js", "../../@web3auth/no-modal/dist/lib.esm/providers/ethereum-provider/rpc/walletMidddleware.js", "../../@web3auth/no-modal/dist/lib.esm/providers/ethereum-provider/rpc/ethRpcMiddlewares.js", "../../@web3auth/no-modal/dist/lib.esm/providers/ethereum-provider/rpc/jrpcClient.js", "../../@msgpack/msgpack/src/utils/utf8.ts", "../../@msgpack/msgpack/src/ExtData.ts", "../../@msgpack/msgpack/src/DecodeError.ts", "../../@msgpack/msgpack/src/utils/int.ts", "../../@msgpack/msgpack/src/timestamp.ts", "../../@msgpack/msgpack/src/ExtensionCodec.ts", "../../@msgpack/msgpack/src/utils/typedArrays.ts", "../../@msgpack/msgpack/src/Encoder.ts", "../../@msgpack/msgpack/src/encode.ts", "../../@msgpack/msgpack/src/utils/prettyByte.ts", "../../@msgpack/msgpack/src/CachedKeyDecoder.ts", "../../@msgpack/msgpack/src/Decoder.ts", "../../@msgpack/msgpack/src/decode.ts", "../../@web3auth/no-modal/node_modules/uint8arrays/esm/src/util/as-uint8array.js", "../../@web3auth/no-modal/node_modules/uint8arrays/esm/src/alloc.js", "../../@web3auth/no-modal/node_modules/uint8arrays/esm/src/concat.js", "../../@web3auth/no-modal/node_modules/uint8arrays/esm/src/util/bases.js", "../../@web3auth/no-modal/node_modules/uint8arrays/esm/src/from-string.js", "../../@web3auth/no-modal/node_modules/uint8arrays/esm/src/to-string.js", "../../@web3auth/no-modal/dist/lib.esm/connectors/wallet-connect-v2-connector/walletConnectV2Utils.js", "../../@web3auth/no-modal/dist/lib.esm/connectors/wallet-connect-v2-connector/WalletConnectV2Provider.js", "../../@web3auth/no-modal/dist/lib.esm/connectors/wallet-connect-v2-connector/walletConnectV2Connector.js"],
  "sourcesContent": ["const ERROR_MSG_INPUT = 'Input must be an string, Buffer or Uint8Array'\n\n// For convenience, let people hash a string, not just a Uint8Array\nfunction normalizeInput (input) {\n  let ret\n  if (input instanceof Uint8Array) {\n    ret = input\n  } else if (typeof input === 'string') {\n    const encoder = new TextEncoder()\n    ret = encoder.encode(input)\n  } else {\n    throw new Error(ERROR_MSG_INPUT)\n  }\n  return ret\n}\n\n// Converts a Uint8Array to a hexadecimal string\n// For example, toHex([255, 0, 255]) returns \"ff00ff\"\nfunction toHex (bytes) {\n  return Array.prototype.map\n    .call(bytes, function (n) {\n      return (n < 16 ? '0' : '') + n.toString(16)\n    })\n    .join('')\n}\n\n// Converts any value in [0...2^32-1] to an 8-character hex string\nfunction uint32ToHex (val) {\n  return (0x100000000 + val).toString(16).substring(1)\n}\n\n// For debugging: prints out hash state in the same format as the RFC\n// sample computation exactly, so that you can diff\nfunction debugPrint (label, arr, size) {\n  let msg = '\\n' + label + ' = '\n  for (let i = 0; i < arr.length; i += 2) {\n    if (size === 32) {\n      msg += uint32ToHex(arr[i]).toUpperCase()\n      msg += ' '\n      msg += uint32ToHex(arr[i + 1]).toUpperCase()\n    } else if (size === 64) {\n      msg += uint32ToHex(arr[i + 1]).toUpperCase()\n      msg += uint32ToHex(arr[i]).toUpperCase()\n    } else throw new Error('Invalid size ' + size)\n    if (i % 6 === 4) {\n      msg += '\\n' + new Array(label.length + 4).join(' ')\n    } else if (i < arr.length - 2) {\n      msg += ' '\n    }\n  }\n  console.log(msg)\n}\n\n// For performance testing: generates N bytes of input, hashes M times\n// Measures and prints MB/second hash performance each time\nfunction testSpeed (hashFn, N, M) {\n  let startMs = new Date().getTime()\n\n  const input = new Uint8Array(N)\n  for (let i = 0; i < N; i++) {\n    input[i] = i % 256\n  }\n  const genMs = new Date().getTime()\n  console.log('Generated random input in ' + (genMs - startMs) + 'ms')\n  startMs = genMs\n\n  for (let i = 0; i < M; i++) {\n    const hashHex = hashFn(input)\n    const hashMs = new Date().getTime()\n    const ms = hashMs - startMs\n    startMs = hashMs\n    console.log('Hashed in ' + ms + 'ms: ' + hashHex.substring(0, 20) + '...')\n    console.log(\n      Math.round((N / (1 << 20) / (ms / 1000)) * 100) / 100 + ' MB PER SECOND'\n    )\n  }\n}\n\nmodule.exports = {\n  normalizeInput: normalizeInput,\n  toHex: toHex,\n  debugPrint: debugPrint,\n  testSpeed: testSpeed\n}\n", "// Blake2B in pure Javascript\n// Adapted from the reference implementation in RFC7693\n// Ported to Javascript by DC - https://github.com/dcposch\n\nconst util = require('./util')\n\n// 64-bit unsigned addition\n// Sets v[a,a+1] += v[b,b+1]\n// v should be a Uint32Array\nfunction ADD64AA (v, a, b) {\n  const o0 = v[a] + v[b]\n  let o1 = v[a + 1] + v[b + 1]\n  if (o0 >= 0x100000000) {\n    o1++\n  }\n  v[a] = o0\n  v[a + 1] = o1\n}\n\n// 64-bit unsigned addition\n// Sets v[a,a+1] += b\n// b0 is the low 32 bits of b, b1 represents the high 32 bits\nfunction ADD64AC (v, a, b0, b1) {\n  let o0 = v[a] + b0\n  if (b0 < 0) {\n    o0 += 0x100000000\n  }\n  let o1 = v[a + 1] + b1\n  if (o0 >= 0x100000000) {\n    o1++\n  }\n  v[a] = o0\n  v[a + 1] = o1\n}\n\n// Little-endian byte access\nfunction B2B_GET32 (arr, i) {\n  return arr[i] ^ (arr[i + 1] << 8) ^ (arr[i + 2] << 16) ^ (arr[i + 3] << 24)\n}\n\n// G Mixing function\n// The ROTRs are inlined for speed\nfunction B2B_G (a, b, c, d, ix, iy) {\n  const x0 = m[ix]\n  const x1 = m[ix + 1]\n  const y0 = m[iy]\n  const y1 = m[iy + 1]\n\n  ADD64AA(v, a, b) // v[a,a+1] += v[b,b+1] ... in JS we must store a uint64 as two uint32s\n  ADD64AC(v, a, x0, x1) // v[a, a+1] += x ... x0 is the low 32 bits of x, x1 is the high 32 bits\n\n  // v[d,d+1] = (v[d,d+1] xor v[a,a+1]) rotated to the right by 32 bits\n  let xor0 = v[d] ^ v[a]\n  let xor1 = v[d + 1] ^ v[a + 1]\n  v[d] = xor1\n  v[d + 1] = xor0\n\n  ADD64AA(v, c, d)\n\n  // v[b,b+1] = (v[b,b+1] xor v[c,c+1]) rotated right by 24 bits\n  xor0 = v[b] ^ v[c]\n  xor1 = v[b + 1] ^ v[c + 1]\n  v[b] = (xor0 >>> 24) ^ (xor1 << 8)\n  v[b + 1] = (xor1 >>> 24) ^ (xor0 << 8)\n\n  ADD64AA(v, a, b)\n  ADD64AC(v, a, y0, y1)\n\n  // v[d,d+1] = (v[d,d+1] xor v[a,a+1]) rotated right by 16 bits\n  xor0 = v[d] ^ v[a]\n  xor1 = v[d + 1] ^ v[a + 1]\n  v[d] = (xor0 >>> 16) ^ (xor1 << 16)\n  v[d + 1] = (xor1 >>> 16) ^ (xor0 << 16)\n\n  ADD64AA(v, c, d)\n\n  // v[b,b+1] = (v[b,b+1] xor v[c,c+1]) rotated right by 63 bits\n  xor0 = v[b] ^ v[c]\n  xor1 = v[b + 1] ^ v[c + 1]\n  v[b] = (xor1 >>> 31) ^ (xor0 << 1)\n  v[b + 1] = (xor0 >>> 31) ^ (xor1 << 1)\n}\n\n// Initialization Vector\nconst BLAKE2B_IV32 = new Uint32Array([\n  0xf3bcc908, 0x6a09e667, 0x84caa73b, 0xbb67ae85, 0xfe94f82b, 0x3c6ef372,\n  0x5f1d36f1, 0xa54ff53a, 0xade682d1, 0x510e527f, 0x2b3e6c1f, 0x9b05688c,\n  0xfb41bd6b, 0x1f83d9ab, 0x137e2179, 0x5be0cd19\n])\n\nconst SIGMA8 = [\n  0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 14, 10, 4, 8, 9, 15, 13,\n  6, 1, 12, 0, 2, 11, 7, 5, 3, 11, 8, 12, 0, 5, 2, 15, 13, 10, 14, 3, 6, 7, 1,\n  9, 4, 7, 9, 3, 1, 13, 12, 11, 14, 2, 6, 5, 10, 4, 0, 15, 8, 9, 0, 5, 7, 2, 4,\n  10, 15, 14, 1, 11, 12, 6, 8, 3, 13, 2, 12, 6, 10, 0, 11, 8, 3, 4, 13, 7, 5,\n  15, 14, 1, 9, 12, 5, 1, 15, 14, 13, 4, 10, 0, 7, 6, 3, 9, 2, 8, 11, 13, 11, 7,\n  14, 12, 1, 3, 9, 5, 0, 15, 4, 8, 6, 2, 10, 6, 15, 14, 9, 11, 3, 0, 8, 12, 2,\n  13, 7, 1, 4, 10, 5, 10, 2, 8, 4, 7, 6, 1, 5, 15, 11, 9, 14, 3, 12, 13, 0, 0,\n  1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 14, 10, 4, 8, 9, 15, 13, 6,\n  1, 12, 0, 2, 11, 7, 5, 3\n]\n\n// These are offsets into a uint64 buffer.\n// Multiply them all by 2 to make them offsets into a uint32 buffer,\n// because this is Javascript and we don't have uint64s\nconst SIGMA82 = new Uint8Array(\n  SIGMA8.map(function (x) {\n    return x * 2\n  })\n)\n\n// Compression function. 'last' flag indicates last block.\n// Note we're representing 16 uint64s as 32 uint32s\nconst v = new Uint32Array(32)\nconst m = new Uint32Array(32)\nfunction blake2bCompress (ctx, last) {\n  let i = 0\n\n  // init work variables\n  for (i = 0; i < 16; i++) {\n    v[i] = ctx.h[i]\n    v[i + 16] = BLAKE2B_IV32[i]\n  }\n\n  // low 64 bits of offset\n  v[24] = v[24] ^ ctx.t\n  v[25] = v[25] ^ (ctx.t / 0x100000000)\n  // high 64 bits not supported, offset may not be higher than 2**53-1\n\n  // last block flag set ?\n  if (last) {\n    v[28] = ~v[28]\n    v[29] = ~v[29]\n  }\n\n  // get little-endian words\n  for (i = 0; i < 32; i++) {\n    m[i] = B2B_GET32(ctx.b, 4 * i)\n  }\n\n  // twelve rounds of mixing\n  // uncomment the DebugPrint calls to log the computation\n  // and match the RFC sample documentation\n  // util.debugPrint('          m[16]', m, 64)\n  for (i = 0; i < 12; i++) {\n    // util.debugPrint('   (i=' + (i < 10 ? ' ' : '') + i + ') v[16]', v, 64)\n    B2B_G(0, 8, 16, 24, SIGMA82[i * 16 + 0], SIGMA82[i * 16 + 1])\n    B2B_G(2, 10, 18, 26, SIGMA82[i * 16 + 2], SIGMA82[i * 16 + 3])\n    B2B_G(4, 12, 20, 28, SIGMA82[i * 16 + 4], SIGMA82[i * 16 + 5])\n    B2B_G(6, 14, 22, 30, SIGMA82[i * 16 + 6], SIGMA82[i * 16 + 7])\n    B2B_G(0, 10, 20, 30, SIGMA82[i * 16 + 8], SIGMA82[i * 16 + 9])\n    B2B_G(2, 12, 22, 24, SIGMA82[i * 16 + 10], SIGMA82[i * 16 + 11])\n    B2B_G(4, 14, 16, 26, SIGMA82[i * 16 + 12], SIGMA82[i * 16 + 13])\n    B2B_G(6, 8, 18, 28, SIGMA82[i * 16 + 14], SIGMA82[i * 16 + 15])\n  }\n  // util.debugPrint('   (i=12) v[16]', v, 64)\n\n  for (i = 0; i < 16; i++) {\n    ctx.h[i] = ctx.h[i] ^ v[i] ^ v[i + 16]\n  }\n  // util.debugPrint('h[8]', ctx.h, 64)\n}\n\n// reusable parameterBlock\nconst parameterBlock = new Uint8Array([\n  0,\n  0,\n  0,\n  0, //  0: outlen, keylen, fanout, depth\n  0,\n  0,\n  0,\n  0, //  4: leaf length, sequential mode\n  0,\n  0,\n  0,\n  0, //  8: node offset\n  0,\n  0,\n  0,\n  0, // 12: node offset\n  0,\n  0,\n  0,\n  0, // 16: node depth, inner length, rfu\n  0,\n  0,\n  0,\n  0, // 20: rfu\n  0,\n  0,\n  0,\n  0, // 24: rfu\n  0,\n  0,\n  0,\n  0, // 28: rfu\n  0,\n  0,\n  0,\n  0, // 32: salt\n  0,\n  0,\n  0,\n  0, // 36: salt\n  0,\n  0,\n  0,\n  0, // 40: salt\n  0,\n  0,\n  0,\n  0, // 44: salt\n  0,\n  0,\n  0,\n  0, // 48: personal\n  0,\n  0,\n  0,\n  0, // 52: personal\n  0,\n  0,\n  0,\n  0, // 56: personal\n  0,\n  0,\n  0,\n  0 // 60: personal\n])\n\n// Creates a BLAKE2b hashing context\n// Requires an output length between 1 and 64 bytes\n// Takes an optional Uint8Array key\n// Takes an optinal Uint8Array salt\n// Takes an optinal Uint8Array personal\nfunction blake2bInit (outlen, key, salt, personal) {\n  if (outlen === 0 || outlen > 64) {\n    throw new Error('Illegal output length, expected 0 < length <= 64')\n  }\n  if (key && key.length > 64) {\n    throw new Error('Illegal key, expected Uint8Array with 0 < length <= 64')\n  }\n  if (salt && salt.length !== 16) {\n    throw new Error('Illegal salt, expected Uint8Array with length is 16')\n  }\n  if (personal && personal.length !== 16) {\n    throw new Error('Illegal personal, expected Uint8Array with length is 16')\n  }\n\n  // state, 'param block'\n  const ctx = {\n    b: new Uint8Array(128),\n    h: new Uint32Array(16),\n    t: 0, // input count\n    c: 0, // pointer within buffer\n    outlen: outlen // output length in bytes\n  }\n\n  // initialize parameterBlock before usage\n  parameterBlock.fill(0)\n  parameterBlock[0] = outlen\n  if (key) parameterBlock[1] = key.length\n  parameterBlock[2] = 1 // fanout\n  parameterBlock[3] = 1 // depth\n  if (salt) parameterBlock.set(salt, 32)\n  if (personal) parameterBlock.set(personal, 48)\n\n  // initialize hash state\n  for (let i = 0; i < 16; i++) {\n    ctx.h[i] = BLAKE2B_IV32[i] ^ B2B_GET32(parameterBlock, i * 4)\n  }\n\n  // key the hash, if applicable\n  if (key) {\n    blake2bUpdate(ctx, key)\n    // at the end\n    ctx.c = 128\n  }\n\n  return ctx\n}\n\n// Updates a BLAKE2b streaming hash\n// Requires hash context and Uint8Array (byte array)\nfunction blake2bUpdate (ctx, input) {\n  for (let i = 0; i < input.length; i++) {\n    if (ctx.c === 128) {\n      // buffer full ?\n      ctx.t += ctx.c // add counters\n      blake2bCompress(ctx, false) // compress (not last)\n      ctx.c = 0 // counter to zero\n    }\n    ctx.b[ctx.c++] = input[i]\n  }\n}\n\n// Completes a BLAKE2b streaming hash\n// Returns a Uint8Array containing the message digest\nfunction blake2bFinal (ctx) {\n  ctx.t += ctx.c // mark last block offset\n\n  while (ctx.c < 128) {\n    // fill up with zeros\n    ctx.b[ctx.c++] = 0\n  }\n  blake2bCompress(ctx, true) // final block flag = 1\n\n  // little endian convert and store\n  const out = new Uint8Array(ctx.outlen)\n  for (let i = 0; i < ctx.outlen; i++) {\n    out[i] = ctx.h[i >> 2] >> (8 * (i & 3))\n  }\n  return out\n}\n\n// Computes the BLAKE2B hash of a string or byte array, and returns a Uint8Array\n//\n// Returns a n-byte Uint8Array\n//\n// Parameters:\n// - input - the input bytes, as a string, Buffer or Uint8Array\n// - key - optional key Uint8Array, up to 64 bytes\n// - outlen - optional output length in bytes, default 64\n// - salt - optional salt bytes, string, Buffer or Uint8Array\n// - personal - optional personal bytes, string, Buffer or Uint8Array\nfunction blake2b (input, key, outlen, salt, personal) {\n  // preprocess inputs\n  outlen = outlen || 64\n  input = util.normalizeInput(input)\n  if (salt) {\n    salt = util.normalizeInput(salt)\n  }\n  if (personal) {\n    personal = util.normalizeInput(personal)\n  }\n\n  // do the math\n  const ctx = blake2bInit(outlen, key, salt, personal)\n  blake2bUpdate(ctx, input)\n  return blake2bFinal(ctx)\n}\n\n// Computes the BLAKE2B hash of a string or byte array\n//\n// Returns an n-byte hash in hex, all lowercase\n//\n// Parameters:\n// - input - the input bytes, as a string, Buffer, or Uint8Array\n// - key - optional key Uint8Array, up to 64 bytes\n// - outlen - optional output length in bytes, default 64\n// - salt - optional salt bytes, string, Buffer or Uint8Array\n// - personal - optional personal bytes, string, Buffer or Uint8Array\nfunction blake2bHex (input, key, outlen, salt, personal) {\n  const output = blake2b(input, key, outlen, salt, personal)\n  return util.toHex(output)\n}\n\nmodule.exports = {\n  blake2b: blake2b,\n  blake2bHex: blake2bHex,\n  blake2bInit: blake2bInit,\n  blake2bUpdate: blake2bUpdate,\n  blake2bFinal: blake2bFinal\n}\n", "// BLAKE2s hash function in pure Javascript\n// Adapted from the reference implementation in RFC7693\n// Ported to Javascript by DC - https://github.com/dcposch\n\nconst util = require('./util')\n\n// Little-endian byte access.\n// Expects a Uint8Array and an index\n// Returns the little-endian uint32 at v[i..i+3]\nfunction B2S_GET32 (v, i) {\n  return v[i] ^ (v[i + 1] << 8) ^ (v[i + 2] << 16) ^ (v[i + 3] << 24)\n}\n\n// Mixing function G.\nfunction B2S_G (a, b, c, d, x, y) {\n  v[a] = v[a] + v[b] + x\n  v[d] = ROTR32(v[d] ^ v[a], 16)\n  v[c] = v[c] + v[d]\n  v[b] = ROTR32(v[b] ^ v[c], 12)\n  v[a] = v[a] + v[b] + y\n  v[d] = ROTR32(v[d] ^ v[a], 8)\n  v[c] = v[c] + v[d]\n  v[b] = ROTR32(v[b] ^ v[c], 7)\n}\n\n// 32-bit right rotation\n// x should be a uint32\n// y must be between 1 and 31, inclusive\nfunction ROTR32 (x, y) {\n  return (x >>> y) ^ (x << (32 - y))\n}\n\n// Initialization Vector.\nconst BLAKE2S_IV = new Uint32Array([\n  0x6a09e667,\n  0xbb67ae85,\n  0x3c6ef372,\n  0xa54ff53a,\n  0x510e527f,\n  0x9b05688c,\n  0x1f83d9ab,\n  0x5be0cd19\n])\n\nconst SIGMA = new Uint8Array([\n  0,\n  1,\n  2,\n  3,\n  4,\n  5,\n  6,\n  7,\n  8,\n  9,\n  10,\n  11,\n  12,\n  13,\n  14,\n  15,\n  14,\n  10,\n  4,\n  8,\n  9,\n  15,\n  13,\n  6,\n  1,\n  12,\n  0,\n  2,\n  11,\n  7,\n  5,\n  3,\n  11,\n  8,\n  12,\n  0,\n  5,\n  2,\n  15,\n  13,\n  10,\n  14,\n  3,\n  6,\n  7,\n  1,\n  9,\n  4,\n  7,\n  9,\n  3,\n  1,\n  13,\n  12,\n  11,\n  14,\n  2,\n  6,\n  5,\n  10,\n  4,\n  0,\n  15,\n  8,\n  9,\n  0,\n  5,\n  7,\n  2,\n  4,\n  10,\n  15,\n  14,\n  1,\n  11,\n  12,\n  6,\n  8,\n  3,\n  13,\n  2,\n  12,\n  6,\n  10,\n  0,\n  11,\n  8,\n  3,\n  4,\n  13,\n  7,\n  5,\n  15,\n  14,\n  1,\n  9,\n  12,\n  5,\n  1,\n  15,\n  14,\n  13,\n  4,\n  10,\n  0,\n  7,\n  6,\n  3,\n  9,\n  2,\n  8,\n  11,\n  13,\n  11,\n  7,\n  14,\n  12,\n  1,\n  3,\n  9,\n  5,\n  0,\n  15,\n  4,\n  8,\n  6,\n  2,\n  10,\n  6,\n  15,\n  14,\n  9,\n  11,\n  3,\n  0,\n  8,\n  12,\n  2,\n  13,\n  7,\n  1,\n  4,\n  10,\n  5,\n  10,\n  2,\n  8,\n  4,\n  7,\n  6,\n  1,\n  5,\n  15,\n  11,\n  9,\n  14,\n  3,\n  12,\n  13,\n  0\n])\n\n// Compression function. \"last\" flag indicates last block\nconst v = new Uint32Array(16)\nconst m = new Uint32Array(16)\nfunction blake2sCompress (ctx, last) {\n  let i = 0\n  for (i = 0; i < 8; i++) {\n    // init work variables\n    v[i] = ctx.h[i]\n    v[i + 8] = BLAKE2S_IV[i]\n  }\n\n  v[12] ^= ctx.t // low 32 bits of offset\n  v[13] ^= ctx.t / 0x100000000 // high 32 bits\n  if (last) {\n    // last block flag set ?\n    v[14] = ~v[14]\n  }\n\n  for (i = 0; i < 16; i++) {\n    // get little-endian words\n    m[i] = B2S_GET32(ctx.b, 4 * i)\n  }\n\n  // ten rounds of mixing\n  // uncomment the DebugPrint calls to log the computation\n  // and match the RFC sample documentation\n  // util.debugPrint('          m[16]', m, 32)\n  for (i = 0; i < 10; i++) {\n    // util.debugPrint('   (i=' + i + ')  v[16]', v, 32)\n    B2S_G(0, 4, 8, 12, m[SIGMA[i * 16 + 0]], m[SIGMA[i * 16 + 1]])\n    B2S_G(1, 5, 9, 13, m[SIGMA[i * 16 + 2]], m[SIGMA[i * 16 + 3]])\n    B2S_G(2, 6, 10, 14, m[SIGMA[i * 16 + 4]], m[SIGMA[i * 16 + 5]])\n    B2S_G(3, 7, 11, 15, m[SIGMA[i * 16 + 6]], m[SIGMA[i * 16 + 7]])\n    B2S_G(0, 5, 10, 15, m[SIGMA[i * 16 + 8]], m[SIGMA[i * 16 + 9]])\n    B2S_G(1, 6, 11, 12, m[SIGMA[i * 16 + 10]], m[SIGMA[i * 16 + 11]])\n    B2S_G(2, 7, 8, 13, m[SIGMA[i * 16 + 12]], m[SIGMA[i * 16 + 13]])\n    B2S_G(3, 4, 9, 14, m[SIGMA[i * 16 + 14]], m[SIGMA[i * 16 + 15]])\n  }\n  // util.debugPrint('   (i=10) v[16]', v, 32)\n\n  for (i = 0; i < 8; i++) {\n    ctx.h[i] ^= v[i] ^ v[i + 8]\n  }\n  // util.debugPrint('h[8]', ctx.h, 32)\n}\n\n// Creates a BLAKE2s hashing context\n// Requires an output length between 1 and 32 bytes\n// Takes an optional Uint8Array key\nfunction blake2sInit (outlen, key) {\n  if (!(outlen > 0 && outlen <= 32)) {\n    throw new Error('Incorrect output length, should be in [1, 32]')\n  }\n  const keylen = key ? key.length : 0\n  if (key && !(keylen > 0 && keylen <= 32)) {\n    throw new Error('Incorrect key length, should be in [1, 32]')\n  }\n\n  const ctx = {\n    h: new Uint32Array(BLAKE2S_IV), // hash state\n    b: new Uint8Array(64), // input block\n    c: 0, // pointer within block\n    t: 0, // input count\n    outlen: outlen // output length in bytes\n  }\n  ctx.h[0] ^= 0x01010000 ^ (keylen << 8) ^ outlen\n\n  if (keylen > 0) {\n    blake2sUpdate(ctx, key)\n    ctx.c = 64 // at the end\n  }\n\n  return ctx\n}\n\n// Updates a BLAKE2s streaming hash\n// Requires hash context and Uint8Array (byte array)\nfunction blake2sUpdate (ctx, input) {\n  for (let i = 0; i < input.length; i++) {\n    if (ctx.c === 64) {\n      // buffer full ?\n      ctx.t += ctx.c // add counters\n      blake2sCompress(ctx, false) // compress (not last)\n      ctx.c = 0 // counter to zero\n    }\n    ctx.b[ctx.c++] = input[i]\n  }\n}\n\n// Completes a BLAKE2s streaming hash\n// Returns a Uint8Array containing the message digest\nfunction blake2sFinal (ctx) {\n  ctx.t += ctx.c // mark last block offset\n  while (ctx.c < 64) {\n    // fill up with zeros\n    ctx.b[ctx.c++] = 0\n  }\n  blake2sCompress(ctx, true) // final block flag = 1\n\n  // little endian convert and store\n  const out = new Uint8Array(ctx.outlen)\n  for (let i = 0; i < ctx.outlen; i++) {\n    out[i] = (ctx.h[i >> 2] >> (8 * (i & 3))) & 0xff\n  }\n  return out\n}\n\n// Computes the BLAKE2S hash of a string or byte array, and returns a Uint8Array\n//\n// Returns a n-byte Uint8Array\n//\n// Parameters:\n// - input - the input bytes, as a string, Buffer, or Uint8Array\n// - key - optional key Uint8Array, up to 32 bytes\n// - outlen - optional output length in bytes, default 64\nfunction blake2s (input, key, outlen) {\n  // preprocess inputs\n  outlen = outlen || 32\n  input = util.normalizeInput(input)\n\n  // do the math\n  const ctx = blake2sInit(outlen, key)\n  blake2sUpdate(ctx, input)\n  return blake2sFinal(ctx)\n}\n\n// Computes the BLAKE2S hash of a string or byte array\n//\n// Returns an n-byte hash in hex, all lowercase\n//\n// Parameters:\n// - input - the input bytes, as a string, Buffer, or Uint8Array\n// - key - optional key Uint8Array, up to 32 bytes\n// - outlen - optional output length in bytes, default 64\nfunction blake2sHex (input, key, outlen) {\n  const output = blake2s(input, key, outlen)\n  return util.toHex(output)\n}\n\nmodule.exports = {\n  blake2s: blake2s,\n  blake2sHex: blake2sHex,\n  blake2sInit: blake2sInit,\n  blake2sUpdate: blake2sUpdate,\n  blake2sFinal: blake2sFinal\n}\n", "const b2b = require('./blake2b')\nconst b2s = require('./blake2s')\n\nmodule.exports = {\n  blake2b: b2b.blake2b,\n  blake2bHex: b2b.blake2bHex,\n  blake2bInit: b2b.blake2bInit,\n  blake2bUpdate: b2b.blake2bUpdate,\n  blake2bFinal: b2b.blake2bFinal,\n  blake2s: b2s.blake2s,\n  blake2sHex: b2s.blake2sHex,\n  blake2sInit: b2s.blake2sInit,\n  blake2sUpdate: b2s.blake2sUpdate,\n  blake2sFinal: b2s.blake2sFinal\n}\n", "import {\n  isFunction,\n  isPlainObject,\n  isString,\n  isNumber,\n} from '@segment/analytics-core'\nimport { Context } from '../context'\nimport {\n  Callback,\n  Options,\n  EventProperties,\n  SegmentEvent,\n  Traits,\n  GroupTraits,\n  UserTraits,\n} from '../events'\nimport { ID, WithId } from '../user'\n\n/**\n * Helper for the track method\n */\nexport function resolveArguments(\n  eventName: string | SegmentEvent,\n  properties?: EventProperties | Callback,\n  options?: Options | Callback,\n  callback?: Callback\n): [string, EventProperties | Callback, Options, Callback | undefined] {\n  const args = [eventName, properties, options, callback]\n\n  const name = isPlainObject(eventName) ? eventName.event : eventName\n  if (!name || !isString(name)) {\n    throw new Error('Event missing')\n  }\n\n  const data = isPlainObject(eventName)\n    ? eventName.properties ?? {}\n    : isPlainObject(properties)\n    ? properties\n    : {}\n\n  let opts: Options = {}\n  if (!isFunction(options)) {\n    opts = options ?? {}\n  }\n\n  if (isPlainObject(eventName) && !isFunction(properties)) {\n    opts = properties ?? {}\n  }\n\n  const cb = args.find(isFunction) as Callback | undefined\n  return [name, data, opts, cb]\n}\n\n/**\n * Helper for page, screen methods\n */\nexport function resolvePageArguments(\n  category?: string | object | null,\n  name?: string | object | Callback | null,\n  properties?: EventProperties | Options | Callback | null,\n  options?: Options | Callback,\n  callback?: Callback\n): [\n  string | null,\n  string | null,\n  EventProperties,\n  Options,\n  Callback | undefined\n] {\n  let resolvedProperties: EventProperties\n  let resolvedOptions: Options\n  let resolvedCategory: string | undefined | null = null\n  let resolvedName: string | undefined | null = null\n  const args = [category, name, properties, options, callback]\n\n  // The legacy logic is basically:\n  // - If there is a string, it's the name\n  // - If there are two strings, it's category and name\n  const strings = args.filter(isString)\n  if (strings.length === 1) {\n    if (isString(args[1])) {\n      resolvedName = args[1]\n      resolvedCategory = null\n    } else {\n      resolvedName = strings[0]\n      resolvedCategory = null\n    }\n  } else if (strings.length === 2) {\n    if (typeof args[0] === 'string') {\n      resolvedCategory = args[0]\n    }\n    if (typeof args[1] === 'string') {\n      resolvedName = args[1]\n    }\n  }\n\n  // handle: analytics.page('category', 'name', properties, options, callback)\n  const resolvedCallback = args.find(isFunction) as Callback | undefined\n\n  // handle:\n  // - analytics.page('name')\n  // - analytics.page('category', 'name')\n  // - analytics.page(properties)\n  // - analytics.page(properties, options)\n  // - analytics.page('name', properties)\n  // - analytics.page('name', properties, options)\n  // - analytics.page('category', 'name', properties, options)\n  // - analytics.page('category', 'name', properties, options, callback)\n  // - analytics.page('category', 'name', callback)\n  // - analytics.page(callback), etc\n\n  // The legacy logic is basically:\n  // - If there is a plain object, it's the properties\n  // - If there are two plain objects, it's properties and options\n  const objects = args.filter(isPlainObject)\n  if (objects.length === 1) {\n    if (isPlainObject(args[2])) {\n      resolvedOptions = {}\n      resolvedProperties = args[2]\n    } else if (isPlainObject(args[3])) {\n      resolvedProperties = {}\n      resolvedOptions = args[3]\n    } else {\n      resolvedProperties = objects[0]\n      resolvedOptions = {}\n    }\n  } else if (objects.length === 2) {\n    resolvedProperties = objects[0]\n    resolvedOptions = objects[1]\n  }\n\n  return [\n    resolvedCategory,\n    resolvedName,\n    (resolvedProperties ??= {}),\n    (resolvedOptions ??= {}),\n    resolvedCallback,\n  ]\n}\n\n/**\n * Helper for group, identify methods\n */\nexport const resolveUserArguments = <T extends Traits, U extends WithId>(\n  user: U\n): ResolveUser<T> => {\n  return (...args): ReturnType<ResolveUser<T>> => {\n    const values: {\n      id?: ID\n      traits?: T | null\n      options?: Options\n      callback?: Callback\n    } = {}\n    // It's a stack so it's reversed so that we go through each of the expected arguments\n    const orderStack: Array<keyof typeof values> = [\n      'callback',\n      'options',\n      'traits',\n      'id',\n    ]\n\n    // Read each argument and eval the possible values here\n    for (const arg of args) {\n      let current = orderStack.pop()\n      if (current === 'id') {\n        if (isString(arg) || isNumber(arg)) {\n          values.id = arg.toString()\n          continue\n        }\n        if (arg === null || arg === undefined) {\n          continue\n        }\n        // First argument should always be the id, if it is not a valid value we can skip it\n        current = orderStack.pop()\n      }\n\n      // Traits and Options\n      if (\n        (current === 'traits' || current === 'options') &&\n        (arg === null || arg === undefined || isPlainObject(arg))\n      ) {\n        values[current] = arg as T\n      }\n\n      // Callback\n      if (isFunction(arg)) {\n        values.callback = arg as Callback\n        break // This is always the last argument\n      }\n    }\n\n    return [\n      values.id ?? user.id(),\n      (values.traits ?? {}) as T,\n      values.options ?? {},\n      values.callback,\n    ]\n  }\n}\n\n/**\n * Helper for alias method\n */\nexport function resolveAliasArguments(\n  to: string | number,\n  from?: string | number | Options,\n  options?: Options | Callback,\n  callback?: Callback\n): [string, string | null, Options, Callback | undefined] {\n  if (isNumber(to)) to = to.toString() // Legacy behaviour - allow integers for alias calls\n  if (isNumber(from)) from = from.toString()\n  const args = [to, from, options, callback]\n\n  const [aliasTo = to, aliasFrom = null] = args.filter(isString)\n  const [opts = {}] = args.filter(isPlainObject)\n  const resolvedCallback = args.find(isFunction) as Callback | undefined\n\n  return [aliasTo, aliasFrom, opts, resolvedCallback]\n}\n\ntype ResolveUser<T extends Traits> = (\n  id?: ID | object,\n  traits?: T | Callback | null,\n  options?: Options | Callback,\n  callback?: Callback\n) => [ID, T, Options, Callback | undefined]\n\nexport type IdentifyParams = Parameters<ResolveUser<UserTraits>>\nexport type GroupParams = Parameters<ResolveUser<GroupTraits>>\nexport type EventParams = Parameters<typeof resolveArguments>\nexport type PageParams = Parameters<typeof resolvePageArguments>\nexport type AliasParams = Parameters<typeof resolveAliasArguments>\n\nexport type DispatchedEvent = Context\n", "// src/page-context.ts\nfunction isPlainObject(obj) {\n    return Object.prototype.toString.call(obj).slice(8, -1).toLowerCase() === \"object\";\n}\nvar BufferedPageContextDiscriminant = \"bpc\";\nvar createBufferedPageContext = function(url, canonicalUrl, search, path, title, referrer) {\n    return {\n        __t: BufferedPageContextDiscriminant,\n        c: canonicalUrl,\n        p: path,\n        u: url,\n        s: search,\n        t: title,\n        r: referrer\n    };\n};\nvar BUFFERED_PAGE_CONTEXT_KEYS = Object.keys(createBufferedPageContext(\"\", \"\", \"\", \"\", \"\", \"\"));\nfunction isBufferedPageContext(bufferedPageCtx) {\n    if (!isPlainObject(bufferedPageCtx)) return false;\n    if (bufferedPageCtx.__t !== BufferedPageContextDiscriminant) return false;\n    for(var k in bufferedPageCtx){\n        if (!BUFFERED_PAGE_CONTEXT_KEYS.includes(k)) {\n            return false;\n        }\n    }\n    return true;\n}\nvar createCanonicalURL = function(canonicalUrl, searchParams) {\n    return canonicalUrl.indexOf(\"?\") > -1 ? canonicalUrl : canonicalUrl + searchParams;\n};\nvar removeHash = function(href) {\n    var hashIdx = href.indexOf(\"#\");\n    return hashIdx === -1 ? href : href.slice(0, hashIdx);\n};\nvar parseCanonicalPath = function(canonicalUrl) {\n    try {\n        return new URL(canonicalUrl).pathname;\n    } catch (_e) {\n        return canonicalUrl[0] === \"/\" ? canonicalUrl : \"/\" + canonicalUrl;\n    }\n};\nvar createPageContext = function(param) {\n    var canonicalUrl = param.c, pathname = param.p, search = param.s, url = param.u, referrer = param.r, title = param.t;\n    var newPath = canonicalUrl ? parseCanonicalPath(canonicalUrl) : pathname;\n    var newUrl = canonicalUrl ? createCanonicalURL(canonicalUrl, search) : removeHash(url);\n    return {\n        path: newPath,\n        referrer: referrer,\n        search: search,\n        title: title,\n        url: newUrl\n    };\n};\nvar getDefaultBufferedPageContext = function() {\n    var c = document.querySelector(\"link[rel='canonical']\");\n    return createBufferedPageContext(location.href, c && c.getAttribute(\"href\") || void 0, location.search, location.pathname, document.title, document.referrer);\n};\nvar getDefaultPageContext = function() {\n    return createPageContext(getDefaultBufferedPageContext());\n};\nexport { BufferedPageContextDiscriminant, createBufferedPageContext, createPageContext, getDefaultBufferedPageContext, getDefaultPageContext, isBufferedPageContext };\n", "export function pick<T extends Record<string, any>, K extends keyof T>(\n  object: T,\n  keys: readonly K[]\n): Pick<T, K>\n\nexport function pick<T extends Record<string, any>>(\n  object: T,\n  keys: string[]\n): Partial<T>\n\n/**\n * @example\n * pick({ 'a': 1, 'b': '2', 'c': 3 }, ['a', 'c'])\n * => { 'a': 1, 'c': 3 }\n */\nexport function pick<T extends Record<string, any>, K extends keyof T>(\n  object: T,\n  keys: string[] | K[] | readonly K[]\n) {\n  return Object.assign(\n    {},\n    ...keys.map((key) => {\n      if (object && Object.prototype.hasOwnProperty.call(object, key)) {\n        return { [key]: object[key] }\n      }\n    })\n  )\n}\n", "import { pick } from '../../lib/pick'\nimport { EventProperties, SegmentEvent } from '../events'\nimport { getDefaultPageContext } from '@segment/analytics-page-tools'\n\n/**\n * Augments a segment event with information about the current page.\n * Page information like URL changes frequently, so this is meant to be captured as close to the event call as possible.\n * Things like `userAgent` do not change, so they can be added later in the flow.\n * We prefer not to add this information to this function, as it increases the main bundle size.\n */\nexport const addPageContext = (\n  event: SegmentEvent,\n  pageCtx = getDefaultPageContext()\n): void => {\n  const evtCtx = event.context! // Context should be set earlier in the flow\n  let pageContextFromEventProps: Pick<EventProperties, string> | undefined\n  if (event.type === 'page') {\n    pageContextFromEventProps =\n      event.properties && pick(event.properties, Object.keys(pageCtx))\n\n    event.properties = {\n      ...pageCtx,\n      ...event.properties,\n      ...(event.name ? { name: event.name } : {}),\n    }\n  }\n\n  evtCtx.page = {\n    ...pageCtx,\n    ...pageContextFromEventProps,\n    ...evtCtx.page,\n  }\n}\n", "import { v4 as uuid } from '@lukeed/uuid'\nimport { ID, User } from '../user'\nimport { Options, EventProperties, Traits, SegmentEvent } from './interfaces'\nimport { addPageContext, PageContext } from '../page'\nimport { CoreEventFactory, IntegrationsOptions } from '@segment/analytics-core'\n\nexport * from './interfaces'\n\nexport class EventFactory extends CoreEventFactory {\n  user: User\n  constructor(user: User) {\n    super({\n      createMessageId: () => `ajs-next-${Date.now()}-${uuid()}`,\n      onEventMethodCall: ({ options }) => {\n        this.maybeUpdateAnonId(options)\n      },\n      onFinishedEvent: (event) => {\n        this.addIdentity(event)\n        return event\n      },\n    })\n    this.user = user\n  }\n\n  /**\n   * Updates the anonymousId *globally* if it's provided in the options.\n   * This should generally be done in the identify method, but some customers rely on this.\n   */\n  private maybeUpdateAnonId(options: Options | undefined): void {\n    options?.anonymousId && this.user.anonymousId(options.anonymousId)\n  }\n\n  /**\n   * add user id / anonymous id to the event\n   */\n  private addIdentity(event: SegmentEvent) {\n    if (this.user.id()) {\n      event.userId = this.user.id()\n    }\n\n    if (this.user.anonymousId()) {\n      event.anonymousId = this.user.anonymousId()\n    }\n  }\n\n  override track(\n    event: string,\n    properties?: EventProperties,\n    options?: Options,\n    integrationsOptions?: IntegrationsOptions,\n    pageCtx?: PageContext\n  ): SegmentEvent {\n    const ev = super.track(event, properties, options, integrationsOptions)\n    addPageContext(ev, pageCtx)\n    return ev\n  }\n\n  override page(\n    category: string | null,\n    page: string | null,\n    properties?: EventProperties,\n    options?: Options,\n    integrationsOptions?: IntegrationsOptions,\n    pageCtx?: PageContext\n  ): SegmentEvent {\n    const ev = super.page(\n      category,\n      page,\n      properties,\n      options,\n      integrationsOptions\n    )\n    addPageContext(ev, pageCtx)\n    return ev\n  }\n\n  override screen(\n    category: string | null,\n    screen: string | null,\n    properties?: EventProperties,\n    options?: Options,\n    integrationsOptions?: IntegrationsOptions,\n    pageCtx?: PageContext\n  ): SegmentEvent {\n    const ev = super.screen(\n      category,\n      screen,\n      properties,\n      options,\n      integrationsOptions\n    )\n    addPageContext(ev, pageCtx)\n    return ev\n  }\n\n  override identify(\n    userId: ID,\n    traits?: Traits,\n    options?: Options,\n    integrationsOptions?: IntegrationsOptions,\n    pageCtx?: PageContext\n  ): SegmentEvent {\n    const ev = super.identify(userId, traits, options, integrationsOptions)\n    addPageContext(ev, pageCtx)\n    return ev\n  }\n\n  override group(\n    groupId: ID,\n    traits?: Traits,\n    options?: Options,\n    integrationsOptions?: IntegrationsOptions,\n    pageCtx?: PageContext\n  ): SegmentEvent {\n    const ev = super.group(groupId, traits, options, integrationsOptions)\n    addPageContext(ev, pageCtx)\n    return ev\n  }\n\n  override alias(\n    to: string,\n    from: string | null,\n    options?: Options,\n    integrationsOptions?: IntegrationsOptions,\n    pageCtx?: PageContext\n  ): SegmentEvent {\n    const ev = super.alias(to, from, options, integrationsOptions)\n    addPageContext(ev, pageCtx)\n    return ev\n  }\n}\n", "import type { CorePlugin } from '@segment/analytics-core'\nimport type { DestinationMiddlewareFunction } from '../../plugins/middleware'\nimport type { Analytics } from '../analytics'\nimport type { Context } from '../context'\n\nexport interface Plugin extends CorePlugin<Context, Analytics> {}\n\nexport interface InternalPluginWithAddMiddleware extends Plugin {\n  addMiddleware: (...fns: DestinationMiddlewareFunction[]) => void\n}\n\nexport interface InternalDestinationPluginWithAddMiddleware\n  extends InternalPluginWithAddMiddleware {\n  type: 'destination'\n}\n\nexport const isDestinationPluginWithAddMiddleware = (\n  plugin: Plugin\n): plugin is InternalDestinationPluginWithAddMiddleware => {\n  // FYI: segment's plugin does not currently have an 'addMiddleware' method\n  return 'addMiddleware' in plugin && plugin.type === 'destination'\n}\n", "import { PriorityQueue } from '../../lib/priority-queue'\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted'\nimport { Context } from '../context'\nimport { Plugin } from '../plugin'\nimport { CoreEventQueue } from '@segment/analytics-core'\nimport { isOffline } from '../connection'\n\nexport class EventQueue extends CoreEventQueue<Context, Plugin> {\n  constructor(name: string)\n  constructor(priorityQueue: PriorityQueue<Context>)\n  constructor(nameOrQueue: string | PriorityQueue<Context>) {\n    super(\n      typeof nameOrQueue === 'string'\n        ? new PersistedPriorityQueue(4, nameOrQueue)\n        : nameOrQueue\n    )\n  }\n  async flush(): Promise<Context[]> {\n    if (isOffline()) return []\n    return super.flush()\n  }\n}\n", "export default function bindAll<\n  ObjType extends { [key: string]: any },\n  KeyType extends keyof ObjType\n>(obj: ObjType): ObjType {\n  const proto = obj.constructor.prototype\n  for (const key of Object.getOwnPropertyNames(proto)) {\n    if (key !== 'constructor') {\n      const desc = Object.getOwnPropertyDescriptor(\n        obj.constructor.prototype,\n        key\n      )\n      if (!!desc && typeof desc.value === 'function') {\n        obj[key as KeyType] = obj[key].bind(obj)\n      }\n    }\n  }\n\n  return obj\n}\n", "/*! js-cookie v3.0.1 | MIT */\n/* eslint-disable no-var */\nfunction assign (target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i];\n    for (var key in source) {\n      target[key] = source[key];\n    }\n  }\n  return target\n}\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\nvar defaultConverter = {\n  read: function (value) {\n    if (value[0] === '\"') {\n      value = value.slice(1, -1);\n    }\n    return value.replace(/(%[\\dA-F]{2})+/gi, decodeURIComponent)\n  },\n  write: function (value) {\n    return encodeURIComponent(value).replace(\n      /%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,\n      decodeURIComponent\n    )\n  }\n};\n/* eslint-enable no-var */\n\n/* eslint-disable no-var */\n\nfunction init (converter, defaultAttributes) {\n  function set (key, value, attributes) {\n    if (typeof document === 'undefined') {\n      return\n    }\n\n    attributes = assign({}, defaultAttributes, attributes);\n\n    if (typeof attributes.expires === 'number') {\n      attributes.expires = new Date(Date.now() + attributes.expires * 864e5);\n    }\n    if (attributes.expires) {\n      attributes.expires = attributes.expires.toUTCString();\n    }\n\n    key = encodeURIComponent(key)\n      .replace(/%(2[346B]|5E|60|7C)/g, decodeURIComponent)\n      .replace(/[()]/g, escape);\n\n    var stringifiedAttributes = '';\n    for (var attributeName in attributes) {\n      if (!attributes[attributeName]) {\n        continue\n      }\n\n      stringifiedAttributes += '; ' + attributeName;\n\n      if (attributes[attributeName] === true) {\n        continue\n      }\n\n      // Considers RFC 6265 section 5.2:\n      // ...\n      // 3.  If the remaining unparsed-attributes contains a %x3B (\";\")\n      //     character:\n      // Consume the characters of the unparsed-attributes up to,\n      // not including, the first %x3B (\";\") character.\n      // ...\n      stringifiedAttributes += '=' + attributes[attributeName].split(';')[0];\n    }\n\n    return (document.cookie =\n      key + '=' + converter.write(value, key) + stringifiedAttributes)\n  }\n\n  function get (key) {\n    if (typeof document === 'undefined' || (arguments.length && !key)) {\n      return\n    }\n\n    // To prevent the for loop in the first place assign an empty array\n    // in case there are no cookies at all.\n    var cookies = document.cookie ? document.cookie.split('; ') : [];\n    var jar = {};\n    for (var i = 0; i < cookies.length; i++) {\n      var parts = cookies[i].split('=');\n      var value = parts.slice(1).join('=');\n\n      try {\n        var foundKey = decodeURIComponent(parts[0]);\n        jar[foundKey] = converter.read(value, foundKey);\n\n        if (key === foundKey) {\n          break\n        }\n      } catch (e) {}\n    }\n\n    return key ? jar[key] : jar\n  }\n\n  return Object.create(\n    {\n      set: set,\n      get: get,\n      remove: function (key, attributes) {\n        set(\n          key,\n          '',\n          assign({}, attributes, {\n            expires: -1\n          })\n        );\n      },\n      withAttributes: function (attributes) {\n        return init(this.converter, assign({}, this.attributes, attributes))\n      },\n      withConverter: function (converter) {\n        return init(assign({}, this.converter, converter), this.attributes)\n      }\n    },\n    {\n      attributes: { value: Object.freeze(defaultAttributes) },\n      converter: { value: Object.freeze(converter) }\n    }\n  )\n}\n\nvar api = init(defaultConverter, { path: '/' });\n/* eslint-enable no-var */\n\nexport default api;\n", "import cookie from 'js-cookie'\n\n/**\n * Levels returns all levels of the given url.\n *\n * @param {string} url\n * @return {Array}\n * @api public\n */\nfunction levels(url: URL): string[] {\n  const host = url.hostname\n  const parts = host.split('.')\n  const last = parts[parts.length - 1]\n  const levels: string[] = []\n\n  // Ip address.\n  if (parts.length === 4 && parseInt(last, 10) > 0) {\n    return levels\n  }\n\n  // Localhost.\n  if (parts.length <= 1) {\n    return levels\n  }\n\n  // Create levels.\n  for (let i = parts.length - 2; i >= 0; --i) {\n    levels.push(parts.slice(i).join('.'))\n  }\n\n  return levels\n}\n\nfunction parseUrl(url: string): URL | undefined {\n  try {\n    return new URL(url)\n  } catch {\n    return\n  }\n}\n\nexport function tld(url: string): string | undefined {\n  const parsedUrl = parseUrl(url)\n  if (!parsedUrl) return\n\n  const lvls = levels(parsedUrl)\n\n  // Lookup the real top level one.\n  for (let i = 0; i < lvls.length; ++i) {\n    const cname = '__tld__'\n    const domain = lvls[i]\n    const opts = { domain: '.' + domain }\n\n    try {\n      // cookie access throw an error if the library is ran inside a sandboxed environment (e.g. sandboxed iframe)\n      cookie.set(cname, '1', opts)\n      if (cookie.get(cname)) {\n        cookie.remove(cname, opts)\n        return domain\n      }\n    } catch (_) {\n      return\n    }\n  }\n}\n", "import { Store, StorageObject } from './types'\nimport jar from 'js-cookie'\nimport { tld } from '../user/tld'\n\nconst ONE_YEAR = 365\n\nexport interface CookieOptions {\n  maxage?: number\n  domain?: string\n  path?: string\n  secure?: boolean\n  sameSite?: string\n}\n\n/**\n * Data storage using browser cookies\n */\nexport class CookieStorage<Data extends StorageObject = StorageObject>\n  implements Store<Data>\n{\n  static get defaults(): CookieOptions {\n    return {\n      maxage: ONE_YEAR,\n      domain: tld(window.location.href),\n      path: '/',\n      sameSite: 'Lax',\n    }\n  }\n\n  private options: Required<CookieOptions>\n\n  constructor(options: CookieOptions = CookieStorage.defaults) {\n    this.options = {\n      ...CookieStorage.defaults,\n      ...options,\n    } as Required<CookieOptions>\n  }\n\n  private opts(): jar.CookieAttributes {\n    return {\n      sameSite: this.options.sameSite as jar.CookieAttributes['sameSite'],\n      expires: this.options.maxage,\n      domain: this.options.domain,\n      path: this.options.path,\n      secure: this.options.secure,\n    }\n  }\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    try {\n      const value = jar.get(key)\n\n      if (value === undefined || value === null) {\n        return null\n      }\n\n      try {\n        return JSON.parse(value) ?? null\n      } catch (e) {\n        return (value ?? null) as unknown as Data[K] | null\n      }\n    } catch (e) {\n      return null\n    }\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    if (typeof value === 'string') {\n      jar.set(key, value, this.opts())\n    } else if (value === null) {\n      jar.remove(key, this.opts())\n    } else {\n      jar.set(key, JSON.stringify(value), this.opts())\n    }\n  }\n\n  remove<K extends keyof Data>(key: K): void {\n    return jar.remove(key, this.opts())\n  }\n}\n", "import { StorageObject, Store } from './types'\n\n/**\n * Data storage using browser's localStorage\n */\nexport class LocalStorage<Data extends StorageObject = StorageObject>\n  implements Store<Data>\n{\n  private localStorageWarning(key: keyof Data, state: 'full' | 'unavailable') {\n    console.warn(`Unable to access ${key}, localStorage may be ${state}`)\n  }\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    try {\n      const val = localStorage.getItem(key)\n      if (val === null) {\n        return null\n      }\n      try {\n        return JSON.parse(val) ?? null\n      } catch (e) {\n        return (val ?? null) as unknown as Data[K] | null\n      }\n    } catch (err) {\n      this.localStorageWarning(key, 'unavailable')\n      return null\n    }\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    try {\n      localStorage.setItem(key, JSON.stringify(value))\n    } catch {\n      this.localStorageWarning(key, 'full')\n    }\n  }\n\n  remove<K extends keyof Data>(key: K): void {\n    try {\n      return localStorage.removeItem(key)\n    } catch (err) {\n      this.localStorageWarning(key, 'unavailable')\n    }\n  }\n}\n", "import { Store, StorageObject } from './types'\n\n/**\n * Data Storage using in memory object\n */\nexport class MemoryStorage<Data extends StorageObject = StorageObject>\n  implements Store<Data>\n{\n  private cache: Record<string, unknown> = {}\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    return (this.cache[key] ?? null) as Data[K] | null\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    this.cache[key] = value\n  }\n\n  remove<K extends keyof Data>(key: K): void {\n    delete this.cache[key]\n  }\n}\n", "import { CookieOptions } from './cookieStorage'\n\nexport const StoreType = {\n  Cookie: 'cookie',\n  LocalStorage: 'localStorage',\n  Memory: 'memory',\n} as const\n\n/**\n * Known Storage Types\n *\n * Convenience settings for storage systems that AJS includes support for\n */\nexport type StoreType = typeof StoreType[keyof typeof StoreType]\n\nexport type StorageObject = Record<string, unknown>\n\n/**\n * Defines a Storage object for use in AJS Client.\n */\nexport interface Store<Data extends StorageObject = StorageObject> {\n  /**\n   * get value for the key from the stores. it will return the first value found in the stores\n   * @param key key for the value to be retrieved\n   * @returns value for the key or null if not found\n   */\n  get<K extends keyof Data>(key: K): Data[K] | null\n\n  /**\n   * it will set the value for the key in all the stores\n   * @param key key for the value to be stored\n   * @param value value to be stored\n   * @returns value that was stored\n   */\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void\n  /**\n   * remove the value for the key from all the stores\n   * @param key key for the value to be removed\n   * @param storeTypes optional array of store types to be used for removing the value\n   */\n  remove<K extends keyof Data>(key: K): void\n}\n\nexport interface StoreTypeWithSettings<T extends StoreType = StoreType> {\n  name: T\n  settings?: T extends 'cookie' ? CookieOptions : never\n}\n\nexport type InitializeStorageArgs = (StoreTypeWithSettings | StoreType)[]\n", "import { StoreType, StoreTypeWithSettings } from './types'\n\nexport type UniversalStorageSettings = { stores: StoreType[] }\n\n// This is setup this way to permit eventually a different set of settings for custom storage\nexport type StorageSettings = UniversalStorageSettings\n\nexport function isArrayOfStoreType(\n  s: StorageSettings\n): s is UniversalStorageSettings {\n  return (\n    s &&\n    s.stores &&\n    Array.isArray(s.stores) &&\n    s.stores.every((e) => Object.values(StoreType).includes(e))\n  )\n}\n\nexport function isStoreTypeWithSettings(\n  s: StoreTypeWithSettings | StoreType\n): s is StoreTypeWithSettings {\n  return typeof s === 'object' && s.name !== undefined\n}\n", "import { Store, StorageObject } from './types'\n\n// not adding to private method because those method names do not get minified atm, and does not use 'this'\nconst _logStoreKeyError = (\n  store: Store,\n  action: 'set' | 'get' | 'remove',\n  key: string,\n  err: unknown\n) => {\n  console.warn(\n    `${store.constructor.name}: Can't ${action} key \"${key}\" | Err: ${err}`\n  )\n}\n\n/**\n * Uses multiple storages in a priority list to get/set values in the order they are specified.\n */\nexport class UniversalStorage<Data extends StorageObject = StorageObject> {\n  private stores: Store[]\n\n  constructor(stores: Store[]) {\n    this.stores = stores\n  }\n\n  get<K extends keyof Data>(key: K): Data[K] | null {\n    let val: Data[K] | null = null\n\n    for (const store of this.stores) {\n      try {\n        val = store.get(key) as Data[K] | null\n        if (val !== undefined && val !== null) {\n          return val\n        }\n      } catch (e) {\n        _logStoreKeyError(store, 'get', key, e)\n      }\n    }\n    return null\n  }\n\n  set<K extends keyof Data>(key: K, value: Data[K] | null): void {\n    this.stores.forEach((store) => {\n      try {\n        store.set(key, value)\n      } catch (e) {\n        _logStoreKeyError(store, 'set', key, e)\n      }\n    })\n  }\n\n  clear<K extends keyof Data>(key: K): void {\n    this.stores.forEach((store) => {\n      try {\n        store.remove(key)\n      } catch (e) {\n        _logStoreKeyError(store, 'remove', key, e)\n      }\n    })\n  }\n\n  /*\n    This is to support few scenarios where:\n    - value exist in one of the stores ( as a result of other stores being cleared from browser ) and we want to resync them\n    - read values in AJS 1.0 format ( for customers after 1.0 --> 2.0 migration ) and then re-write them in AJS 2.0 format\n  */\n  getAndSync<K extends keyof Data>(key: K): Data[K] | null {\n    const val = this.get(key)\n\n    // legacy behavior, getAndSync can change the type of a value from number to string (AJS 1.0 stores numerical values as a number)\n    const coercedValue = (typeof val === 'number' ? val.toString() : val) as\n      | Data[K]\n      | null\n\n    this.set(key, coercedValue)\n\n    return coercedValue\n  }\n}\n", "import { CookieOptions, CookieStorage } from './cookieStorage'\nimport { LocalStorage } from './localStorage'\nimport { MemoryStorage } from './memoryStorage'\nimport { isStoreTypeWithSettings } from './settings'\nimport { StoreType, Store, InitializeStorageArgs } from './types'\n\nexport * from './types'\nexport * from './localStorage'\nexport * from './cookieStorage'\nexport * from './memoryStorage'\nexport * from './universalStorage'\nexport * from './settings'\n\n/**\n * Creates multiple storage systems from an array of StoreType and options\n * @param args StoreType and options\n * @returns Storage array\n */\nexport function initializeStorages(args: InitializeStorageArgs): Store[] {\n  const storages = args.map((s) => {\n    let type: StoreType\n    let settings\n\n    if (isStoreTypeWithSettings(s)) {\n      type = s.name\n      settings = s.settings\n    } else {\n      type = s\n    }\n\n    switch (type) {\n      case StoreType.Cookie:\n        return new CookieStorage(settings)\n      case StoreType.LocalStorage:\n        return new LocalStorage()\n      case StoreType.Memory:\n        return new MemoryStorage()\n      default:\n        throw new Error(`Unknown Store Type: ${s}`)\n    }\n  })\n  return storages\n}\n\n/**\n * Injects the CookieOptions into a the arguments for initializeStorage\n * @param storeTypes list of storeType\n * @param cookieOptions cookie Options\n * @returns arguments for initializeStorage\n */\nexport function applyCookieOptions(\n  storeTypes: StoreType[],\n  cookieOptions?: CookieOptions\n): InitializeStorageArgs {\n  return storeTypes.map((s) => {\n    if (cookieOptions && s === StoreType.Cookie) {\n      return {\n        name: s,\n        settings: cookieOptions,\n      }\n    }\n    return s\n  })\n}\n", "import { v4 as uuid } from '@lukeed/uuid'\nimport autoBind from '../../lib/bind-all'\nimport { Traits } from '../events'\nimport {\n  CookieOptions,\n  UniversalStorage,\n  MemoryStorage,\n  StorageObject,\n  StorageSettings,\n  StoreType,\n  applyCookieOptions,\n  initializeStorages,\n  isArrayOfStoreType,\n} from '../storage'\n\nexport type ID = string | null | undefined\n\nexport interface UserOptions {\n  /**\n   * Disables storing any data about the user.\n   */\n  disable?: boolean\n  localStorageFallbackDisabled?: boolean\n  persist?: boolean\n\n  cookie?: {\n    key?: string\n    oldKey?: string\n  }\n\n  localStorage?: {\n    key: string\n  }\n\n  /**\n   * Store priority\n   * @example stores: [StoreType.Cookie, StoreType.Memory]\n   */\n  storage?: StorageSettings\n}\n\nconst defaults = {\n  persist: true,\n  cookie: {\n    key: 'ajs_user_id',\n    oldKey: 'ajs_user',\n  },\n  localStorage: {\n    key: 'ajs_user_traits',\n  },\n}\n\nexport interface WithId {\n  id(id?: ID): ID\n}\n\nexport class User implements WithId {\n  static defaults = defaults\n\n  private idKey: string\n  private traitsKey: string\n  private anonKey: string\n  private cookieOptions?: CookieOptions\n\n  private legacyUserStore: UniversalStorage<{\n    [k: string]:\n      | {\n          id?: string\n          traits?: Traits\n        }\n      | string\n  }>\n  private traitsStore: UniversalStorage<{\n    [k: string]: Traits\n  }>\n\n  private identityStore: UniversalStorage<{\n    [k: string]: string\n  }>\n\n  options: UserOptions = {}\n\n  constructor(options: UserOptions = defaults, cookieOptions?: CookieOptions) {\n    this.options = { ...defaults, ...options }\n    this.cookieOptions = cookieOptions\n\n    this.idKey = options.cookie?.key ?? defaults.cookie.key\n    this.traitsKey = options.localStorage?.key ?? defaults.localStorage.key\n    this.anonKey = 'ajs_anonymous_id'\n\n    this.identityStore = this.createStorage(this.options, cookieOptions)\n\n    // using only cookies for legacy user store\n    this.legacyUserStore = this.createStorage(\n      this.options,\n      cookieOptions,\n      (s) => s === StoreType.Cookie\n    )\n\n    // using only localStorage / memory for traits store\n    this.traitsStore = this.createStorage(\n      this.options,\n      cookieOptions,\n      (s) => s !== StoreType.Cookie\n    )\n\n    const legacyUser = this.legacyUserStore.get(defaults.cookie.oldKey)\n    if (legacyUser && typeof legacyUser === 'object') {\n      legacyUser.id && this.id(legacyUser.id)\n      legacyUser.traits && this.traits(legacyUser.traits)\n    }\n    autoBind(this)\n  }\n\n  id = (id?: ID): ID => {\n    if (this.options.disable) {\n      return null\n    }\n\n    const prevId = this.identityStore.getAndSync(this.idKey)\n\n    if (id !== undefined) {\n      this.identityStore.set(this.idKey, id)\n\n      const changingIdentity = id !== prevId && prevId !== null && id !== null\n      if (changingIdentity) {\n        this.anonymousId(null)\n      }\n    }\n\n    const retId = this.identityStore.getAndSync(this.idKey)\n    if (retId) return retId\n\n    const retLeg = this.legacyUserStore.get(defaults.cookie.oldKey)\n    return retLeg ? (typeof retLeg === 'object' ? retLeg.id : retLeg) : null\n  }\n\n  private legacySIO(): [string, string] | null {\n    const val = this.legacyUserStore.get('_sio') as string\n    if (!val) {\n      return null\n    }\n    const [anon, user] = val.split('----')\n    return [anon, user]\n  }\n\n  anonymousId = (id?: ID): ID => {\n    if (this.options.disable) {\n      return null\n    }\n\n    if (id === undefined) {\n      const val =\n        this.identityStore.getAndSync(this.anonKey) ?? this.legacySIO()?.[0]\n\n      if (val) {\n        return val\n      }\n    }\n\n    if (id === null) {\n      this.identityStore.set(this.anonKey, null)\n      return this.identityStore.getAndSync(this.anonKey)\n    }\n\n    this.identityStore.set(this.anonKey, id ?? uuid())\n    return this.identityStore.getAndSync(this.anonKey)\n  }\n\n  traits = (traits?: Traits | null): Traits | undefined => {\n    if (this.options.disable) {\n      return\n    }\n\n    if (traits === null) {\n      traits = {}\n    }\n\n    if (traits) {\n      this.traitsStore.set(this.traitsKey, traits ?? {})\n    }\n\n    return this.traitsStore.get(this.traitsKey) ?? {}\n  }\n\n  identify(id?: ID, traits?: Traits): void {\n    if (this.options.disable) {\n      return\n    }\n\n    traits = traits ?? {}\n    const currentId = this.id()\n\n    if (currentId === null || currentId === id) {\n      traits = {\n        ...this.traits(),\n        ...traits,\n      }\n    }\n\n    if (id) {\n      this.id(id)\n    }\n\n    this.traits(traits)\n  }\n\n  logout(): void {\n    this.anonymousId(null)\n    this.id(null)\n    this.traits({})\n  }\n\n  reset(): void {\n    this.logout()\n    this.identityStore.clear(this.idKey)\n    this.identityStore.clear(this.anonKey)\n    this.traitsStore.clear(this.traitsKey)\n  }\n\n  load(): User {\n    return new User(this.options, this.cookieOptions)\n  }\n\n  save(): boolean {\n    return true\n  }\n\n  /**\n   * Creates the right storage system applying all the user options, cookie options and particular filters\n   * @param options UserOptions\n   * @param cookieOpts CookieOptions\n   * @param filterStores filter function to apply to any StoreTypes (skipped if options specify using a custom storage)\n   * @returns a Storage object\n   */\n  private createStorage<T extends StorageObject = StorageObject>(\n    options: UserOptions,\n    cookieOpts?: CookieOptions,\n    filterStores?: (value: StoreType) => boolean\n  ): UniversalStorage<T> {\n    let stores: StoreType[] = [\n      StoreType.LocalStorage,\n      StoreType.Cookie,\n      StoreType.Memory,\n    ]\n\n    // If disabled we won't have any storage functionality\n    if (options.disable) {\n      return new UniversalStorage<T>([])\n    }\n\n    // If persistance is disabled we will always fallback to Memory Storage\n    if (!options.persist) {\n      return new UniversalStorage<T>([new MemoryStorage<T>()])\n    }\n\n    if (options.storage !== undefined && options.storage !== null) {\n      if (isArrayOfStoreType(options.storage)) {\n        // If the user only specified order of stores we will still apply filters and transformations e.g. not using localStorage if localStorageFallbackDisabled\n        stores = options.storage.stores\n      }\n    }\n\n    // Disable LocalStorage\n    if (options.localStorageFallbackDisabled) {\n      stores = stores.filter((s) => s !== StoreType.LocalStorage)\n    }\n\n    // Apply Additional filters\n    if (filterStores) {\n      stores = stores.filter(filterStores)\n    }\n\n    return new UniversalStorage(\n      initializeStorages(applyCookieOptions(stores, cookieOpts))\n    )\n  }\n}\n\nconst groupDefaults: UserOptions = {\n  persist: true,\n  cookie: {\n    key: 'ajs_group_id',\n  },\n  localStorage: {\n    key: 'ajs_group_properties',\n  },\n}\n\nexport class Group extends User {\n  constructor(options: UserOptions = groupDefaults, cookie?: CookieOptions) {\n    super({ ...groupDefaults, ...options }, cookie)\n    autoBind(this)\n  }\n\n  anonymousId = (_id?: ID): ID => {\n    return undefined\n  }\n}\n", "/**\n *  Check if  thenable\n *  (instanceof Promise doesn't respect realms)\n */\nexport const isThenable = (value: unknown): boolean =>\n  typeof value === 'object' &&\n  value !== null &&\n  'then' in value &&\n  typeof (value as any).then === 'function'\n", "import { Analytics } from '../analytics'\nimport { Context } from '../context'\nimport { isThenable } from '../../lib/is-thenable'\nimport { AnalyticsBrowserCore } from '../analytics/interfaces'\nimport { version } from '../../generated/version'\nimport { getGlobalAnalytics } from '../../lib/global-analytics-helper'\nimport {\n  isBufferedPageContext,\n  getDefaultBufferedPageContext,\n  createPageContext,\n  BufferedPageContext,\n  PageContext,\n} from '../page'\nimport { getVersionType } from '../../lib/version-type'\n\n/**\n * The names of any AnalyticsBrowser methods that also exist on Analytics\n */\nexport type PreInitMethodName =\n  | 'screen'\n  | 'register'\n  | 'deregister'\n  | 'user'\n  | 'trackSubmit'\n  | 'trackClick'\n  | 'trackLink'\n  | 'trackForm'\n  | 'pageview'\n  | 'identify'\n  | 'reset'\n  | 'group'\n  | 'track'\n  | 'ready'\n  | 'alias'\n  | 'debug'\n  | 'page'\n  | 'once'\n  | 'off'\n  | 'on'\n  | 'addSourceMiddleware'\n  | 'setAnonymousId'\n  | 'addDestinationMiddleware'\n\n// Union of all analytics methods that _do not_ return a Promise\ntype SyncPreInitMethodName = {\n  [MethodName in PreInitMethodName]: ReturnType<\n    Analytics[MethodName]\n  > extends Promise<any>\n    ? never\n    : MethodName\n}[PreInitMethodName]\n\nconst flushSyncAnalyticsCalls = (\n  name: SyncPreInitMethodName,\n  analytics: Analytics,\n  buffer: PreInitMethodCallBuffer\n): void => {\n  buffer.getAndRemove(name).forEach((c) => {\n    // While the underlying methods are synchronous, the callAnalyticsMethod returns a promise,\n    // which normalizes success and error states between async and non-async methods, with no perf penalty.\n    callAnalyticsMethod(analytics, c).catch(console.error)\n  })\n}\n\nexport const flushAddSourceMiddleware = async (\n  analytics: Analytics,\n  buffer: PreInitMethodCallBuffer\n) => {\n  for (const c of buffer.getAndRemove('addSourceMiddleware')) {\n    await callAnalyticsMethod(analytics, c).catch(console.error)\n  }\n}\n\n/**\n *  Flush register plugin\n */\nexport const flushRegister = async (\n  analytics: Analytics,\n  buffer: PreInitMethodCallBuffer\n) => {\n  for (const c of buffer.getAndRemove('register')) {\n    await callAnalyticsMethod(analytics, c).catch(console.error)\n  }\n}\n\nexport const flushOn = flushSyncAnalyticsCalls.bind(this, 'on')\n\nexport const flushSetAnonymousID = flushSyncAnalyticsCalls.bind(\n  this,\n  'setAnonymousId'\n)\n\nexport const flushAnalyticsCallsInNewTask = (\n  analytics: Analytics,\n  buffer: PreInitMethodCallBuffer\n): void => {\n  ;(Object.keys(buffer.calls) as (keyof typeof buffer.calls)[]).forEach((m) => {\n    buffer.getAndRemove(m).forEach((c) => {\n      // No one remembers why this event loop optimization is/was neccessary. Lost to history.\n      setTimeout(() => {\n        callAnalyticsMethod(analytics, c).catch(console.error)\n      }, 0)\n    })\n  })\n}\n\nexport const popPageContext = (args: unknown[]): PageContext | undefined => {\n  if (hasBufferedPageContextAsLastArg(args)) {\n    const ctx = args.pop() as BufferedPageContext\n    return createPageContext(ctx)\n  }\n}\n\nexport const hasBufferedPageContextAsLastArg = (\n  args: unknown[]\n): args is [...unknown[], BufferedPageContext] | [BufferedPageContext] => {\n  const lastArg = args[args.length - 1]\n  return isBufferedPageContext(lastArg)\n}\n\n/**\n *  Represents a buffered method call that occurred before initialization.\n */\nexport class PreInitMethodCall<\n  MethodName extends PreInitMethodName = PreInitMethodName\n> {\n  method: MethodName\n  args: PreInitMethodParams<MethodName>\n  called: boolean\n  resolve: (v: ReturnType<Analytics[MethodName]>) => void\n  reject: (reason: any) => void\n  constructor(\n    method: PreInitMethodCall<MethodName>['method'],\n    args: PreInitMethodParams<MethodName>,\n    resolve: PreInitMethodCall<MethodName>['resolve'] = () => {},\n    reject: PreInitMethodCall<MethodName>['reject'] = console.error\n  ) {\n    this.method = method\n    this.resolve = resolve\n    this.reject = reject\n    this.called = false\n    this.args = args\n  }\n}\n\nexport type PreInitMethodParams<MethodName extends PreInitMethodName> =\n  | [...Parameters<Analytics[MethodName]>, BufferedPageContext]\n  | Parameters<Analytics[MethodName]>\n\n/**\n * Infer return type; if return type is promise, unwrap it.\n */\ntype ReturnTypeUnwrap<Fn> = Fn extends (...args: any[]) => infer ReturnT\n  ? ReturnT extends PromiseLike<infer Unwrapped>\n    ? Unwrapped\n    : ReturnT\n  : never\n\ntype MethodCallMap = Partial<Record<PreInitMethodName, PreInitMethodCall[]>>\n\ntype SnippetWindowBufferedMethodCall<\n  MethodName extends PreInitMethodName = PreInitMethodName\n> = [MethodName, ...PreInitMethodParams<MethodName>]\n\n/**\n * A list of the method calls before initialization for snippet users\n * For example, [[\"track\", \"foo\", {bar: 123}], [\"page\"], [\"on\", \"ready\", function(){..}]\n */\ntype SnippetBuffer = SnippetWindowBufferedMethodCall[]\n\n/**\n *  Represents any and all the buffered method calls that occurred before initialization.\n */\nexport class PreInitMethodCallBuffer {\n  private _callMap: MethodCallMap = {}\n\n  constructor(...calls: PreInitMethodCall[]) {\n    this.add(...calls)\n  }\n\n  /**\n   * Pull any buffered method calls from the window object, and use them to hydrate the instance buffer.\n   */\n  public get calls() {\n    this._pushSnippetWindowBuffer()\n    return this._callMap\n  }\n\n  private set calls(calls: MethodCallMap) {\n    this._callMap = calls\n  }\n\n  get<T extends PreInitMethodName>(methodName: T): PreInitMethodCall<T>[] {\n    return (this.calls[methodName] ?? []) as PreInitMethodCall<T>[]\n  }\n\n  /**\n   * Get all buffered method calls for a given method name, and clear them from the buffer.\n   */\n  getAndRemove<T extends PreInitMethodName>(\n    methodName: T\n  ): PreInitMethodCall<T>[] {\n    const calls = this.get(methodName)\n    this.calls[methodName] = []\n    return calls\n  }\n\n  add(...calls: PreInitMethodCall[]): void {\n    calls.forEach((call) => {\n      const eventsExpectingPageContext: PreInitMethodName[] = [\n        'track',\n        'screen',\n        'alias',\n        'group',\n        'page',\n        'identify',\n      ]\n      if (\n        eventsExpectingPageContext.includes(call.method) &&\n        !hasBufferedPageContextAsLastArg(call.args)\n      ) {\n        call.args = [...call.args, getDefaultBufferedPageContext()]\n      }\n\n      if (this.calls[call.method]) {\n        this.calls[call.method]!.push(call)\n      } else {\n        this.calls[call.method] = [call]\n      }\n    })\n  }\n\n  clear(): void {\n    // clear calls in the global snippet buffered array.\n    this._pushSnippetWindowBuffer()\n    // clear calls in this instance\n    this.calls = {}\n  }\n\n  toArray(): PreInitMethodCall[] {\n    return ([] as PreInitMethodCall[]).concat(...Object.values(this.calls))\n  }\n\n  /**\n   * Fetch the buffered method calls from the window object,\n   * normalize them, and use them to hydrate the buffer.\n   * This removes existing buffered calls from the window object.\n   */\n  private _pushSnippetWindowBuffer(): void {\n    // if this is the npm version, we don't want to read from the window object.\n    // This avoids namespace conflicts if there is a seperate analytics library on the page.\n    if (getVersionType() === 'npm') {\n      return undefined\n    }\n    const wa = getGlobalAnalytics()\n    if (!Array.isArray(wa)) return undefined\n    const buffered: SnippetBuffer = wa.splice(0, wa.length)\n    const calls = buffered.map(\n      ([methodName, ...args]) => new PreInitMethodCall(methodName, args)\n    )\n    this.add(...calls)\n  }\n}\n\n/**\n *  Call method and mark as \"called\"\n *  This function should never throw an error\n */\nexport async function callAnalyticsMethod<T extends PreInitMethodName>(\n  analytics: Analytics,\n  call: PreInitMethodCall<T>\n): Promise<void> {\n  try {\n    if (call.called) {\n      return undefined\n    }\n    call.called = true\n\n    const result: ReturnType<Analytics[T]> = (\n      analytics[call.method] as Function\n    )(...call.args)\n\n    if (isThenable(result)) {\n      // do not defer for non-async methods\n      await result\n    }\n\n    call.resolve(result)\n  } catch (err) {\n    call.reject(err)\n  }\n}\n\nexport type AnalyticsLoader = (\n  preInitBuffer: PreInitMethodCallBuffer\n) => Promise<[Analytics, Context]>\n\nexport class AnalyticsBuffered\n  implements PromiseLike<[Analytics, Context]>, AnalyticsBrowserCore\n{\n  instance?: Analytics\n  ctx?: Context\n  private _preInitBuffer: PreInitMethodCallBuffer\n  private _promise: Promise<[Analytics, Context]>\n  constructor(loader: AnalyticsLoader) {\n    this._preInitBuffer = new PreInitMethodCallBuffer()\n    this._promise = loader(this._preInitBuffer)\n    this._promise\n      .then(([ajs, ctx]) => {\n        this.instance = ajs\n        this.ctx = ctx\n      })\n      .catch(() => {\n        // intentionally do nothing...\n        // this result of this promise will be caught by the 'catch' block on this class.\n      })\n  }\n\n  then<T1, T2 = never>(\n    ...args: [\n      onfulfilled:\n        | ((instance: [Analytics, Context]) => T1 | PromiseLike<T1>)\n        | null\n        | undefined,\n      onrejected?: (reason: unknown) => T2 | PromiseLike<T2>\n    ]\n  ) {\n    return this._promise.then(...args)\n  }\n\n  catch<TResult = never>(\n    ...args: [\n      onrejected?:\n        | ((reason: any) => TResult | PromiseLike<TResult>)\n        | undefined\n        | null\n    ]\n  ) {\n    return this._promise.catch(...args)\n  }\n\n  finally(...args: [onfinally?: (() => void) | undefined | null]) {\n    return this._promise.finally(...args)\n  }\n\n  trackSubmit = this._createMethod('trackSubmit')\n  trackClick = this._createMethod('trackClick')\n  trackLink = this._createMethod('trackLink')\n  pageView = this._createMethod('pageview')\n  identify = this._createMethod('identify')\n  reset = this._createMethod('reset')\n  group = this._createMethod('group') as AnalyticsBrowserCore['group']\n  track = this._createMethod('track')\n  ready = this._createMethod('ready')\n  alias = this._createMethod('alias')\n  debug = this._createChainableMethod('debug')\n  page = this._createMethod('page')\n  once = this._createChainableMethod('once')\n  off = this._createChainableMethod('off')\n  on = this._createChainableMethod('on')\n  addSourceMiddleware = this._createMethod('addSourceMiddleware')\n  setAnonymousId = this._createMethod('setAnonymousId')\n  addDestinationMiddleware = this._createMethod('addDestinationMiddleware')\n\n  screen = this._createMethod('screen')\n  register = this._createMethod('register')\n  deregister = this._createMethod('deregister')\n  user = this._createMethod('user')\n  readonly VERSION = version\n\n  private _createMethod<T extends PreInitMethodName>(methodName: T) {\n    return (\n      ...args: Parameters<Analytics[T]>\n    ): Promise<ReturnTypeUnwrap<Analytics[T]>> => {\n      if (this.instance) {\n        const result = (this.instance[methodName] as Function)(...args)\n        return Promise.resolve(result)\n      }\n      return new Promise((resolve, reject) => {\n        this._preInitBuffer.add(\n          new PreInitMethodCall(methodName, args, resolve as any, reject)\n        )\n      })\n    }\n  }\n\n  /**\n   *  These are for methods that where determining when the method gets \"flushed\" is not important.\n   *  These methods will resolve when analytics is fully initialized, and return type (other than Analytics)will not be available.\n   */\n  private _createChainableMethod<T extends PreInitMethodName>(methodName: T) {\n    return (...args: Parameters<Analytics[T]>): AnalyticsBuffered => {\n      if (this.instance) {\n        void (this.instance[methodName] as Function)(...args)\n        return this\n      } else {\n        this._preInitBuffer.add(new PreInitMethodCall(methodName, args))\n      }\n\n      return this\n    }\n  }\n}\n", "/**\n * Register event listener on document that fires when:\n * * tab change or tab close (in mobile or desktop)\n * * click back / forward button\n * * click any link or perform any other navigation action\n * * soft refresh / hard refresh\n *\n * adapted from https://stackoverflow.com/questions/3239834/window-onbeforeunload-not-working-on-the-ipad/52864508#52864508,\n */\nexport const onPageChange = (cb: (unloaded: boolean) => void) => {\n  let unloaded = false // prevents double firing if both are supported\n\n  window.addEventListener('pagehide', () => {\n    if (unloaded) return\n    unloaded = true\n    cb(unloaded)\n  })\n\n  // using document instead of window because of bug affecting browsers before safari 14 (detail in footnotes https://caniuse.com/?search=visibilitychange)\n  document.addEventListener('visibilitychange', () => {\n    if (document.visibilityState == 'hidden') {\n      if (unloaded) return\n      unloaded = true\n    } else {\n      unloaded = false\n    }\n    cb(unloaded)\n  })\n}\n", "export class RateLimitError extends Error {\n  retryTimeout: number\n\n  constructor(message: string, retryTimeout: number) {\n    super(message)\n    this.retryTimeout = retryTimeout\n    this.name = 'RateLimitError'\n  }\n}\n", "export const createHeaders = (\n  headerSettings: AdditionalHeaders | undefined\n): Record<string, string> => {\n  return {\n    'Content-Type': 'text/plain',\n    ...(typeof headerSettings === 'function'\n      ? headerSettings()\n      : headerSettings),\n  }\n}\n\n/**\n * Additional headers to be sent with the request.\n * Default is `Content-Type: text/plain`. This can be overridden.\n * If a function is provided, it will be called before each request.\n */\nexport type AdditionalHeaders =\n  | Record<string, string>\n  | (() => Record<string, string>)\n\nexport type RequestPriority = 'high' | 'low' | 'auto'\nexport type RequestCredentials = 'include' | 'same-origin' | 'omit'\n\n/**\n * These are the options that can be passed to the fetch dispatcher.\n * They more/less map to the Fetch RequestInit type.\n */\ninterface DispatchFetchConfig {\n  /**\n   * Request credentials configuration\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Request/credentials\n   */\n  credentials?: RequestCredentials\n  /**\n   * This is useful for ensuring that an event is sent even if the user navigates away from the page.\n   * However, it may increase the likelihood of events being lost, as there is a 64kb limit for *all* fetch requests (not just ones to segment) with keepalive (which is why it's disabled by default). So, if you're sending a lot of data, this will likely cause events to be dropped.\n\n   * @default false\n   */\n  keepalive?: boolean\n  /**\n   * Additional headers to be sent with the request.\n   * Default is `Content-Type: text/plain`. This can be overridden.\n   * If a function is provided, it will be called before each request.\n   * @example { 'Content-Type': 'application/json' } or () => { 'Content-Type': 'application/json' }\n   */\n  headers?: AdditionalHeaders\n  /**\n   * 'Request Priority' of the request\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/RequestInit#priority\n   */\n  priority?: RequestPriority\n}\n\nexport interface BatchingDispatchConfig extends DispatchFetchConfig {\n  /**\n   * If strategy = 'batching', the maximum number of events to send in a single request. If the batch reaches this size, a request will automatically be sent.\n   *\n   * @default 10\n   */\n  size?: number\n  /**\n   * If strategy = 'batching', the maximum time, in milliseconds, to wait before sending a request.\n   * This won't alaways be relevant, as the request will be sent when the size is reached.\n   * However, if the size is never reached, the request will be sent after this time.\n   * When it comes to retries, if there is a rate limit timeout header, that will be respected over the value here.\n   *\n   * @default 5000\n   */\n  timeout?: number\n  /**\n   * If strategy = 'batching', the maximum number of retries to attempt before giving up.\n   * @default 10\n   */\n  maxRetries?: number\n}\n\nexport interface StandardDispatcherConfig extends DispatchFetchConfig {}\n\nexport type DeliveryStrategy =\n  | {\n      strategy?: 'standard'\n      config: StandardDispatcherConfig\n    }\n  | {\n      strategy: 'batching'\n      config?: BatchingDispatchConfig\n    }\n", "import { SegmentEvent } from '../../core/events'\nimport { fetch } from '../../lib/fetch'\nimport { onPageChange } from '../../lib/on-page-change'\nimport { SegmentFacade } from '../../lib/to-facade'\nimport { RateLimitError } from './ratelimit-error'\nimport { Context } from '../../core/context'\nimport { BatchingDispatchConfig, createHeaders } from './shared-dispatcher'\n\nconst MAX_PAYLOAD_SIZE = 500\nconst MAX_KEEPALIVE_SIZE = 64\n\nfunction kilobytes(buffer: unknown): number {\n  const size = encodeURI(JSON.stringify(buffer)).split(/%..|./).length - 1\n  return size / 1024\n}\n\n/**\n * Checks if the payload is over or close to\n * the maximum payload size allowed by tracking\n * API.\n */\nfunction approachingTrackingAPILimit(buffer: unknown): boolean {\n  return kilobytes(buffer) >= MAX_PAYLOAD_SIZE - 50\n}\n\n/**\n * Checks if payload is over or approaching the limit for keepalive\n * requests. If keepalive is enabled we want to avoid\n * going over this to prevent data loss.\n */\nfunction passedKeepaliveLimit(buffer: unknown): boolean {\n  return kilobytes(buffer) >= MAX_KEEPALIVE_SIZE - 10\n}\n\nfunction chunks(batch: object[]): Array<object[]> {\n  const result: object[][] = []\n  let index = 0\n\n  batch.forEach((item) => {\n    const size = kilobytes(result[index])\n    if (size >= 64) {\n      index++\n    }\n\n    if (result[index]) {\n      result[index].push(item)\n    } else {\n      result[index] = [item]\n    }\n  })\n\n  return result\n}\n\nexport default function batch(\n  apiHost: string,\n  config?: BatchingDispatchConfig\n) {\n  let buffer: object[] = []\n  let pageUnloaded = false\n\n  const limit = config?.size ?? 10\n  const timeout = config?.timeout ?? 5000\n  let rateLimitTimeout = 0\n\n  function sendBatch(batch: object[]) {\n    if (batch.length === 0) {\n      return\n    }\n\n    const writeKey = (batch[0] as SegmentEvent)?.writeKey\n\n    // Remove sentAt from every event as batching only needs a single timestamp\n    const updatedBatch = batch.map((event) => {\n      const { sentAt, ...newEvent } = event as SegmentEvent\n      return newEvent\n    })\n\n    return fetch(`https://${apiHost}/b`, {\n      credentials: config?.credentials,\n      keepalive: config?.keepalive || pageUnloaded,\n      headers: createHeaders(config?.headers),\n      method: 'post',\n      body: JSON.stringify({\n        writeKey,\n        batch: updatedBatch,\n        sentAt: new Date().toISOString(),\n      }),\n      // @ts-ignore - not in the ts lib yet\n      priority: config?.priority,\n    }).then((res) => {\n      if (res.status >= 500) {\n        throw new Error(`Bad response from server: ${res.status}`)\n      }\n      if (res.status === 429) {\n        const retryTimeoutStringSecs = res.headers?.get('x-ratelimit-reset')\n        const retryTimeoutMS =\n          typeof retryTimeoutStringSecs == 'string'\n            ? parseInt(retryTimeoutStringSecs) * 1000\n            : timeout\n        throw new RateLimitError(\n          `Rate limit exceeded: ${res.status}`,\n          retryTimeoutMS\n        )\n      }\n    })\n  }\n\n  async function flush(attempt = 1): Promise<unknown> {\n    if (buffer.length) {\n      const batch = buffer\n      buffer = []\n      return sendBatch(batch)?.catch((error) => {\n        const ctx = Context.system()\n        ctx.log('error', 'Error sending batch', error)\n        if (attempt <= (config?.maxRetries ?? 10)) {\n          if (error.name === 'RateLimitError') {\n            rateLimitTimeout = error.retryTimeout\n          }\n          buffer.push(...batch)\n          buffer.map((event) => {\n            if ('_metadata' in event) {\n              const segmentEvent = event as ReturnType<SegmentFacade['json']>\n              segmentEvent._metadata = {\n                ...segmentEvent._metadata,\n                retryCount: attempt,\n              }\n            }\n          })\n          scheduleFlush(attempt + 1)\n        }\n      })\n    }\n  }\n\n  let schedule: NodeJS.Timeout | undefined\n\n  function scheduleFlush(attempt = 1): void {\n    if (schedule) {\n      return\n    }\n\n    schedule = setTimeout(\n      () => {\n        schedule = undefined\n        flush(attempt).catch(console.error)\n      },\n      rateLimitTimeout ? rateLimitTimeout : timeout\n    )\n    rateLimitTimeout = 0\n  }\n\n  onPageChange((unloaded) => {\n    pageUnloaded = unloaded\n\n    if (pageUnloaded && buffer.length) {\n      const reqs = chunks(buffer).map(sendBatch)\n      Promise.all(reqs).catch(console.error)\n    }\n  })\n\n  async function dispatch(_url: string, body: object): Promise<unknown> {\n    buffer.push(body)\n\n    const bufferOverflow =\n      buffer.length >= limit ||\n      approachingTrackingAPILimit(buffer) ||\n      (config?.keepalive && passedKeepaliveLimit(buffer))\n\n    return bufferOverflow || pageUnloaded ? flush() : scheduleFlush()\n  }\n\n  return {\n    dispatch,\n  }\n}\n", "import { fetch } from '../../lib/fetch'\nimport { RateLimitError } from './ratelimit-error'\nimport { createHeaders, StandardDispatcherConfig } from './shared-dispatcher'\nexport type Dispatcher = (url: string, body: object) => Promise<unknown>\n\nexport default function (config?: StandardDispatcherConfig): {\n  dispatch: Dispatcher\n} {\n  function dispatch(url: string, body: object): Promise<unknown> {\n    return fetch(url, {\n      credentials: config?.credentials,\n      keepalive: config?.keepalive,\n      headers: createHeaders(config?.headers),\n      method: 'post',\n      body: JSON.stringify(body),\n      // @ts-ignore - not in the ts lib yet\n      priority: config?.priority,\n    }).then((res) => {\n      if (res.status >= 500) {\n        throw new Error(`Bad response from server: ${res.status}`)\n      }\n      if (res.status === 429) {\n        const retryTimeoutStringSecs = res.headers?.get('x-ratelimit-reset')\n        const retryTimeoutMS = retryTimeoutStringSecs\n          ? parseInt(retryTimeoutStringSecs) * 1000\n          : 5000\n        throw new RateLimitError(\n          `Rate limit exceeded: ${res.status}`,\n          retryTimeoutMS\n        )\n      }\n    })\n  }\n\n  return {\n    dispatch,\n  }\n}\n", "import { Analytics } from '../../core/analytics'\nimport { CDNSettings } from '../../browser'\nimport { SegmentFacade } from '../../lib/to-facade'\nimport { SegmentioSettings } from './index'\nimport { Context } from '../../core/context'\n\nexport function normalize(\n  analytics: Analytics,\n  json: ReturnType<SegmentFacade['json']>,\n  settings?: SegmentioSettings,\n  integrations?: CDNSettings['integrations'],\n  ctx?: Context\n): object {\n  const user = analytics.user()\n\n  delete json.options\n\n  json.writeKey = settings?.apiKey\n\n  json.userId = json.userId || user.id()\n  json.anonymousId = json.anonymousId || user.anonymousId()\n\n  json.sentAt = new Date()\n\n  const failed = analytics.queue.failedInitializations || []\n  if (failed.length > 0) {\n    json._metadata = { failedInitializations: failed }\n  }\n\n  if (ctx != null) {\n    if (ctx.attempts > 1) {\n      json._metadata = {\n        ...json._metadata,\n        retryCount: ctx.attempts,\n      }\n    }\n    ctx.attempts++\n  }\n\n  const bundled: string[] = []\n  const unbundled: string[] = []\n\n  for (const key in integrations) {\n    const integration = integrations[key]\n    if (key === 'Segment.io') {\n      bundled.push(key)\n    }\n    if (integration.bundlingStatus === 'bundled') {\n      bundled.push(key)\n    }\n    if (integration.bundlingStatus === 'unbundled') {\n      unbundled.push(key)\n    }\n  }\n\n  // This will make sure that the disabled cloud mode destinations will be\n  // included in the unbundled list.\n  for (const settingsUnbundled of settings?.unbundledIntegrations || []) {\n    if (!unbundled.includes(settingsUnbundled)) {\n      unbundled.push(settingsUnbundled)\n    }\n  }\n\n  const configIds = settings?.maybeBundledConfigIds ?? {}\n  const bundledConfigIds: string[] = []\n\n  bundled.sort().forEach((name) => {\n    ;(configIds[name] ?? []).forEach((id) => {\n      bundledConfigIds.push(id)\n    })\n  })\n\n  if (settings?.addBundledMetadata !== false) {\n    json._metadata = {\n      ...json._metadata,\n      bundled: bundled.sort(),\n      unbundled: unbundled.sort(),\n      bundledIds: bundledConfigIds,\n    }\n  }\n\n  return json\n}\n", "import { isOffline } from '../../core/connection'\nimport { Context } from '../../core/context'\nimport { Plugin } from '../../core/plugin'\nimport { attempt } from '@segment/analytics-core'\nimport { pWhile } from '../../lib/p-while'\nimport { PriorityQueue } from '../../lib/priority-queue'\n\nasync function flushQueue(\n  xt: Plugin,\n  queue: PriorityQueue<Context>\n): Promise<PriorityQueue<Context>> {\n  const failedQueue: Context[] = []\n  if (isOffline()) {\n    return queue\n  }\n\n  await pWhile(\n    () => queue.length > 0 && !isOffline(),\n    async () => {\n      const ctx = queue.pop()\n      if (!ctx) {\n        return\n      }\n\n      const result = await attempt(ctx, xt)\n      const success = result instanceof Context\n      if (!success) {\n        failedQueue.push(ctx)\n      }\n    }\n  )\n  // re-add failed tasks\n  failedQueue.map((failed) => queue.pushWithBackoff(failed))\n  return queue\n}\n\nexport function scheduleFlush(\n  flushing: boolean,\n  buffer: PriorityQueue<Context>,\n  xt: Plugin,\n  scheduleFlush: Function\n): void {\n  if (flushing) {\n    return\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-misused-promises\n  setTimeout(async () => {\n    let isFlushing = true\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    const newBuffer = await flushQueue(xt, buffer)\n    isFlushing = false\n\n    if (buffer.todo > 0) {\n      scheduleFlush(isFlushing, newBuffer, xt, scheduleFlush)\n    }\n  }, Math.random() * 5000)\n}\n", "import { Facade } from '@segment/facade'\nimport { Analytics } from '../../core/analytics'\nimport { CDNSettings } from '../../browser'\nimport { isOffline } from '../../core/connection'\nimport { Context } from '../../core/context'\nimport { Plugin } from '../../core/plugin'\nimport { PriorityQueue } from '../../lib/priority-queue'\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted'\nimport { toFacade } from '../../lib/to-facade'\nimport batch from './batched-dispatcher'\nimport standard from './fetch-dispatcher'\nimport { normalize } from './normalize'\nimport { scheduleFlush } from './schedule-flush'\nimport { SEGMENT_API_HOST } from '../../core/constants'\nimport { DeliveryStrategy } from './shared-dispatcher'\n\nexport type SegmentioSettings = {\n  apiKey: string\n  apiHost?: string\n  protocol?: 'http' | 'https'\n\n  addBundledMetadata?: boolean\n  unbundledIntegrations?: string[]\n  bundledConfigIds?: string[]\n  unbundledConfigIds?: string[]\n\n  maybeBundledConfigIds?: Record<string, string[]>\n\n  deliveryStrategy?: DeliveryStrategy\n}\n\ntype JSON = ReturnType<Facade['json']>\n\nfunction onAlias(analytics: Analytics, json: JSON): JSON {\n  const user = analytics.user()\n  json.previousId =\n    json.previousId ?? json.from ?? user.id() ?? user.anonymousId()\n  json.userId = json.userId ?? json.to\n  delete json.from\n  delete json.to\n  return json\n}\n\nexport type SegmentIOPluginMetadata = {\n  writeKey: string\n  apiHost: string\n  protocol: string\n}\nexport interface SegmentIOPlugin extends Plugin {\n  metadata: SegmentIOPluginMetadata\n}\n\nexport const isSegmentPlugin = (plugin: Plugin): plugin is SegmentIOPlugin => {\n  return plugin.name === 'Segment.io'\n}\n\nexport function segmentio(\n  analytics: Analytics,\n  settings?: SegmentioSettings,\n  integrations?: CDNSettings['integrations']\n): Plugin {\n  // Attach `pagehide` before buffer is created so that inflight events are added\n  // to the buffer before the buffer persists events in its own `pagehide` handler.\n  window.addEventListener('pagehide', () => {\n    buffer.push(...Array.from(inflightEvents))\n    inflightEvents.clear()\n  })\n\n  const writeKey = settings?.apiKey ?? ''\n\n  const buffer = analytics.options.disableClientPersistence\n    ? new PriorityQueue<Context>(analytics.queue.queue.maxAttempts, [])\n    : new PersistedPriorityQueue(\n        analytics.queue.queue.maxAttempts,\n        `${writeKey}:dest-Segment.io`\n      )\n\n  const inflightEvents = new Set<Context>()\n  const flushing = false\n\n  const apiHost = settings?.apiHost ?? SEGMENT_API_HOST\n  const protocol = settings?.protocol ?? 'https'\n  const remote = `${protocol}://${apiHost}`\n\n  const deliveryStrategy = settings?.deliveryStrategy\n  const client =\n    deliveryStrategy &&\n    'strategy' in deliveryStrategy &&\n    deliveryStrategy.strategy === 'batching'\n      ? batch(apiHost, deliveryStrategy.config)\n      : standard(deliveryStrategy?.config)\n\n  async function send(ctx: Context): Promise<Context> {\n    if (isOffline()) {\n      buffer.push(ctx)\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      scheduleFlush(flushing, buffer, segmentio, scheduleFlush)\n      return ctx\n    }\n\n    inflightEvents.add(ctx)\n\n    const path = ctx.event.type.charAt(0)\n\n    let json = toFacade(ctx.event).json()\n\n    if (ctx.event.type === 'track') {\n      delete json.traits\n    }\n\n    if (ctx.event.type === 'alias') {\n      json = onAlias(analytics, json)\n    }\n\n    if (buffer.getAttempts(ctx) >= buffer.maxAttempts) {\n      inflightEvents.delete(ctx)\n      return ctx\n    }\n\n    return client\n      .dispatch(\n        `${remote}/${path}`,\n        normalize(analytics, json, settings, integrations, ctx)\n      )\n      .then(() => ctx)\n      .catch((error) => {\n        ctx.log('error', 'Error sending event', error)\n        if (error.name === 'RateLimitError') {\n          const timeout = error.retryTimeout\n          buffer.pushWithBackoff(ctx, timeout)\n        } else {\n          buffer.pushWithBackoff(ctx)\n        }\n        // eslint-disable-next-line @typescript-eslint/no-use-before-define\n        scheduleFlush(flushing, buffer, segmentio, scheduleFlush)\n        return ctx\n      })\n      .finally(() => {\n        inflightEvents.delete(ctx)\n      })\n  }\n\n  const segmentio: SegmentIOPlugin = {\n    metadata: {\n      writeKey,\n      apiHost,\n      protocol,\n    },\n    name: 'Segment.io',\n    type: 'destination',\n    version: '0.1.0',\n    isLoaded: (): boolean => true,\n    load: (): Promise<void> => Promise.resolve(),\n    track: send,\n    identify: send,\n    page: send,\n    alias: send,\n    group: send,\n    screen: send,\n  }\n\n  // Buffer may already have items if they were previously stored in localStorage.\n  // Start flushing them immediately.\n  if (buffer.todo) {\n    scheduleFlush(flushing, buffer, segmentio, scheduleFlush)\n  }\n\n  return segmentio\n}\n", "import {\n  AliasParams,\n  DispatchedEvent,\n  EventParams,\n  GroupParams,\n  PageParams,\n  resolveAliasArguments,\n  resolveArguments,\n  resolvePageArguments,\n  resolveUserArguments,\n  IdentifyParams,\n} from '../arguments-resolver'\nimport type { FormArgs, LinkArgs } from '../auto-track'\nimport { isOffline } from '../connection'\nimport { Context } from '../context'\nimport { dispatch } from '@segment/analytics-core'\nimport { Emitter } from '@segment/analytics-generic-utils'\nimport {\n  Callback,\n  EventFactory,\n  EventProperties,\n  SegmentEvent,\n} from '../events'\nimport { isDestinationPluginWithAddMiddleware, Plugin } from '../plugin'\nimport { EventQueue } from '../queue/event-queue'\nimport { Group, ID, User } from '../user'\nimport autoBind from '../../lib/bind-all'\nimport { PersistedPriorityQueue } from '../../lib/priority-queue/persisted'\nimport type { LegacyIntegration } from '../../plugins/ajs-destination/types'\nimport type {\n  DestinationMiddlewareFunction,\n  MiddlewareFunction,\n} from '../../plugins/middleware'\nimport { version } from '../../generated/version'\nimport { PriorityQueue } from '../../lib/priority-queue'\nimport { getGlobal } from '../../lib/get-global'\nimport { AnalyticsClassic, AnalyticsCore } from './interfaces'\nimport type { CDNSettings } from '../../browser'\nimport {\n  CookieOptions,\n  MemoryStorage,\n  UniversalStorage,\n  StoreType,\n  applyCookieOptions,\n  initializeStorages,\n  isArrayOfStoreType,\n} from '../storage'\nimport { setGlobalAnalytics } from '../../lib/global-analytics-helper'\nimport { popPageContext } from '../buffer'\nimport {\n  isSegmentPlugin,\n  SegmentIOPluginMetadata,\n} from '../../plugins/segmentio'\nimport {\n  AnalyticsSettings,\n  IntegrationsInitOptions,\n  InitOptions,\n} from '../../browser/settings'\n\nexport type { InitOptions, AnalyticsSettings }\n\nconst deprecationWarning =\n  'This is being deprecated and will be not be available in future releases of Analytics JS'\n\n// reference any pre-existing \"analytics\" object so a user can restore the reference\nconst global: any = getGlobal()\nconst _analytics = global?.analytics\n\nfunction createDefaultQueue(\n  name: string,\n  retryQueue = false,\n  disablePersistance = false\n) {\n  const maxAttempts = retryQueue ? 10 : 1\n  const priorityQueue = disablePersistance\n    ? new PriorityQueue(maxAttempts, [])\n    : new PersistedPriorityQueue(maxAttempts, name)\n  return new EventQueue(priorityQueue)\n}\n\n/**\n * The public settings that are set on the analytics instance\n */\nexport class AnalyticsInstanceSettings {\n  readonly writeKey: string\n  /**\n   * This is an unstable API, it may change in the future without warning.\n   */\n  readonly cdnSettings: CDNSettings\n  readonly cdnURL?: string\n  get apiHost(): string | undefined {\n    return this._getSegmentPluginMetadata?.()?.apiHost\n  }\n  private _getSegmentPluginMetadata?: () => SegmentIOPluginMetadata | undefined\n\n  /**\n   * Auto-track specific timeout setting for legacy purposes.\n   */\n  timeout = 300\n\n  constructor(settings: AnalyticsSettings, queue: EventQueue) {\n    this._getSegmentPluginMetadata = () =>\n      queue.plugins.find(isSegmentPlugin)?.metadata\n    this.writeKey = settings.writeKey\n\n    // this is basically just to satisfy typescript / so we don't need to change the function sig of every test.\n    // when loadAnalytics is called, cdnSettings will always be available.\n    const emptyCDNSettings: CDNSettings = {\n      integrations: {\n        'Segment.io': {\n          apiKey: '',\n        },\n      },\n    }\n    this.cdnSettings = settings.cdnSettings ?? emptyCDNSettings\n    this.cdnURL = settings.cdnURL\n  }\n}\n\n/* analytics-classic stubs */\nfunction _stub(this: never) {\n  console.warn(deprecationWarning)\n}\n\nexport class Analytics\n  extends Emitter\n  implements AnalyticsCore, AnalyticsClassic\n{\n  settings: AnalyticsInstanceSettings\n  private _user: User\n  private _group: Group\n  private eventFactory: EventFactory\n  private _debug = false\n  private _universalStorage: UniversalStorage\n\n  initialized = false\n  integrations: IntegrationsInitOptions\n  options: InitOptions\n  queue: EventQueue\n\n  constructor(\n    settings: AnalyticsSettings,\n    options?: InitOptions,\n    queue?: EventQueue,\n    user?: User,\n    group?: Group\n  ) {\n    super()\n    const cookieOptions = options?.cookie\n    const disablePersistance = options?.disableClientPersistence ?? false\n\n    this.queue =\n      queue ??\n      createDefaultQueue(\n        `${settings.writeKey}:event-queue`,\n        options?.retryQueue,\n        disablePersistance\n      )\n    this.settings = new AnalyticsInstanceSettings(settings, this.queue)\n\n    const storageSetting = options?.storage\n    this._universalStorage = this.createStore(\n      disablePersistance,\n      storageSetting,\n      cookieOptions\n    )\n\n    this._user =\n      user ??\n      new User(\n        {\n          persist: !disablePersistance,\n          storage: options?.storage,\n          // Any User specific options override everything else\n          ...options?.user,\n        },\n        cookieOptions\n      ).load()\n    this._group =\n      group ??\n      new Group(\n        {\n          persist: !disablePersistance,\n          storage: options?.storage,\n          // Any group specific options override everything else\n          ...options?.group,\n        },\n        cookieOptions\n      ).load()\n    this.eventFactory = new EventFactory(this._user)\n    this.integrations = options?.integrations ?? {}\n    this.options = options ?? {}\n    autoBind(this)\n  }\n\n  user = (): User => {\n    return this._user\n  }\n\n  /**\n   * Creates the storage system based on the settings received\n   * @returns Storage\n   */\n  private createStore(\n    disablePersistance: boolean,\n    storageSetting: InitOptions['storage'],\n    cookieOptions?: CookieOptions | undefined\n  ): UniversalStorage {\n    // DisablePersistance option overrides all, no storage will be used outside of memory even if specified\n    if (disablePersistance) {\n      return new UniversalStorage([new MemoryStorage()])\n    } else {\n      if (storageSetting) {\n        if (isArrayOfStoreType(storageSetting)) {\n          // We will create the store with the priority for customer settings\n          return new UniversalStorage(\n            initializeStorages(\n              applyCookieOptions(storageSetting.stores, cookieOptions)\n            )\n          )\n        }\n      }\n    }\n    // We default to our multi storage with priority\n    return new UniversalStorage(\n      initializeStorages([\n        StoreType.LocalStorage,\n        {\n          name: StoreType.Cookie,\n          settings: cookieOptions,\n        },\n        StoreType.Memory,\n      ])\n    )\n  }\n\n  get storage(): UniversalStorage {\n    return this._universalStorage\n  }\n\n  async track(...args: EventParams): Promise<DispatchedEvent> {\n    const pageCtx = popPageContext(args)\n    const [name, data, opts, cb] = resolveArguments(...args)\n\n    const segmentEvent = this.eventFactory.track(\n      name,\n      data as EventProperties,\n      opts,\n      this.integrations,\n      pageCtx\n    )\n\n    return this._dispatch(segmentEvent, cb).then((ctx) => {\n      this.emit('track', name, ctx.event.properties, ctx.event.options)\n      return ctx\n    })\n  }\n\n  async page(...args: PageParams): Promise<DispatchedEvent> {\n    const pageCtx = popPageContext(args)\n    const [category, page, properties, options, callback] =\n      resolvePageArguments(...args)\n\n    const segmentEvent = this.eventFactory.page(\n      category,\n      page,\n      properties,\n      options,\n      this.integrations,\n      pageCtx\n    )\n\n    return this._dispatch(segmentEvent, callback).then((ctx) => {\n      this.emit('page', category, page, ctx.event.properties, ctx.event.options)\n      return ctx\n    })\n  }\n\n  async identify(...args: IdentifyParams): Promise<DispatchedEvent> {\n    const pageCtx = popPageContext(args)\n    const [id, _traits, options, callback] = resolveUserArguments(this._user)(\n      ...args\n    )\n\n    this._user.identify(id, _traits)\n    const segmentEvent = this.eventFactory.identify(\n      this._user.id(),\n      this._user.traits(),\n      options,\n      this.integrations,\n      pageCtx\n    )\n\n    return this._dispatch(segmentEvent, callback).then((ctx) => {\n      this.emit(\n        'identify',\n        ctx.event.userId,\n        ctx.event.traits,\n        ctx.event.options\n      )\n      return ctx\n    })\n  }\n\n  group(): Group\n  group(...args: GroupParams): Promise<DispatchedEvent>\n  group(...args: GroupParams): Promise<DispatchedEvent> | Group {\n    const pageCtx = popPageContext(args)\n    if (args.length === 0) {\n      return this._group\n    }\n\n    const [id, _traits, options, callback] = resolveUserArguments(this._group)(\n      ...args\n    )\n\n    this._group.identify(id, _traits)\n    const groupId = this._group.id()\n    const groupTraits = this._group.traits()\n\n    const segmentEvent = this.eventFactory.group(\n      groupId,\n      groupTraits,\n      options,\n      this.integrations,\n      pageCtx\n    )\n\n    return this._dispatch(segmentEvent, callback).then((ctx) => {\n      this.emit('group', ctx.event.groupId, ctx.event.traits, ctx.event.options)\n      return ctx\n    })\n  }\n\n  async alias(...args: AliasParams): Promise<DispatchedEvent> {\n    const pageCtx = popPageContext(args)\n    const [to, from, options, callback] = resolveAliasArguments(...args)\n    const segmentEvent = this.eventFactory.alias(\n      to,\n      from,\n      options,\n      this.integrations,\n      pageCtx\n    )\n    return this._dispatch(segmentEvent, callback).then((ctx) => {\n      this.emit('alias', to, from, ctx.event.options)\n      return ctx\n    })\n  }\n\n  async screen(...args: PageParams): Promise<DispatchedEvent> {\n    const pageCtx = popPageContext(args)\n    const [category, page, properties, options, callback] =\n      resolvePageArguments(...args)\n\n    const segmentEvent = this.eventFactory.screen(\n      category,\n      page,\n      properties,\n      options,\n      this.integrations,\n      pageCtx\n    )\n    return this._dispatch(segmentEvent, callback).then((ctx) => {\n      this.emit(\n        'screen',\n        category,\n        page,\n        ctx.event.properties,\n        ctx.event.options\n      )\n      return ctx\n    })\n  }\n\n  async trackClick(...args: LinkArgs): Promise<Analytics> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.link.call(this, ...args)\n  }\n\n  async trackLink(...args: LinkArgs): Promise<Analytics> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.link.call(this, ...args)\n  }\n\n  async trackSubmit(...args: FormArgs): Promise<Analytics> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.form.call(this, ...args)\n  }\n\n  async trackForm(...args: FormArgs): Promise<Analytics> {\n    const autotrack = await import(\n      /* webpackChunkName: \"auto-track\" */ '../auto-track'\n    )\n    return autotrack.form.call(this, ...args)\n  }\n\n  async register(...plugins: Plugin[]): Promise<Context> {\n    const ctx = Context.system()\n\n    const registrations = plugins.map((xt) =>\n      this.queue.register(ctx, xt, this)\n    )\n    await Promise.all(registrations)\n\n    return ctx\n  }\n\n  async deregister(...plugins: string[]): Promise<Context> {\n    const ctx = Context.system()\n\n    const deregistrations = plugins.map((pl) => {\n      const plugin = this.queue.plugins.find((p) => p.name === pl)\n      if (plugin) {\n        return this.queue.deregister(ctx, plugin, this)\n      } else {\n        ctx.log('warn', `plugin ${pl} not found`)\n      }\n    })\n\n    await Promise.all(deregistrations)\n\n    return ctx\n  }\n\n  debug(toggle: boolean): Analytics {\n    // Make sure legacy ajs debug gets turned off if it was enabled before upgrading.\n    if (toggle === false && localStorage.getItem('debug')) {\n      localStorage.removeItem('debug')\n    }\n    this._debug = toggle\n    return this\n  }\n\n  reset(): void {\n    this._user.reset()\n    this._group.reset()\n    this.emit('reset')\n  }\n\n  timeout(timeout: number): void {\n    this.settings.timeout = timeout\n  }\n\n  private async _dispatch(\n    event: SegmentEvent,\n    callback?: Callback\n  ): Promise<DispatchedEvent> {\n    const ctx = new Context(event)\n    ctx.stats.increment('analytics_js.invoke', 1, [event.type])\n    if (isOffline() && !this.options.retryQueue) {\n      return ctx\n    }\n    return dispatch(ctx, this.queue, this, {\n      callback,\n      debug: this._debug,\n      timeout: this.settings.timeout,\n    })\n  }\n\n  async addSourceMiddleware(fn: MiddlewareFunction): Promise<Analytics> {\n    await this.queue.criticalTasks.run(async () => {\n      const { sourceMiddlewarePlugin } = await import(\n        /* webpackChunkName: \"middleware\" */ '../../plugins/middleware'\n      )\n\n      const integrations: Record<string, boolean> = {}\n      this.queue.plugins.forEach((plugin) => {\n        if (plugin.type === 'destination') {\n          return (integrations[plugin.name] = true)\n        }\n      })\n\n      const plugin = sourceMiddlewarePlugin(fn, integrations)\n      await this.register(plugin)\n    })\n\n    return this\n  }\n\n  /* TODO: This does not have to return a promise? */\n  addDestinationMiddleware(\n    integrationName: string,\n    ...middlewares: DestinationMiddlewareFunction[]\n  ): Promise<Analytics> {\n    this.queue.plugins\n      .filter(isDestinationPluginWithAddMiddleware)\n      .forEach((p) => {\n        if (\n          integrationName === '*' ||\n          p.name.toLowerCase() === integrationName.toLowerCase()\n        ) {\n          p.addMiddleware(...middlewares)\n        }\n      })\n\n    return Promise.resolve(this)\n  }\n\n  setAnonymousId(id?: string): ID {\n    return this._user.anonymousId(id)\n  }\n\n  async queryString(query: string): Promise<Context[]> {\n    if (this.options.useQueryString === false) {\n      return []\n    }\n\n    const { queryString } = await import(\n      /* webpackChunkName: \"queryString\" */ '../query-string'\n    )\n    return queryString(this, query)\n  }\n\n  /**\n   * @deprecated This function does not register a destination plugin.\n   *\n   * Instantiates a legacy Analytics.js destination.\n   *\n   * This function does not register the destination as an Analytics.JS plugin,\n   * all the it does it to invoke the factory function back.\n   */\n  use(legacyPluginFactory: (analytics: Analytics) => void): Analytics {\n    legacyPluginFactory(this)\n    return this\n  }\n\n  async ready(\n    callback: Function = (res: Promise<unknown>[]): Promise<unknown>[] => res\n  ): Promise<unknown> {\n    return Promise.all(\n      this.queue.plugins.map((i) => (i.ready ? i.ready() : Promise.resolve()))\n    ).then((res) => {\n      callback(res)\n      return res\n    })\n  }\n\n  // analytics-classic api\n\n  noConflict(): Analytics {\n    console.warn(deprecationWarning)\n    setGlobalAnalytics(_analytics ?? this)\n    return this\n  }\n\n  normalize(msg: SegmentEvent): SegmentEvent {\n    console.warn(deprecationWarning)\n    return this.eventFactory['normalize'](msg)\n  }\n\n  get failedInitializations(): string[] {\n    console.warn(deprecationWarning)\n    return this.queue.failedInitializations\n  }\n\n  get VERSION(): string {\n    return version\n  }\n\n  /* @deprecated - noop */\n  async initialize(\n    _settings?: AnalyticsSettings,\n    _options?: InitOptions\n  ): Promise<Analytics> {\n    console.warn(deprecationWarning)\n    return Promise.resolve(this)\n  }\n\n  init = this.initialize.bind(this)\n\n  async pageview(url: string): Promise<Analytics> {\n    console.warn(deprecationWarning)\n    await this.page({ path: url })\n    return this\n  }\n\n  get plugins() {\n    console.warn(deprecationWarning)\n    // @ts-expect-error\n    return this._plugins ?? {}\n  }\n\n  get Integrations() {\n    console.warn(deprecationWarning)\n    const integrations = this.queue.plugins\n      .filter((plugin) => plugin.type === 'destination')\n      .reduce((acc, plugin) => {\n        const name = `${plugin.name\n          .toLowerCase()\n          .replace('.', '')\n          .split(' ')\n          .join('-')}Integration`\n\n        // @ts-expect-error\n        const integration = window[name] as\n          | (LegacyIntegration & { Integration?: LegacyIntegration })\n          | undefined\n\n        if (!integration) {\n          return acc\n        }\n\n        const nested = integration.Integration // hack - Google Analytics function resides in the \"Integration\" field\n        if (nested) {\n          acc[plugin.name] = nested\n          return acc\n        }\n\n        acc[plugin.name] = integration as LegacyIntegration\n        return acc\n      }, {} as Record<string, LegacyIntegration>)\n\n    return integrations\n  }\n\n  log = _stub\n  addIntegrationMiddleware = _stub\n  listeners = _stub\n  addEventListener = _stub\n  removeAllListeners = _stub\n  removeListener = _stub\n  removeEventListener = _stub\n  hasListeners = _stub\n  add = _stub\n  addIntegration = _stub\n\n  // snippet function\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  push(args: any[]) {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const an = this as any\n    const method = args.shift()\n    if (method) {\n      if (!an[method]) return\n    }\n    an[method].apply(this, args)\n  }\n}\n\n/**\n * @returns a no-op analytics instance that does not create cookies or localstorage, or send any events to segment.\n */\nexport class NullAnalytics extends Analytics {\n  constructor() {\n    super({ writeKey: '' }, { disableClientPersistence: true })\n    this.initialized = true\n  }\n}\n", "/**\n * Returns `process.env` if it is available in the environment.\n * Always returns an object make it similarly easy to use as `process.env`.\n */\nexport function getProcessEnv(): { [key: string]: string | undefined } {\n  if (typeof process === 'undefined' || !process.env) {\n    return {}\n  }\n\n  return process.env\n}\n", "import { HighEntropyHint, NavigatorUAData, UADataValues } from './interfaces'\n\nexport async function clientHints(\n  hints?: HighEntropyHint[]\n): Promise<UADataValues | undefined> {\n  const userAgentData = (navigator as any).userAgentData as\n    | NavigatorUAData\n    | undefined\n\n  if (!userAgentData) return undefined\n\n  if (!hints) return userAgentData.toJSON()\n  return userAgentData\n    .getHighEntropyValues(hints)\n    .catch(() => userAgentData.toJSON())\n}\n", "import jar from 'js-cookie'\nimport type { Context } from '../../core/context'\nimport type { Plugin } from '../../core/plugin'\nimport { version } from '../../generated/version'\nimport { SegmentEvent } from '../../core/events'\nimport { Campaign, PluginType } from '@segment/analytics-core'\nimport { getVersionType } from '../../lib/version-type'\nimport { tld } from '../../core/user/tld'\nimport { gracefulDecodeURIComponent } from '../../core/query-string/gracefulDecodeURIComponent'\nimport { CookieStorage, UniversalStorage } from '../../core/storage'\nimport { Analytics } from '../../core/analytics'\nimport { clientHints } from '../../lib/client-hints'\nimport { UADataValues } from '../../lib/client-hints/interfaces'\n\nlet cookieOptions: jar.CookieAttributes | undefined\nfunction getCookieOptions(): jar.CookieAttributes {\n  if (cookieOptions) {\n    return cookieOptions\n  }\n\n  const domain = tld(window.location.href)\n  cookieOptions = {\n    expires: 31536000000, // 1 year\n    secure: false,\n    path: '/',\n  }\n  if (domain) {\n    cookieOptions.domain = domain\n  }\n\n  return cookieOptions\n}\n\ntype Ad = { id: string; type: string }\n\nfunction ads(query: string): Ad | undefined {\n  const queryIds: Record<string, string> = {\n    btid: 'dataxu',\n    urid: 'millennial-media',\n  }\n\n  if (query.startsWith('?')) {\n    query = query.substring(1)\n  }\n  query = query.replace(/\\?/g, '&')\n  const parts = query.split('&')\n\n  for (const part of parts) {\n    const [k, v] = part.split('=')\n    if (queryIds[k]) {\n      return {\n        id: v,\n        type: queryIds[k],\n      }\n    }\n  }\n}\n\nexport function utm(query: string): Campaign {\n  if (query.startsWith('?')) {\n    query = query.substring(1)\n  }\n  query = query.replace(/\\?/g, '&')\n\n  return query.split('&').reduce((acc, str) => {\n    const [k, v = ''] = str.split('=')\n    if (k.includes('utm_') && k.length > 4) {\n      let utmParam = k.slice(4) as keyof Campaign\n      if (utmParam === 'campaign') {\n        utmParam = 'name'\n      }\n      acc[utmParam] = gracefulDecodeURIComponent(v)\n    }\n    return acc\n  }, {} as Campaign)\n}\n\nexport function ampId(): string | undefined {\n  const ampId = jar.get('_ga')\n  if (ampId && ampId.startsWith('amp')) {\n    return ampId\n  }\n}\n\nfunction referrerId(\n  query: string,\n  ctx: SegmentEvent['context'],\n  disablePersistance: boolean\n): void {\n  const storage = new UniversalStorage<{\n    's:context.referrer': Ad\n  }>(disablePersistance ? [] : [new CookieStorage(getCookieOptions())])\n\n  const stored = storage.get('s:context.referrer')\n\n  const ad = ads(query) ?? stored\n\n  if (!ad) {\n    return\n  }\n\n  if (ctx) {\n    ctx.referrer = { ...ctx.referrer, ...ad }\n  }\n\n  storage.set('s:context.referrer', ad)\n}\n\n/**\n *\n * @param obj e.g. { foo: 'b', bar: 'd', baz: ['123', '456']}\n * @returns e.g. 'foo=b&bar=d&baz=123&baz=456'\n */\nconst objectToQueryString = (\n  obj: Record<string, string | string[]>\n): string => {\n  try {\n    const searchParams = new URLSearchParams()\n    Object.entries(obj).forEach(([k, v]) => {\n      if (Array.isArray(v)) {\n        v.forEach((value) => searchParams.append(k, value))\n      } else {\n        searchParams.append(k, v)\n      }\n    })\n    return searchParams.toString()\n  } catch {\n    return ''\n  }\n}\n\nclass EnvironmentEnrichmentPlugin implements Plugin {\n  private instance!: Analytics\n  private userAgentData: UADataValues | undefined\n\n  name = 'Page Enrichment'\n  type: PluginType = 'before'\n  version = '0.1.0'\n  isLoaded = () => true\n  load = async (_ctx: Context, instance: Analytics) => {\n    this.instance = instance\n    try {\n      this.userAgentData = await clientHints(\n        this.instance.options.highEntropyValuesClientHints\n      )\n    } catch (_) {\n      // if client hints API doesn't return anything leave undefined\n    }\n    return Promise.resolve()\n  }\n\n  private enrich = (ctx: Context): Context => {\n    // Note: Types are off - context should never be undefined here, since it is set as part of event creation.\n    const evtCtx = ctx.event.context!\n\n    const search = evtCtx.page!.search || ''\n\n    const query =\n      typeof search === 'object' ? objectToQueryString(search) : search\n\n    evtCtx.userAgent = navigator.userAgent\n    evtCtx.userAgentData = this.userAgentData\n\n    // @ts-ignore\n    const locale = navigator.userLanguage || navigator.language\n\n    if (typeof evtCtx.locale === 'undefined' && typeof locale !== 'undefined') {\n      evtCtx.locale = locale\n    }\n\n    evtCtx.library ??= {\n      name: 'analytics.js',\n      version: `${getVersionType() === 'web' ? 'next' : 'npm:next'}-${version}`,\n    }\n\n    if (query && !evtCtx.campaign) {\n      evtCtx.campaign = utm(query)\n    }\n\n    const amp = ampId()\n    if (amp) {\n      evtCtx.amp = { id: amp }\n    }\n\n    referrerId(\n      query,\n      evtCtx,\n      this.instance.options.disableClientPersistence ?? false\n    )\n\n    try {\n      evtCtx.timezone = Intl.DateTimeFormat().resolvedOptions().timeZone\n    } catch (_) {\n      // If browser doesn't have support leave timezone undefined\n    }\n\n    return ctx\n  }\n\n  track = this.enrich\n  identify = this.enrich\n  page = this.enrich\n  group = this.enrich\n  alias = this.enrich\n  screen = this.enrich\n}\n\nexport const envEnrichment = new EnvironmentEnrichmentPlugin()\n", "import { CDNSettings } from '../../browser'\nimport { JSONObject, JSONValue } from '../../core/events'\nimport { Plugin, InternalPluginWithAddMiddleware } from '../../core/plugin'\nimport { loadScript } from '../../lib/load-script'\nimport { getCDN } from '../../lib/parse-cdn'\nimport {\n  applyDestinationMiddleware,\n  DestinationMiddlewareFunction,\n} from '../middleware'\nimport { Context, ContextCancelation } from '../../core/context'\nimport { recordIntegrationMetric } from '../../core/stats/metric-helpers'\nimport { Analytics, InitOptions } from '../../core/analytics'\nimport { createDeferred } from '@segment/analytics-generic-utils'\nimport { IntegrationsInitOptions } from '../../browser/settings'\n\nexport interface RemotePlugin {\n  /** The name of the remote plugin */\n  name: string\n  /** The creation name of the remote plugin */\n  creationName: string\n  /** The url of the javascript file to load */\n  url: string\n  /** The UMD/global name the plugin uses. Plugins are expected to exist here with the `PluginFactory` method signature */\n  libraryName: string\n  /** The settings related to this plugin. */\n  settings: JSONObject\n}\n\nexport class ActionDestination implements InternalPluginWithAddMiddleware {\n  name: string // destination name\n  version = '1.0.0'\n  /**\n   * The lifecycle name of the wrapped plugin.\n   * This does not need to be 'destination', and can be 'enrichment', etc.\n   */\n  type: Plugin['type']\n\n  alternativeNames: string[] = []\n\n  private loadPromise = createDeferred<unknown>()\n\n  middleware: DestinationMiddlewareFunction[] = []\n\n  action: Plugin\n\n  constructor(name: string, action: Plugin) {\n    this.action = action\n    this.name = name\n    this.type = action.type\n    this.alternativeNames.push(action.name)\n  }\n\n  addMiddleware(...fn: DestinationMiddlewareFunction[]): void {\n    /** Make sure we only apply destination filters to actions of the \"destination\" type to avoid causing issues for hybrid destinations */\n    if (this.type === 'destination') {\n      this.middleware.push(...fn)\n    }\n  }\n\n  private async transform(ctx: Context): Promise<Context> {\n    const modifiedEvent = await applyDestinationMiddleware(\n      this.name,\n      ctx.event,\n      this.middleware\n    )\n\n    if (modifiedEvent === null) {\n      ctx.cancel(\n        new ContextCancelation({\n          retry: false,\n          reason: 'dropped by destination middleware',\n        })\n      )\n    }\n\n    return new Context(modifiedEvent!)\n  }\n\n  private _createMethod(\n    methodName: 'track' | 'page' | 'identify' | 'alias' | 'group' | 'screen'\n  ) {\n    return async (ctx: Context): Promise<Context> => {\n      if (!this.action[methodName]) return ctx\n\n      let transformedContext: Context = ctx\n      // Transformations only allowed for destination plugins. Other plugin types support mutating events.\n      if (this.type === 'destination') {\n        transformedContext = await this.transform(ctx)\n      }\n\n      try {\n        if (!(await this.ready())) {\n          throw new Error(\n            'Something prevented the destination from getting ready'\n          )\n        }\n\n        recordIntegrationMetric(ctx, {\n          integrationName: this.action.name,\n          methodName,\n          type: 'action',\n        })\n\n        await this.action[methodName]!(transformedContext)\n      } catch (error) {\n        recordIntegrationMetric(ctx, {\n          integrationName: this.action.name,\n          methodName,\n          type: 'action',\n          didError: true,\n        })\n        throw error\n      }\n\n      return ctx\n    }\n  }\n\n  alias = this._createMethod('alias')\n  group = this._createMethod('group')\n  identify = this._createMethod('identify')\n  page = this._createMethod('page')\n  screen = this._createMethod('screen')\n  track = this._createMethod('track')\n\n  /* --- PASSTHROUGH METHODS --- */\n  isLoaded(): boolean {\n    return this.action.isLoaded()\n  }\n\n  async ready(): Promise<boolean> {\n    try {\n      await this.loadPromise.promise\n      return true\n    } catch {\n      return false\n    }\n  }\n\n  async load(ctx: Context, analytics: Analytics): Promise<unknown> {\n    if (this.loadPromise.isSettled()) {\n      return this.loadPromise.promise\n    }\n\n    try {\n      recordIntegrationMetric(ctx, {\n        integrationName: this.action.name,\n        methodName: 'load',\n        type: 'action',\n      })\n\n      const loadP = this.action.load(ctx, analytics)\n\n      this.loadPromise.resolve(await loadP)\n      return loadP\n    } catch (error) {\n      recordIntegrationMetric(ctx, {\n        integrationName: this.action.name,\n        methodName: 'load',\n        type: 'action',\n        didError: true,\n      })\n\n      this.loadPromise.reject(error)\n      throw error\n    }\n  }\n\n  unload(ctx: Context, analytics: Analytics): Promise<unknown> | unknown {\n    return this.action.unload?.(ctx, analytics)\n  }\n}\n\nexport type PluginFactory = {\n  (settings: JSONValue): Plugin | Plugin[] | Promise<Plugin | Plugin[]>\n  pluginName: string\n}\n\nfunction validate(pluginLike: unknown): pluginLike is Plugin[] {\n  if (!Array.isArray(pluginLike)) {\n    throw new Error('Not a valid list of plugins')\n  }\n\n  const required = ['load', 'isLoaded', 'name', 'version', 'type']\n  pluginLike.forEach((plugin) => {\n    required.forEach((method) => {\n      if (plugin[method] === undefined) {\n        throw new Error(\n          `Plugin: ${\n            plugin.name ?? 'unknown'\n          } missing required function ${method}`\n        )\n      }\n    })\n  })\n\n  return true\n}\n\nfunction isPluginDisabled(\n  userIntegrations: IntegrationsInitOptions,\n  remotePlugin: RemotePlugin\n) {\n  const creationNameEnabled = userIntegrations[remotePlugin.creationName]\n  const currentNameEnabled = userIntegrations[remotePlugin.name]\n\n  // Check that the plugin isn't explicitly enabled when All: false\n  if (\n    userIntegrations.All === false &&\n    !creationNameEnabled &&\n    !currentNameEnabled\n  ) {\n    return true\n  }\n\n  // Check that the plugin isn't explicitly disabled\n  if (creationNameEnabled === false || currentNameEnabled === false) {\n    return true\n  }\n\n  return false\n}\n\nasync function loadPluginFactory(\n  remotePlugin: RemotePlugin,\n  obfuscate?: boolean\n): Promise<void | PluginFactory> {\n  try {\n    const defaultCdn = new RegExp('https://cdn.segment.(com|build)')\n    const cdn = getCDN()\n\n    if (obfuscate) {\n      const urlSplit = remotePlugin.url.split('/')\n      const name = urlSplit[urlSplit.length - 2]\n      const obfuscatedURL = remotePlugin.url.replace(\n        name,\n        btoa(name).replace(/=/g, '')\n      )\n      try {\n        await loadScript(obfuscatedURL.replace(defaultCdn, cdn))\n      } catch (error) {\n        // Due to syncing concerns it is possible that the obfuscated action destination (or requested version) might not exist.\n        // We should use the unobfuscated version as a fallback.\n        await loadScript(remotePlugin.url.replace(defaultCdn, cdn))\n      }\n    } else {\n      await loadScript(remotePlugin.url.replace(defaultCdn, cdn))\n    }\n\n    // @ts-expect-error\n    if (typeof window[remotePlugin.libraryName] === 'function') {\n      // @ts-expect-error\n      return window[remotePlugin.libraryName] as PluginFactory\n    }\n  } catch (err) {\n    console.error('Failed to create PluginFactory', remotePlugin)\n    throw err\n  }\n}\n\nexport async function remoteLoader(\n  settings: CDNSettings,\n  integrations: IntegrationsInitOptions,\n  mergedIntegrations: Record<string, JSONObject>,\n  options?: InitOptions,\n  routingMiddleware?: DestinationMiddlewareFunction,\n  pluginSources?: PluginFactory[]\n): Promise<Plugin[]> {\n  const allPlugins: Plugin[] = []\n\n  const routingRules = settings.middlewareSettings?.routingRules ?? []\n\n  const pluginPromises = (settings.remotePlugins ?? []).map(\n    async (remotePlugin) => {\n      if (isPluginDisabled(integrations, remotePlugin)) return\n\n      try {\n        const pluginFactory =\n          pluginSources?.find(\n            ({ pluginName }) => pluginName === remotePlugin.name\n          ) || (await loadPluginFactory(remotePlugin, options?.obfuscate))\n\n        if (pluginFactory) {\n          const intg = mergedIntegrations[remotePlugin.name]\n          const plugin = await pluginFactory({\n            ...remotePlugin.settings,\n            ...intg,\n          })\n          const plugins = Array.isArray(plugin) ? plugin : [plugin]\n\n          validate(plugins)\n\n          const routing = routingRules.filter(\n            (rule) => rule.destinationName === remotePlugin.creationName\n          )\n\n          plugins.forEach((plugin) => {\n            const wrapper = new ActionDestination(\n              remotePlugin.creationName,\n              plugin\n            )\n\n            if (routing.length && routingMiddleware) {\n              wrapper.addMiddleware(routingMiddleware)\n            }\n\n            allPlugins.push(wrapper)\n          })\n        }\n      } catch (error) {\n        console.warn('Failed to load Remote Plugin', error)\n      }\n    }\n  )\n\n  await Promise.all(pluginPromises)\n  return allPlugins.filter(Boolean)\n}\n", "import { getGlobal } from '../../lib/get-global'\nimport type { Analytics } from '../analytics'\n\nconst env = getGlobal()\n\n// The code below assumes the inspector extension will use Object.assign\n// to add the inspect interface on to this object reference (unless the\n// extension code ran first and has already set up the variable)\nconst inspectorHost: {\n  attach: (analytics: Analytics) => void\n} = ((env as any)['__SEGMENT_INSPECTOR__'] ??= {})\n\nexport const attachInspector = (analytics: Analytics) =>\n  inspectorHost.attach?.(analytics as any)\n", "import { getProcessEnv } from '../lib/get-process-env'\nimport { getCDN, setGlobalCDNUrl } from '../lib/parse-cdn'\nimport { Analytics, NullAnalytics } from '../core/analytics'\nimport { Context } from '../core/context'\nimport { Plugin } from '../core/plugin'\nimport { mergedOptions } from '../lib/merged-options'\nimport { createDeferred } from '@segment/analytics-generic-utils'\nimport { envEnrichment } from '../plugins/env-enrichment'\nimport { PluginFactory, remoteLoader } from '../plugins/remote-loader'\nimport { segmentio, SegmentioSettings } from '../plugins/segmentio'\nimport {\n  AnalyticsBuffered,\n  PreInitMethodCallBuffer,\n  flushAnalyticsCallsInNewTask,\n  flushAddSourceMiddleware,\n  flushSetAnonymousID,\n  flushOn,\n  PreInitMethodCall,\n  flushRegister,\n} from '../core/buffer'\nimport { ClassicIntegrationSource } from '../plugins/ajs-destination/types'\nimport { attachInspector } from '../core/inspector'\nimport { Stats } from '../core/stats'\nimport { setGlobalAnalyticsKey } from '../lib/global-analytics-helper'\nimport { CDNSettings, AnalyticsBrowserSettings, InitOptions } from './settings'\nimport { fetch } from '../lib/fetch'\n\nexport type { CDNSettings, AnalyticsBrowserSettings }\n\nexport function loadCDNSettings(\n  writeKey: string,\n  baseUrl: string\n): Promise<CDNSettings> {\n  return fetch(`${baseUrl}/v1/projects/${writeKey}/settings`)\n    .then((res) => {\n      if (!res.ok) {\n        return res.text().then((errorResponseMessage) => {\n          throw new Error(errorResponseMessage)\n        })\n      }\n      return res.json()\n    })\n    .catch((err) => {\n      console.error(err.message)\n      throw err\n    })\n}\n\nfunction hasLegacyDestinations(settings: CDNSettings): boolean {\n  return (\n    getProcessEnv().NODE_ENV !== 'test' &&\n    // just one integration means segmentio\n    Object.keys(settings.integrations).length > 1\n  )\n}\n\nfunction hasTsubMiddleware(settings: CDNSettings): boolean {\n  return (\n    getProcessEnv().NODE_ENV !== 'test' &&\n    (settings.middlewareSettings?.routingRules?.length ?? 0) > 0\n  )\n}\n\n/**\n * With AJS classic, we allow users to call setAnonymousId before the library initialization.\n * This is important because some of the destinations will use the anonymousId during the initialization,\n * and if we set anonId afterwards, that wouldnt impact the destination.\n *\n * Also Ensures events can be registered before library initialization.\n * This is important so users can register to 'initialize' and any events that may fire early during setup.\n */\nfunction flushPreBuffer(\n  analytics: Analytics,\n  buffer: PreInitMethodCallBuffer\n): void {\n  flushSetAnonymousID(analytics, buffer)\n  flushOn(analytics, buffer)\n}\n\n/**\n * Finish flushing buffer and cleanup.\n */\nasync function flushFinalBuffer(\n  analytics: Analytics,\n  queryString: string,\n  buffer: PreInitMethodCallBuffer\n): Promise<void> {\n  await flushQueryString(analytics, queryString)\n  flushAnalyticsCallsInNewTask(analytics, buffer)\n}\n\nconst getQueryString = (): string => {\n  const hash = window.location.hash ?? ''\n  const search = window.location.search ?? ''\n  const term = search.length ? search : hash.replace(/(?=#).*(?=\\?)/, '')\n  return term\n}\n\nconst flushQueryString = async (\n  analytics: Analytics,\n  queryString: string\n): Promise<void> => {\n  if (queryString.includes('ajs_')) {\n    await analytics.queryString(queryString).catch(console.error)\n  }\n}\n\nasync function registerPlugins(\n  writeKey: string,\n  cdnSettings: CDNSettings,\n  analytics: Analytics,\n  options: InitOptions,\n  pluginLikes: (Plugin | PluginFactory)[] = [],\n  legacyIntegrationSources: ClassicIntegrationSource[],\n  preInitBuffer: PreInitMethodCallBuffer\n): Promise<Context> {\n  flushPreBuffer(analytics, preInitBuffer)\n  const pluginsFromSettings = pluginLikes?.filter(\n    (pluginLike) => typeof pluginLike === 'object'\n  ) as Plugin[]\n\n  const pluginSources = pluginLikes?.filter(\n    (pluginLike) =>\n      typeof pluginLike === 'function' &&\n      typeof pluginLike.pluginName === 'string'\n  ) as PluginFactory[]\n\n  const tsubMiddleware = hasTsubMiddleware(cdnSettings)\n    ? await import(\n        /* webpackChunkName: \"tsub-middleware\" */ '../plugins/routing-middleware'\n      ).then((mod) => {\n        return mod.tsubMiddleware(cdnSettings.middlewareSettings!.routingRules)\n      })\n    : undefined\n\n  const legacyDestinations =\n    hasLegacyDestinations(cdnSettings) || legacyIntegrationSources.length > 0\n      ? await import(\n          /* webpackChunkName: \"ajs-destination\" */ '../plugins/ajs-destination'\n        ).then((mod) => {\n          return mod.ajsDestinations(\n            writeKey,\n            cdnSettings,\n            analytics.integrations,\n            options,\n            tsubMiddleware,\n            legacyIntegrationSources\n          )\n        })\n      : []\n\n  if (cdnSettings.legacyVideoPluginsEnabled) {\n    await import(\n      /* webpackChunkName: \"legacyVideos\" */ '../plugins/legacy-video-plugins'\n    ).then((mod) => {\n      return mod.loadLegacyVideoPlugins(analytics)\n    })\n  }\n\n  const schemaFilter = options.plan?.track\n    ? await import(\n        /* webpackChunkName: \"schemaFilter\" */ '../plugins/schema-filter'\n      ).then((mod) => {\n        return mod.schemaFilter(options.plan?.track, cdnSettings)\n      })\n    : undefined\n\n  const mergedSettings = mergedOptions(cdnSettings, options)\n  const remotePlugins = await remoteLoader(\n    cdnSettings,\n    analytics.integrations,\n    mergedSettings,\n    options,\n    tsubMiddleware,\n    pluginSources\n  ).catch(() => [])\n\n  const basePlugins = [envEnrichment, ...legacyDestinations, ...remotePlugins]\n\n  if (schemaFilter) {\n    basePlugins.push(schemaFilter)\n  }\n\n  const shouldIgnoreSegmentio =\n    (options.integrations?.All === false &&\n      !options.integrations['Segment.io']) ||\n    (options.integrations && options.integrations['Segment.io'] === false)\n\n  if (!shouldIgnoreSegmentio) {\n    basePlugins.push(\n      await segmentio(\n        analytics,\n        mergedSettings['Segment.io'],\n        cdnSettings.integrations\n      )\n    )\n  }\n\n  // order is important here, (for example, if there are multiple enrichment plugins, the last registered plugin will have access to the last context.)\n  const ctx = await analytics.register(\n    // register 'core' plugins and those via destinations\n    ...basePlugins,\n    // register user-defined plugins passed into AnalyticsBrowser.load({ plugins: [plugin1, plugin2] }) -- relevant to npm-only\n    ...pluginsFromSettings\n  )\n  // register user-defined plugins registered via analytics.register()\n  await flushRegister(analytics, preInitBuffer)\n\n  if (\n    Object.entries(cdnSettings.enabledMiddleware ?? {}).some(\n      ([, enabled]) => enabled\n    )\n  ) {\n    await import(\n      /* webpackChunkName: \"remoteMiddleware\" */ '../plugins/remote-middleware'\n    ).then(async ({ remoteMiddlewares }) => {\n      const middleware = await remoteMiddlewares(\n        ctx,\n        cdnSettings,\n        options.obfuscate\n      )\n      const promises = middleware.map((mdw) =>\n        analytics.addSourceMiddleware(mdw)\n      )\n      return Promise.all(promises)\n    })\n  }\n\n  // register any user-defined plugins added via analytics.addSourceMiddleware()\n  await flushAddSourceMiddleware(analytics, preInitBuffer)\n\n  return ctx\n}\n\nasync function loadAnalytics(\n  settings: AnalyticsBrowserSettings,\n  options: InitOptions = {},\n  preInitBuffer: PreInitMethodCallBuffer\n): Promise<[Analytics, Context]> {\n  // return no-op analytics instance if disabled\n  if (options.disable === true) {\n    return [new NullAnalytics(), Context.system()]\n  }\n\n  if (options.globalAnalyticsKey)\n    setGlobalAnalyticsKey(options.globalAnalyticsKey)\n  // this is an ugly side-effect, but it's for the benefits of the plugins that get their cdn via getCDN()\n  if (settings.cdnURL) setGlobalCDNUrl(settings.cdnURL)\n\n  if (options.initialPageview) {\n    // capture the page context early, so it's always up-to-date\n    preInitBuffer.add(new PreInitMethodCall('page', []))\n  }\n\n  // reading the query string as early as possible in case the URL changes\n  const queryString = getQueryString()\n\n  const cdnURL = settings.cdnURL ?? getCDN()\n  let cdnSettings =\n    settings.cdnSettings ?? (await loadCDNSettings(settings.writeKey, cdnURL))\n\n  if (options.updateCDNSettings) {\n    cdnSettings = options.updateCDNSettings(cdnSettings)\n  }\n\n  // if options.disable is a function, we allow user to disable analytics based on CDN Settings\n  if (typeof options.disable === 'function') {\n    const disabled = await options.disable(cdnSettings)\n    if (disabled) {\n      return [new NullAnalytics(), Context.system()]\n    }\n  }\n\n  const retryQueue: boolean =\n    cdnSettings.integrations['Segment.io']?.retryQueue ?? true\n\n  options = {\n    retryQueue,\n    ...options,\n  }\n\n  const analytics = new Analytics({ ...settings, cdnSettings, cdnURL }, options)\n\n  attachInspector(analytics)\n\n  const plugins = settings.plugins ?? []\n\n  const classicIntegrations = settings.classicIntegrations ?? []\n\n  const segmentLoadOptions = options.integrations?.['Segment.io'] as\n    | SegmentioSettings\n    | undefined\n\n  Stats.initRemoteMetrics({\n    ...cdnSettings.metrics,\n    host: segmentLoadOptions?.apiHost ?? cdnSettings.metrics?.host,\n    protocol: segmentLoadOptions?.protocol,\n  })\n\n  const ctx = await registerPlugins(\n    settings.writeKey,\n    cdnSettings,\n    analytics,\n    options,\n    plugins,\n    classicIntegrations,\n    preInitBuffer\n  )\n\n  analytics.initialized = true\n  analytics.emit('initialize', settings, options)\n  await flushFinalBuffer(analytics, queryString, preInitBuffer)\n\n  return [analytics, ctx]\n}\n\n/**\n * The public browser interface for Segment Analytics\n *\n * @example\n * ```ts\n *  export const analytics = new AnalyticsBrowser()\n *  analytics.load({ writeKey: 'foo' })\n * ```\n * @link https://github.com/segmentio/analytics-next/#readme\n */\nexport class AnalyticsBrowser extends AnalyticsBuffered {\n  private _resolveLoadStart: (\n    settings: AnalyticsBrowserSettings,\n    options: InitOptions\n  ) => void\n\n  constructor() {\n    const { promise: loadStart, resolve: resolveLoadStart } =\n      createDeferred<Parameters<AnalyticsBrowser['load']>>()\n\n    super((buffer) =>\n      loadStart.then(([settings, options]) =>\n        loadAnalytics(settings, options, buffer)\n      )\n    )\n\n    this._resolveLoadStart = (settings, options) =>\n      resolveLoadStart([settings, options])\n  }\n\n  /**\n   * Fully initialize an analytics instance, including:\n   *\n   * * Fetching settings from the segment CDN (by default).\n   * * Fetching all remote destinations configured by the user (if applicable).\n   * * Flushing buffered analytics events.\n   * * Loading all middleware.\n   *\n   * Note:  This method should only be called *once* in your application.\n   *\n   * @example\n   * ```ts\n   * export const analytics = new AnalyticsBrowser()\n   * analytics.load({ writeKey: 'foo' })\n   * ```\n   */\n  load(\n    settings: AnalyticsBrowserSettings,\n    options: InitOptions = {}\n  ): AnalyticsBrowser {\n    this._resolveLoadStart(settings, options)\n    return this\n  }\n\n  /**\n   * Instantiates an object exposing Analytics methods.\n   *\n   * @example\n   * ```ts\n   * const ajs = AnalyticsBrowser.load({ writeKey: '<YOUR_WRITE_KEY>' })\n   *\n   * ajs.track(\"foo\")\n   * ...\n   * ```\n   */\n  static load(\n    settings: AnalyticsBrowserSettings,\n    options: InitOptions = {}\n  ): AnalyticsBrowser {\n    return new AnalyticsBrowser().load(settings, options)\n  }\n\n  static standalone(\n    writeKey: string,\n    options?: InitOptions\n  ): Promise<Analytics> {\n    return AnalyticsBrowser.load({ writeKey }, options).then((res) => res[0])\n  }\n}\n", "export class AnalyticsNode {\n  static load(): Promise<never> {\n    return Promise.reject(\n      new Error('AnalyticsNode is not available in browsers.')\n    )\n  }\n}\n", "import _objectSpread from '@babel/runtime/helpers/objectSpread2';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport { AnalyticsBrowser } from '@segment/analytics-next';\nimport { log } from './loglevel.js';\n\nconst SEGMENT_WRITE_KEY = \"f6LbNqCeVRf512ggdME4b6CyflhF1tsX\";\nclass Analytics {\n  constructor() {\n    _defineProperty(this, \"segment\", void 0);\n    _defineProperty(this, \"globalProperties\", {});\n    _defineProperty(this, \"enabled\", true);\n  }\n  init() {\n    if (this.isSkipped()) {\n      return;\n    }\n    if (this.segment) {\n      throw new Error(\"Analytics already initialized\");\n    }\n    this.segment = new AnalyticsBrowser();\n    this.segment.load({\n      writeKey: SEGMENT_WRITE_KEY\n    }, {\n      user: {\n        cookie: {\n          key: \"web3auth_ajs_user_id\"\n        },\n        localStorage: {\n          key: \"web3auth_ajs_user_traits\"\n        }\n      },\n      globalAnalyticsKey: \"web3auth_analytics\"\n    }).then(() => {\n      log.debug(\"Analytics initialized\");\n      return true;\n    }).catch(error => {\n      log.error(\"Failed to initialize Analytics\", error);\n    });\n  }\n  enable() {\n    this.enabled = true;\n  }\n  disable() {\n    this.enabled = false;\n  }\n  setGlobalProperties(properties) {\n    this.globalProperties = _objectSpread(_objectSpread({}, this.globalProperties), properties);\n  }\n  async identify(userId, traits) {\n    if (!this.enabled) return;\n    if (this.isSkipped()) return;\n    try {\n      return this.getSegment().identify(userId, _objectSpread({}, traits));\n    } catch (error) {\n      log.error(`Failed to identify user ${userId} in analytics`, error);\n    }\n  }\n  async track(event, properties) {\n    if (!this.enabled) return;\n    if (this.isSkipped()) return;\n    try {\n      return this.getSegment().track(event, _objectSpread(_objectSpread({}, properties), this.globalProperties));\n    } catch (error) {\n      log.error(`Failed to track event ${event}`, error);\n    }\n  }\n  getSegment() {\n    if (!this.segment) {\n      log.error(\"Analytics not initialized. Call Analytics.init() first.\");\n      throw new Error(\"Analytics not initialized. Call Analytics.init() first.\");\n    }\n    return this.segment;\n  }\n  isSkipped() {\n    const dappOrigin = window.location.origin;\n\n    // skip if the protocol is not http or https\n    if (dappOrigin.startsWith(\"http://\")) {\n      return true;\n    }\n    // skip if dapp contains localhost\n    if (dappOrigin.includes(\"localhost\")) {\n      return true;\n    }\n    return false;\n  }\n}\nconst ANALYTICS_EVENTS = {\n  // SDK Initialization\n  SDK_INITIALIZATION_COMPLETED: \"SDK Initialization Completed\",\n  SDK_INITIALIZATION_FAILED: \"SDK Initialization Failed\",\n  // Connection\n  CONNECTION_STARTED: \"Connection Started\",\n  CONNECTION_COMPLETED: \"Connection Completed\",\n  CONNECTION_FAILED: \"Connection Failed\",\n  // Identity Token\n  IDENTITY_TOKEN_STARTED: \"Identity Token Started\",\n  IDENTITY_TOKEN_COMPLETED: \"Identity Token Completed\",\n  IDENTITY_TOKEN_FAILED: \"Identity Token Failed\",\n  // MFA\n  MFA_ENABLEMENT_STARTED: \"MFA Enablement Started\",\n  MFA_ENABLEMENT_COMPLETED: \"MFA Enablement Completed\",\n  MFA_ENABLEMENT_FAILED: \"MFA Enablement Failed\",\n  MFA_MANAGEMENT_SELECTED: \"MFA Management Selected\",\n  MFA_MANAGEMENT_FAILED: \"MFA Management Failed\",\n  // Login Modal\n  LOGIN_MODAL_OPENED: \"Login Modal Opened\",\n  LOGIN_MODAL_CLOSED: \"Login Modal Closed\",\n  SOCIAL_LOGIN_SELECTED: \"Social Login Selected\",\n  EXTERNAL_WALLET_SELECTED: \"External Wallet Selected\",\n  EXTERNAL_WALLET_LIST_EXPANDED: \"External Wallet List Expanded\",\n  // Wallet Plugin\n  WALLET_UI_CLICKED: \"Wallet UI Clicked\",\n  WALLET_CONNECT_SCANNER_CLICKED: \"Wallet Connect Scanner Clicked\",\n  WALLET_CHECKOUT_CLICKED: \"Wallet Checkout Clicked\",\n  WALLET_SWAP_CLICKED: \"Wallet Swap Clicked\"\n};\nconst ANALYTICS_INTEGRATION_TYPE = {\n  REACT_HOOKS: \"React Hooks\",\n  VUE_COMPOSABLES: \"Vue Composables\",\n  NATIVE_SDK: \"Native SDK\"\n};\nconst ANALYTICS_SDK_TYPE = {\n  WEB_NO_MODAL: \"Web NoModal\",\n  WEB_MODAL: \"Web Modal\"\n};\n\nexport { ANALYTICS_EVENTS, ANALYTICS_INTEGRATION_TYPE, ANALYTICS_SDK_TYPE, Analytics };\n", "import { safeatob } from '@web3auth/auth';\n\n/**\n * Extracts a name for the site from the DOM\n */\nconst getSiteName = window => {\n  const {\n    document\n  } = window;\n  const siteName = document.querySelector('head > meta[property=\"og:site_name\"]');\n  if (siteName) {\n    return siteName.content;\n  }\n  const metaTitle = document.querySelector('head > meta[name=\"title\"]');\n  if (metaTitle) {\n    return metaTitle.content;\n  }\n  if (document.title && document.title.length > 0) {\n    return document.title;\n  }\n  return window.location.hostname;\n};\n\n/**\n * Returns whether the given image URL exists\n * @param url - the url of the image\n * @returns - whether the image exists\n */\nfunction imgExists(url) {\n  return new Promise((resolve, reject) => {\n    try {\n      const img = document.createElement(\"img\");\n      img.onload = () => resolve(true);\n      img.onerror = () => resolve(false);\n      img.src = url;\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n\n/**\n * Extracts an icon for the site from the DOM\n */\nasync function getSiteIcon(window) {\n  const {\n    document\n  } = window;\n\n  // Use the site's favicon if it exists\n  let icon = document.querySelector('head > link[rel=\"shortcut icon\"]');\n  if (icon && (await imgExists(icon.href))) {\n    return icon.href;\n  }\n\n  // Search through available icons in no particular order\n  icon = Array.from(document.querySelectorAll('head > link[rel=\"icon\"]')).find(_icon => Boolean(_icon.href)) || null;\n  if (icon && (await imgExists(icon.href))) {\n    return icon.href;\n  }\n  return null;\n}\nfunction parseToken(token) {\n  const [header, payload] = token.split(\".\");\n  return {\n    header: JSON.parse(safeatob(header)),\n    payload: JSON.parse(safeatob(payload))\n  };\n}\n\nexport { getSiteIcon, getSiteName, parseToken };\n", "import { getSiteIcon, getSiteName } from '../utils.js';\nimport { SOLANA_CAIP_CHAIN_MAP } from '../../base/constants.js';\nimport { CHAIN_NAMESPACES } from '@toruslabs/base-controllers';\n\nlet DEFAULT_EIP155_METHODS = /*#__PURE__*/function (DEFAULT_EIP155_METHODS) {\n  DEFAULT_EIP155_METHODS[\"ETH_SEND_TRANSACTION\"] = \"eth_sendTransaction\";\n  DEFAULT_EIP155_METHODS[\"ETH_SIGN_TRANSACTION\"] = \"eth_signTransaction\";\n  DEFAULT_EIP155_METHODS[\"ETH_SIGN\"] = \"eth_sign\";\n  DEFAULT_EIP155_METHODS[\"PERSONAL_SIGN\"] = \"personal_sign\";\n  DEFAULT_EIP155_METHODS[\"ETH_SIGN_TYPED_DATA\"] = \"eth_signTypedData\";\n  DEFAULT_EIP155_METHODS[\"ETH_SIGN_TYPED_DATA_V3\"] = \"eth_signTypedData_v3\";\n  DEFAULT_EIP155_METHODS[\"ETH_SIGN_TYPED_DATA_V4\"] = \"eth_signTypedData_v4\";\n  DEFAULT_EIP155_METHODS[\"ADD_ETHEREUM_CHAIN\"] = \"wallet_addEthereumChain\";\n  DEFAULT_EIP155_METHODS[\"SWITCH_ETHEREUM_CHAIN\"] = \"wallet_switchEthereumChain\";\n  return DEFAULT_EIP155_METHODS;\n}({});\nlet DEFAULT_SOLANA_METHODS = /*#__PURE__*/function (DEFAULT_SOLANA_METHODS) {\n  DEFAULT_SOLANA_METHODS[\"SIGN_TRANSACTION\"] = \"solana_signTransaction\";\n  DEFAULT_SOLANA_METHODS[\"SIGN_MESSAGE\"] = \"solana_signMessage\";\n  return DEFAULT_SOLANA_METHODS;\n}({});\nlet DEFAULT_EIP_155_EVENTS = /*#__PURE__*/function (DEFAULT_EIP_155_EVENTS) {\n  DEFAULT_EIP_155_EVENTS[\"ETH_CHAIN_CHANGED\"] = \"chainChanged\";\n  DEFAULT_EIP_155_EVENTS[\"ETH_ACCOUNTS_CHANGED\"] = \"accountsChanged\";\n  return DEFAULT_EIP_155_EVENTS;\n}({});\nlet DEFAULT_SOLANA_EVENTS = /*#__PURE__*/function (DEFAULT_SOLANA_EVENTS) {\n  DEFAULT_SOLANA_EVENTS[\"SOL_CHAIN_CHANGED\"] = \"chainChanged\";\n  DEFAULT_SOLANA_EVENTS[\"SOL_ACCOUNTS_CHANGED\"] = \"accountsChanged\";\n  return DEFAULT_SOLANA_EVENTS;\n}({});\n\n/**\n * Gets site metadata and returns it\n *\n */\nconst getSiteMetadata = async () => ({\n  name: getSiteName(window),\n  icon: await getSiteIcon(window)\n});\nconst getNamespacesFromChains = chains => {\n  const supportedNamespaces = [];\n  chains.forEach(chainId => {\n    const [namespace] = chainId.split(\":\");\n    if (!supportedNamespaces.includes(namespace)) {\n      supportedNamespaces.push(namespace);\n    }\n  });\n  return supportedNamespaces;\n};\nconst getSupportedMethodsByNamespace = namespace => {\n  switch (namespace) {\n    case CHAIN_NAMESPACES.EIP155:\n      return Object.values(DEFAULT_EIP155_METHODS);\n    case CHAIN_NAMESPACES.SOLANA:\n      return Object.values(DEFAULT_SOLANA_METHODS);\n    default:\n      throw new Error(`No default methods for namespace: ${namespace}`);\n  }\n};\nconst getSupportedEventsByNamespace = namespace => {\n  switch (namespace) {\n    case CHAIN_NAMESPACES.EIP155:\n      return Object.values(DEFAULT_EIP_155_EVENTS);\n    case CHAIN_NAMESPACES.SOLANA:\n      return Object.values(DEFAULT_SOLANA_EVENTS);\n    default:\n      throw new Error(`No default events for namespace: ${namespace}`);\n  }\n};\nconst getRequiredNamespaces = chains => {\n  const selectedNamespaces = getNamespacesFromChains(chains);\n  return Object.fromEntries(selectedNamespaces.map(namespace => [namespace, {\n    methods: getSupportedMethodsByNamespace(namespace),\n    chains: chains.filter(chain => chain.startsWith(namespace)),\n    events: getSupportedEventsByNamespace(namespace)\n  }]));\n};\nconst getWalletConnectV2Settings = async (chains, projectID) => {\n  const appMetadata = await getSiteMetadata();\n  const connectorSettings = {\n    walletConnectInitOptions: {\n      projectId: projectID,\n      relayUrl: \"wss://relay.walletconnect.com\",\n      metadata: {\n        name: appMetadata.name,\n        description: appMetadata.name,\n        url: window.location.origin,\n        icons: [appMetadata.icon || \"\"]\n      }\n    }\n  };\n  const chainNamespaces = chains.map(chain => {\n    if (chain.chainNamespace === CHAIN_NAMESPACES.SOLANA) {\n      return `${chain.chainNamespace}:${SOLANA_CAIP_CHAIN_MAP[chain.chainId]}`;\n    } else if (chain.chainNamespace === CHAIN_NAMESPACES.EIP155) {\n      return `${chain.chainNamespace}:${parseInt(chain.chainId, 16)}`;\n    }\n    throw new Error(`Unsupported chain namespace: ${chain.chainNamespace}`);\n  });\n  const loginSettings = {\n    optionalNamespaces: getRequiredNamespaces(chainNamespaces)\n  };\n  return {\n    connectorSettings,\n    loginSettings\n  };\n};\n\nexport { DEFAULT_EIP155_METHODS, DEFAULT_EIP_155_EVENTS, DEFAULT_SOLANA_EVENTS, DEFAULT_SOLANA_METHODS, getNamespacesFromChains, getRequiredNamespaces, getSupportedEventsByNamespace, getSupportedMethodsByNamespace, getWalletConnectV2Settings };\n", "import _objectSpread from '@babel/runtime/helpers/objectSpread2';\nimport { createScaffoldMiddleware, createAsyncMiddleware, rpcErrors } from '@web3auth/auth';\n\nfunction createWalletMiddleware({\n  getAccounts,\n  getPrivateKey,\n  getPublicKey,\n  processEthSignMessage,\n  processPersonalMessage,\n  processTransaction,\n  processSignTransaction,\n  processTypedMessageV4\n}) {\n  if (!getAccounts) {\n    throw new Error(\"opts.getAccounts is required\");\n  }\n\n  //\n  // utility\n  //\n\n  /**\n   * Validates the keyholder address, and returns a normalized (i.e. lowercase)\n   * copy of it.\n   *\n   * an error\n   */\n  async function validateAndNormalizeKeyholder(address, req) {\n    if (typeof address === \"string\" && address.length > 0) {\n      // ensure address is included in provided accounts\n      const accounts = await getAccounts(req);\n      const normalizedAccounts = accounts.map(_address => _address.toLowerCase());\n      const normalizedAddress = address.toLowerCase();\n      if (normalizedAccounts.includes(normalizedAddress)) {\n        return normalizedAddress;\n      }\n    }\n    throw rpcErrors.invalidParams({\n      message: `Invalid parameters: must provide an Ethereum address.`\n    });\n  }\n\n  //\n  // account lookups\n  //\n\n  async function lookupAccounts(req, res) {\n    res.result = await getAccounts(req);\n  }\n\n  //\n  // transaction signatures\n  //\n\n  async function sendTransaction(req, res) {\n    if (!processTransaction) {\n      throw rpcErrors.methodNotSupported();\n    }\n    const txParams = req.params[0] || {\n      from: \"\"\n    };\n    txParams.from = await validateAndNormalizeKeyholder(txParams.from, req);\n    res.result = await processTransaction(txParams, req);\n  }\n  async function signTransaction(req, res) {\n    if (!processSignTransaction) {\n      throw rpcErrors.methodNotSupported();\n    }\n    const txParams = req.params[0] || {\n      from: \"\"\n    };\n    txParams.from = await validateAndNormalizeKeyholder(txParams.from, req);\n    res.result = await processSignTransaction(txParams, req);\n  }\n\n  //\n  // message signatures\n  //\n\n  async function ethSign(req, res) {\n    if (!processEthSignMessage) {\n      throw rpcErrors.methodNotSupported();\n    }\n    let msgParams = req.params;\n    const extraParams = req.params[2] || {};\n    if (Array.isArray(req.params)) {\n      if (!(req.params.length === 2)) throw new Error(`WalletMiddleware - incorrect params for ${req.method} method. expected [address, message]`);\n      const params = req.params;\n      const address = params[0];\n      const message = params[1];\n      msgParams = {\n        from: address,\n        data: message\n      };\n    }\n    msgParams = _objectSpread(_objectSpread({}, extraParams), msgParams);\n    res.result = await processEthSignMessage(msgParams, req);\n  }\n  async function signTypedDataV4(req, res) {\n    if (!processTypedMessageV4) {\n      throw rpcErrors.methodNotSupported();\n    }\n    if (!(req !== null && req !== void 0 && req.params)) throw new Error(\"WalletMiddleware - missing params\");\n    let msgParams = req.params;\n    if (Array.isArray(req.params)) {\n      if (!(req.params.length === 2)) throw new Error(`WalletMiddleware - incorrect params for ${req.method} method. expected [address, typedData]`);\n      const params = req.params;\n      const address = params[0];\n      const message = params[1];\n      msgParams = {\n        from: address,\n        data: message\n      };\n    }\n    res.result = await processTypedMessageV4(msgParams, req);\n  }\n  async function personalSign(req, res) {\n    if (!processPersonalMessage) {\n      throw rpcErrors.methodNotSupported();\n    }\n    let msgParams = req.params;\n    const extraParams = req.params[2] || {};\n    if (Array.isArray(req.params)) {\n      if (!(req.params.length >= 2)) throw new Error(`WalletMiddleware - incorrect params for ${req.method} method. expected [message, address]`);\n      const params = req.params;\n      if (typeof params[0] === \"object\") {\n        const {\n          challenge,\n          address\n        } = params[0];\n        msgParams = {\n          from: address,\n          data: challenge\n        };\n      } else {\n        const message = params[0];\n        const address = params[1];\n        msgParams = {\n          from: address,\n          data: message\n        };\n      }\n    }\n    msgParams = _objectSpread(_objectSpread({}, extraParams), msgParams);\n    res.result = await processPersonalMessage(msgParams, req);\n  }\n  async function fetchPrivateKey(req, res) {\n    if (!getPrivateKey) {\n      throw rpcErrors.methodNotSupported();\n    }\n    res.result = await getPrivateKey(req);\n  }\n  async function fetchPublicKey(req, res) {\n    if (!getPublicKey) {\n      throw rpcErrors.methodNotSupported();\n    }\n    res.result = await getPublicKey(req);\n  }\n  return createScaffoldMiddleware({\n    // account lookups\n    eth_accounts: createAsyncMiddleware(lookupAccounts),\n    eth_requestAccounts: createAsyncMiddleware(lookupAccounts),\n    eth_private_key: createAsyncMiddleware(fetchPrivateKey),\n    eth_public_key: createAsyncMiddleware(fetchPublicKey),\n    public_key: createAsyncMiddleware(fetchPublicKey),\n    private_key: createAsyncMiddleware(fetchPrivateKey),\n    // tx signatures\n    eth_sendTransaction: createAsyncMiddleware(sendTransaction),\n    eth_signTransaction: createAsyncMiddleware(signTransaction),\n    // message signatures\n    eth_sign: createAsyncMiddleware(ethSign),\n    eth_signTypedData_v4: createAsyncMiddleware(signTypedDataV4),\n    personal_sign: createAsyncMiddleware(personalSign)\n  });\n}\n\nexport { createWalletMiddleware };\n", "import { mergeMiddleware, createScaffoldMiddleware, createAsyncMiddleware, rpcErrors } from '@web3auth/auth';\nimport { createWalletMiddleware } from './walletMidddleware.js';\n\nfunction createEthMiddleware(providerHandlers) {\n  const {\n    getAccounts,\n    getPrivateKey,\n    getPublicKey,\n    processTransaction,\n    processSignTransaction,\n    processEthSignMessage,\n    processTypedMessageV4,\n    processPersonalMessage\n  } = providerHandlers;\n  const ethMiddleware = mergeMiddleware([createScaffoldMiddleware({\n    eth_syncing: false\n  }), createWalletMiddleware({\n    getAccounts,\n    getPrivateKey,\n    getPublicKey,\n    processTransaction,\n    processEthSignMessage,\n    processSignTransaction,\n    processTypedMessageV4,\n    processPersonalMessage\n  })]);\n  return ethMiddleware;\n}\nfunction createEthChainSwitchMiddleware({\n  switchChain\n}) {\n  async function updateChain(req, res) {\n    var _req$params;\n    const chainParams = (_req$params = req.params) !== null && _req$params !== void 0 && _req$params.length ? req.params[0] : undefined;\n    if (!chainParams) throw rpcErrors.invalidParams(\"Missing chainId\");\n    res.result = await switchChain(chainParams);\n  }\n  return createScaffoldMiddleware({\n    wallet_switchEthereumChain: createAsyncMiddleware(updateChain)\n  });\n}\n\nexport { createEthChainSwitchMiddleware, createEthMiddleware };\n", "import { createFetchMiddleware } from '@toruslabs/base-controllers';\nimport { mergeMiddleware } from '@web3auth/auth';\n\nfunction createEthChainIdMiddleware(chainId) {\n  return (req, res, next, end) => {\n    if (req.method === \"eth_chainId\") {\n      res.result = chainId;\n      return end();\n    }\n    return next();\n  };\n}\nfunction createEthProviderConfigMiddleware(providerConfig) {\n  return (req, res, next, end) => {\n    if (req.method === \"eth_provider_config\") {\n      res.result = providerConfig;\n      return end();\n    }\n    return next();\n  };\n}\nfunction createEthJsonRpcClient(providerConfig) {\n  const {\n    chainId,\n    rpcTarget\n  } = providerConfig;\n  const fetchMiddleware = createFetchMiddleware({\n    rpcTarget\n  });\n  const networkMiddleware = mergeMiddleware([createEthChainIdMiddleware(chainId), createEthProviderConfigMiddleware(providerConfig), fetchMiddleware]);\n  return {\n    networkMiddleware,\n    fetchMiddleware\n  };\n}\n\nexport { createEthChainIdMiddleware, createEthJsonRpcClient, createEthProviderConfigMiddleware };\n", "export function utf8Count(str: string): number {\n  const strLength = str.length;\n\n  let byteLength = 0;\n  let pos = 0;\n  while (pos < strLength) {\n    let value = str.charCodeAt(pos++);\n\n    if ((value & 0xffffff80) === 0) {\n      // 1-byte\n      byteLength++;\n      continue;\n    } else if ((value & 0xfffff800) === 0) {\n      // 2-bytes\n      byteLength += 2;\n    } else {\n      // handle surrogate pair\n      if (value >= 0xd800 && value <= 0xdbff) {\n        // high surrogate\n        if (pos < strLength) {\n          const extra = str.charCodeAt(pos);\n          if ((extra & 0xfc00) === 0xdc00) {\n            ++pos;\n            value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\n          }\n        }\n      }\n\n      if ((value & 0xffff0000) === 0) {\n        // 3-byte\n        byteLength += 3;\n      } else {\n        // 4-byte\n        byteLength += 4;\n      }\n    }\n  }\n  return byteLength;\n}\n\nexport function utf8EncodeJs(str: string, output: Uint8Array, outputOffset: number): void {\n  const strLength = str.length;\n  let offset = outputOffset;\n  let pos = 0;\n  while (pos < strLength) {\n    let value = str.charCodeAt(pos++);\n\n    if ((value & 0xffffff80) === 0) {\n      // 1-byte\n      output[offset++] = value;\n      continue;\n    } else if ((value & 0xfffff800) === 0) {\n      // 2-bytes\n      output[offset++] = ((value >> 6) & 0x1f) | 0xc0;\n    } else {\n      // handle surrogate pair\n      if (value >= 0xd800 && value <= 0xdbff) {\n        // high surrogate\n        if (pos < strLength) {\n          const extra = str.charCodeAt(pos);\n          if ((extra & 0xfc00) === 0xdc00) {\n            ++pos;\n            value = ((value & 0x3ff) << 10) + (extra & 0x3ff) + 0x10000;\n          }\n        }\n      }\n\n      if ((value & 0xffff0000) === 0) {\n        // 3-byte\n        output[offset++] = ((value >> 12) & 0x0f) | 0xe0;\n        output[offset++] = ((value >> 6) & 0x3f) | 0x80;\n      } else {\n        // 4-byte\n        output[offset++] = ((value >> 18) & 0x07) | 0xf0;\n        output[offset++] = ((value >> 12) & 0x3f) | 0x80;\n        output[offset++] = ((value >> 6) & 0x3f) | 0x80;\n      }\n    }\n\n    output[offset++] = (value & 0x3f) | 0x80;\n  }\n}\n\n// TextEncoder and TextDecoder are standardized in whatwg encoding:\n// https://encoding.spec.whatwg.org/\n// and available in all the modern browsers:\n// https://caniuse.com/textencoder\n// They are available in Node.js since v12 LTS as well:\n// https://nodejs.org/api/globals.html#textencoder\n\nconst sharedTextEncoder = new TextEncoder();\n\n// This threshold should be determined by benchmarking, which might vary in engines and input data.\n// Run `npx ts-node benchmark/encode-string.ts` for details.\nconst TEXT_ENCODER_THRESHOLD = 50;\n\nexport function utf8EncodeTE(str: string, output: Uint8Array, outputOffset: number): void {\n  sharedTextEncoder.encodeInto(str, output.subarray(outputOffset));\n}\n\nexport function utf8Encode(str: string, output: Uint8Array, outputOffset: number): void {\n  if (str.length > TEXT_ENCODER_THRESHOLD) {\n    utf8EncodeTE(str, output, outputOffset);\n  } else {\n    utf8EncodeJs(str, output, outputOffset);\n  }\n}\n\nconst CHUNK_SIZE = 0x1_000;\n\nexport function utf8DecodeJs(bytes: Uint8Array, inputOffset: number, byteLength: number): string {\n  let offset = inputOffset;\n  const end = offset + byteLength;\n\n  const units: Array<number> = [];\n  let result = \"\";\n  while (offset < end) {\n    const byte1 = bytes[offset++]!;\n    if ((byte1 & 0x80) === 0) {\n      // 1 byte\n      units.push(byte1);\n    } else if ((byte1 & 0xe0) === 0xc0) {\n      // 2 bytes\n      const byte2 = bytes[offset++]! & 0x3f;\n      units.push(((byte1 & 0x1f) << 6) | byte2);\n    } else if ((byte1 & 0xf0) === 0xe0) {\n      // 3 bytes\n      const byte2 = bytes[offset++]! & 0x3f;\n      const byte3 = bytes[offset++]! & 0x3f;\n      units.push(((byte1 & 0x1f) << 12) | (byte2 << 6) | byte3);\n    } else if ((byte1 & 0xf8) === 0xf0) {\n      // 4 bytes\n      const byte2 = bytes[offset++]! & 0x3f;\n      const byte3 = bytes[offset++]! & 0x3f;\n      const byte4 = bytes[offset++]! & 0x3f;\n      let unit = ((byte1 & 0x07) << 0x12) | (byte2 << 0x0c) | (byte3 << 0x06) | byte4;\n      if (unit > 0xffff) {\n        unit -= 0x10000;\n        units.push(((unit >>> 10) & 0x3ff) | 0xd800);\n        unit = 0xdc00 | (unit & 0x3ff);\n      }\n      units.push(unit);\n    } else {\n      units.push(byte1);\n    }\n\n    if (units.length >= CHUNK_SIZE) {\n      result += String.fromCharCode(...units);\n      units.length = 0;\n    }\n  }\n\n  if (units.length > 0) {\n    result += String.fromCharCode(...units);\n  }\n\n  return result;\n}\n\nconst sharedTextDecoder = new TextDecoder();\n\n// This threshold should be determined by benchmarking, which might vary in engines and input data.\n// Run `npx ts-node benchmark/decode-string.ts` for details.\nconst TEXT_DECODER_THRESHOLD = 200;\n\nexport function utf8DecodeTD(bytes: Uint8Array, inputOffset: number, byteLength: number): string {\n  const stringBytes = bytes.subarray(inputOffset, inputOffset + byteLength);\n  return sharedTextDecoder.decode(stringBytes);\n}\n\nexport function utf8Decode(bytes: Uint8Array, inputOffset: number, byteLength: number): string {\n  if (byteLength > TEXT_DECODER_THRESHOLD) {\n    return utf8DecodeTD(bytes, inputOffset, byteLength);\n  } else {\n    return utf8DecodeJs(bytes, inputOffset, byteLength);\n  }\n}\n", "/**\n * ExtData is used to handle Extension Types that are not registered to ExtensionCodec.\n */\nexport class ExtData {\n  readonly type: number;\n  readonly data: Uint8Array | ((pos: number) => Uint8Array);\n\n  constructor(type: number, data: Uint8Array | ((pos: number) => Uint8Array)) {\n    this.type = type;\n    this.data = data;\n  }\n}\n", "export class DecodeError extends Error {\n  constructor(message: string) {\n    super(message);\n\n    // fix the prototype chain in a cross-platform way\n    const proto: typeof DecodeError.prototype = Object.create(DecodeError.prototype);\n    Object.setPrototypeOf(this, proto);\n\n    Object.defineProperty(this, \"name\", {\n      configurable: true,\n      enumerable: false,\n      value: DecodeError.name,\n    });\n  }\n}\n", "// Integer Utility\n\nexport const UINT32_MAX = 0xffff_ffff;\n\n// DataView extension to handle int64 / uint64,\n// where the actual range is 53-bits integer (a.k.a. safe integer)\n\nexport function setUint64(view: DataView, offset: number, value: number): void {\n  const high = value / 0x1_0000_0000;\n  const low = value; // high bits are truncated by DataView\n  view.setUint32(offset, high);\n  view.setUint32(offset + 4, low);\n}\n\nexport function setInt64(view: DataView, offset: number, value: number): void {\n  const high = Math.floor(value / 0x1_0000_0000);\n  const low = value; // high bits are truncated by DataView\n  view.setUint32(offset, high);\n  view.setUint32(offset + 4, low);\n}\n\nexport function getInt64(view: DataView, offset: number): number {\n  const high = view.getInt32(offset);\n  const low = view.getUint32(offset + 4);\n  return high * 0x1_0000_0000 + low;\n}\n\nexport function getUint64(view: DataView, offset: number): number {\n  const high = view.getUint32(offset);\n  const low = view.getUint32(offset + 4);\n  return high * 0x1_0000_0000 + low;\n}\n", "// https://github.com/msgpack/msgpack/blob/master/spec.md#timestamp-extension-type\nimport { DecodeError } from \"./DecodeError.ts\";\nimport { getInt64, setInt64 } from \"./utils/int.ts\";\n\nexport const EXT_TIMESTAMP = -1;\n\nexport type TimeSpec = {\n  sec: number;\n  nsec: number;\n};\n\nconst TIMESTAMP32_MAX_SEC = 0x100000000 - 1; // 32-bit unsigned int\nconst TIMESTAMP64_MAX_SEC = 0x400000000 - 1; // 34-bit unsigned int\n\nexport function encodeTimeSpecToTimestamp({ sec, nsec }: TimeSpec): Uint8Array {\n  if (sec >= 0 && nsec >= 0 && sec <= TIMESTAMP64_MAX_SEC) {\n    // Here sec >= 0 && nsec >= 0\n    if (nsec === 0 && sec <= TIMESTAMP32_MAX_SEC) {\n      // timestamp 32 = { sec32 (unsigned) }\n      const rv = new Uint8Array(4);\n      const view = new DataView(rv.buffer);\n      view.setUint32(0, sec);\n      return rv;\n    } else {\n      // timestamp 64 = { nsec30 (unsigned), sec34 (unsigned) }\n      const secHigh = sec / 0x100000000;\n      const secLow = sec & 0xffffffff;\n      const rv = new Uint8Array(8);\n      const view = new DataView(rv.buffer);\n      // nsec30 | secHigh2\n      view.setUint32(0, (nsec << 2) | (secHigh & 0x3));\n      // secLow32\n      view.setUint32(4, secLow);\n      return rv;\n    }\n  } else {\n    // timestamp 96 = { nsec32 (unsigned), sec64 (signed) }\n    const rv = new Uint8Array(12);\n    const view = new DataView(rv.buffer);\n    view.setUint32(0, nsec);\n    setInt64(view, 4, sec);\n    return rv;\n  }\n}\n\nexport function encodeDateToTimeSpec(date: Date): TimeSpec {\n  const msec = date.getTime();\n  const sec = Math.floor(msec / 1e3);\n  const nsec = (msec - sec * 1e3) * 1e6;\n\n  // Normalizes { sec, nsec } to ensure nsec is unsigned.\n  const nsecInSec = Math.floor(nsec / 1e9);\n  return {\n    sec: sec + nsecInSec,\n    nsec: nsec - nsecInSec * 1e9,\n  };\n}\n\nexport function encodeTimestampExtension(object: unknown): Uint8Array | null {\n  if (object instanceof Date) {\n    const timeSpec = encodeDateToTimeSpec(object);\n    return encodeTimeSpecToTimestamp(timeSpec);\n  } else {\n    return null;\n  }\n}\n\nexport function decodeTimestampToTimeSpec(data: Uint8Array): TimeSpec {\n  const view = new DataView(data.buffer, data.byteOffset, data.byteLength);\n\n  // data may be 32, 64, or 96 bits\n  switch (data.byteLength) {\n    case 4: {\n      // timestamp 32 = { sec32 }\n      const sec = view.getUint32(0);\n      const nsec = 0;\n      return { sec, nsec };\n    }\n    case 8: {\n      // timestamp 64 = { nsec30, sec34 }\n      const nsec30AndSecHigh2 = view.getUint32(0);\n      const secLow32 = view.getUint32(4);\n      const sec = (nsec30AndSecHigh2 & 0x3) * 0x100000000 + secLow32;\n      const nsec = nsec30AndSecHigh2 >>> 2;\n      return { sec, nsec };\n    }\n    case 12: {\n      // timestamp 96 = { nsec32 (unsigned), sec64 (signed) }\n\n      const sec = getInt64(view, 4);\n      const nsec = view.getUint32(0);\n      return { sec, nsec };\n    }\n    default:\n      throw new DecodeError(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${data.length}`);\n  }\n}\n\nexport function decodeTimestampExtension(data: Uint8Array): Date {\n  const timeSpec = decodeTimestampToTimeSpec(data);\n  return new Date(timeSpec.sec * 1e3 + timeSpec.nsec / 1e6);\n}\n\nexport const timestampExtension = {\n  type: EXT_TIMESTAMP,\n  encode: encodeTimestampExtension,\n  decode: decodeTimestampExtension,\n};\n", "// ExtensionCodec to handle MessagePack extensions\n\nimport { ExtData } from \"./ExtData.ts\";\nimport { timestampExtension } from \"./timestamp.ts\";\n\nexport type ExtensionDecoderType<ContextType> = (\n  data: Uint8Array,\n  extensionType: number,\n  context: ContextType,\n) => unknown;\n\nexport type ExtensionEncoderType<ContextType> = (\n  input: unknown,\n  context: ContextType,\n) => Uint8Array | ((dataPos: number) => Uint8Array) | null;\n\n// immutable interface to ExtensionCodec\nexport type ExtensionCodecType<ContextType> = {\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  __brand?: ContextType;\n  tryToEncode(object: unknown, context: ContextType): ExtData | null;\n  decode(data: Uint8Array, extType: number, context: ContextType): unknown;\n};\n\nexport class ExtensionCodec<ContextType = undefined> implements ExtensionCodecType<ContextType> {\n  public static readonly defaultCodec: ExtensionCodecType<undefined> = new ExtensionCodec();\n\n  // ensures ExtensionCodecType<X> matches ExtensionCodec<X>\n  // this will make type errors a lot more clear\n  // eslint-disable-next-line @typescript-eslint/naming-convention\n  __brand?: ContextType;\n\n  // built-in extensions\n  private readonly builtInEncoders: Array<ExtensionEncoderType<ContextType> | undefined | null> = [];\n  private readonly builtInDecoders: Array<ExtensionDecoderType<ContextType> | undefined | null> = [];\n\n  // custom extensions\n  private readonly encoders: Array<ExtensionEncoderType<ContextType> | undefined | null> = [];\n  private readonly decoders: Array<ExtensionDecoderType<ContextType> | undefined | null> = [];\n\n  public constructor() {\n    this.register(timestampExtension);\n  }\n\n  public register({\n    type,\n    encode,\n    decode,\n  }: {\n    type: number;\n    encode: ExtensionEncoderType<ContextType>;\n    decode: ExtensionDecoderType<ContextType>;\n  }): void {\n    if (type >= 0) {\n      // custom extensions\n      this.encoders[type] = encode;\n      this.decoders[type] = decode;\n    } else {\n      // built-in extensions\n      const index = -1 - type;\n      this.builtInEncoders[index] = encode;\n      this.builtInDecoders[index] = decode;\n    }\n  }\n\n  public tryToEncode(object: unknown, context: ContextType): ExtData | null {\n    // built-in extensions\n    for (let i = 0; i < this.builtInEncoders.length; i++) {\n      const encodeExt = this.builtInEncoders[i];\n      if (encodeExt != null) {\n        const data = encodeExt(object, context);\n        if (data != null) {\n          const type = -1 - i;\n          return new ExtData(type, data);\n        }\n      }\n    }\n\n    // custom extensions\n    for (let i = 0; i < this.encoders.length; i++) {\n      const encodeExt = this.encoders[i];\n      if (encodeExt != null) {\n        const data = encodeExt(object, context);\n        if (data != null) {\n          const type = i;\n          return new ExtData(type, data);\n        }\n      }\n    }\n\n    if (object instanceof ExtData) {\n      // to keep ExtData as is\n      return object;\n    }\n    return null;\n  }\n\n  public decode(data: Uint8Array, type: number, context: ContextType): unknown {\n    const decodeExt = type < 0 ? this.builtInDecoders[-1 - type] : this.decoders[type];\n    if (decodeExt) {\n      return decodeExt(data, type, context);\n    } else {\n      // decode() does not fail, returns ExtData instead.\n      return new ExtData(type, data);\n    }\n  }\n}\n", "function isArrayBufferLike(buffer: unknown): buffer is ArrayBufferLike {\n  return (\n    buffer instanceof ArrayBuffer || (typeof SharedArrayBuffer !== \"undefined\" && buffer instanceof SharedArrayBuffer)\n  );\n}\n\nexport function ensureUint8Array(\n  buffer: ArrayLike<number> | Uint8Array<ArrayBufferLike> | ArrayBufferView | ArrayBufferLike,\n): Uint8Array<ArrayBufferLike> {\n  if (buffer instanceof Uint8Array) {\n    return buffer;\n  } else if (ArrayBuffer.isView(buffer)) {\n    return new Uint8Array(buffer.buffer, buffer.byteOffset, buffer.byteLength);\n  } else if (isArrayBufferLike(buffer)) {\n    return new Uint8Array(buffer);\n  } else {\n    // ArrayLike<number>\n    return Uint8Array.from(buffer);\n  }\n}\n", "import { utf8Count, utf8Encode } from \"./utils/utf8.ts\";\nimport { ExtensionCodec } from \"./ExtensionCodec.ts\";\nimport { setInt64, setUint64 } from \"./utils/int.ts\";\nimport { ensureUint8Array } from \"./utils/typedArrays.ts\";\nimport type { ExtData } from \"./ExtData.ts\";\nimport type { ContextOf } from \"./context.ts\";\nimport type { ExtensionCodecType } from \"./ExtensionCodec.ts\";\n\nexport const DEFAULT_MAX_DEPTH = 100;\nexport const DEFAULT_INITIAL_BUFFER_SIZE = 2048;\n\nexport type EncoderOptions<ContextType = undefined> = Partial<\n  Readonly<{\n    extensionCodec: ExtensionCodecType<ContextType>;\n\n    /**\n     * Encodes bigint as Int64 or Uint64 if it's set to true.\n     * {@link forceIntegerToFloat} does not affect bigint.\n     * Depends on ES2020's {@link DataView#setBigInt64} and\n     * {@link DataView#setBigUint64}.\n     *\n     * Defaults to false.\n     */\n    useBigInt64: boolean;\n\n    /**\n     * The maximum depth in nested objects and arrays.\n     *\n     * Defaults to 100.\n     */\n    maxDepth: number;\n\n    /**\n     * The initial size of the internal buffer.\n     *\n     * Defaults to 2048.\n     */\n    initialBufferSize: number;\n\n    /**\n     * If `true`, the keys of an object is sorted. In other words, the encoded\n     * binary is canonical and thus comparable to another encoded binary.\n     *\n     * Defaults to `false`. If enabled, it spends more time in encoding objects.\n     */\n    sortKeys: boolean;\n    /**\n     * If `true`, non-integer numbers are encoded in float32, not in float64 (the default).\n     *\n     * Only use it if precisions don't matter.\n     *\n     * Defaults to `false`.\n     */\n    forceFloat32: boolean;\n\n    /**\n     * If `true`, an object property with `undefined` value are ignored.\n     * e.g. `{ foo: undefined }` will be encoded as `{}`, as `JSON.stringify()` does.\n     *\n     * Defaults to `false`. If enabled, it spends more time in encoding objects.\n     */\n    ignoreUndefined: boolean;\n\n    /**\n     * If `true`, integer numbers are encoded as floating point numbers,\n     * with the `forceFloat32` option taken into account.\n     *\n     * Defaults to `false`.\n     */\n    forceIntegerToFloat: boolean;\n  }>\n> &\n  ContextOf<ContextType>;\n\nexport class Encoder<ContextType = undefined> {\n  private readonly extensionCodec: ExtensionCodecType<ContextType>;\n  private readonly context: ContextType;\n  private readonly useBigInt64: boolean;\n  private readonly maxDepth: number;\n  private readonly initialBufferSize: number;\n  private readonly sortKeys: boolean;\n  private readonly forceFloat32: boolean;\n  private readonly ignoreUndefined: boolean;\n  private readonly forceIntegerToFloat: boolean;\n\n  private pos: number;\n  private view: DataView;\n  private bytes: Uint8Array;\n\n  private entered = false;\n\n  public constructor(options?: EncoderOptions<ContextType>) {\n    this.extensionCodec = options?.extensionCodec ?? (ExtensionCodec.defaultCodec as ExtensionCodecType<ContextType>);\n    this.context = (options as { context: ContextType } | undefined)?.context as ContextType; // needs a type assertion because EncoderOptions has no context property when ContextType is undefined\n\n    this.useBigInt64 = options?.useBigInt64 ?? false;\n    this.maxDepth = options?.maxDepth ?? DEFAULT_MAX_DEPTH;\n    this.initialBufferSize = options?.initialBufferSize ?? DEFAULT_INITIAL_BUFFER_SIZE;\n    this.sortKeys = options?.sortKeys ?? false;\n    this.forceFloat32 = options?.forceFloat32 ?? false;\n    this.ignoreUndefined = options?.ignoreUndefined ?? false;\n    this.forceIntegerToFloat = options?.forceIntegerToFloat ?? false;\n\n    this.pos = 0;\n    this.view = new DataView(new ArrayBuffer(this.initialBufferSize));\n    this.bytes = new Uint8Array(this.view.buffer);\n  }\n\n  private clone() {\n    // Because of slightly special argument `context`,\n    // type assertion is needed.\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n    return new Encoder<ContextType>({\n      extensionCodec: this.extensionCodec,\n      context: this.context,\n      useBigInt64: this.useBigInt64,\n      maxDepth: this.maxDepth,\n      initialBufferSize: this.initialBufferSize,\n      sortKeys: this.sortKeys,\n      forceFloat32: this.forceFloat32,\n      ignoreUndefined: this.ignoreUndefined,\n      forceIntegerToFloat: this.forceIntegerToFloat,\n    } as any);\n  }\n\n  private reinitializeState() {\n    this.pos = 0;\n  }\n\n  /**\n   * This is almost equivalent to {@link Encoder#encode}, but it returns an reference of the encoder's internal buffer and thus much faster than {@link Encoder#encode}.\n   *\n   * @returns Encodes the object and returns a shared reference the encoder's internal buffer.\n   */\n  public encodeSharedRef(object: unknown): Uint8Array {\n    if (this.entered) {\n      const instance = this.clone();\n      return instance.encodeSharedRef(object);\n    }\n\n    try {\n      this.entered = true;\n\n      this.reinitializeState();\n      this.doEncode(object, 1);\n      return this.bytes.subarray(0, this.pos);\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  /**\n   * @returns Encodes the object and returns a copy of the encoder's internal buffer.\n   */\n  public encode(object: unknown): Uint8Array {\n    if (this.entered) {\n      const instance = this.clone();\n      return instance.encode(object);\n    }\n\n    try {\n      this.entered = true;\n\n      this.reinitializeState();\n      this.doEncode(object, 1);\n      return this.bytes.slice(0, this.pos);\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  private doEncode(object: unknown, depth: number): void {\n    if (depth > this.maxDepth) {\n      throw new Error(`Too deep objects in depth ${depth}`);\n    }\n\n    if (object == null) {\n      this.encodeNil();\n    } else if (typeof object === \"boolean\") {\n      this.encodeBoolean(object);\n    } else if (typeof object === \"number\") {\n      if (!this.forceIntegerToFloat) {\n        this.encodeNumber(object);\n      } else {\n        this.encodeNumberAsFloat(object);\n      }\n    } else if (typeof object === \"string\") {\n      this.encodeString(object);\n    } else if (this.useBigInt64 && typeof object === \"bigint\") {\n      this.encodeBigInt64(object);\n    } else {\n      this.encodeObject(object, depth);\n    }\n  }\n\n  private ensureBufferSizeToWrite(sizeToWrite: number) {\n    const requiredSize = this.pos + sizeToWrite;\n\n    if (this.view.byteLength < requiredSize) {\n      this.resizeBuffer(requiredSize * 2);\n    }\n  }\n\n  private resizeBuffer(newSize: number) {\n    const newBuffer = new ArrayBuffer(newSize);\n    const newBytes = new Uint8Array(newBuffer);\n    const newView = new DataView(newBuffer);\n\n    newBytes.set(this.bytes);\n\n    this.view = newView;\n    this.bytes = newBytes;\n  }\n\n  private encodeNil() {\n    this.writeU8(0xc0);\n  }\n\n  private encodeBoolean(object: boolean) {\n    if (object === false) {\n      this.writeU8(0xc2);\n    } else {\n      this.writeU8(0xc3);\n    }\n  }\n\n  private encodeNumber(object: number): void {\n    if (!this.forceIntegerToFloat && Number.isSafeInteger(object)) {\n      if (object >= 0) {\n        if (object < 0x80) {\n          // positive fixint\n          this.writeU8(object);\n        } else if (object < 0x100) {\n          // uint 8\n          this.writeU8(0xcc);\n          this.writeU8(object);\n        } else if (object < 0x10000) {\n          // uint 16\n          this.writeU8(0xcd);\n          this.writeU16(object);\n        } else if (object < 0x100000000) {\n          // uint 32\n          this.writeU8(0xce);\n          this.writeU32(object);\n        } else if (!this.useBigInt64) {\n          // uint 64\n          this.writeU8(0xcf);\n          this.writeU64(object);\n        } else {\n          this.encodeNumberAsFloat(object);\n        }\n      } else {\n        if (object >= -0x20) {\n          // negative fixint\n          this.writeU8(0xe0 | (object + 0x20));\n        } else if (object >= -0x80) {\n          // int 8\n          this.writeU8(0xd0);\n          this.writeI8(object);\n        } else if (object >= -0x8000) {\n          // int 16\n          this.writeU8(0xd1);\n          this.writeI16(object);\n        } else if (object >= -0x80000000) {\n          // int 32\n          this.writeU8(0xd2);\n          this.writeI32(object);\n        } else if (!this.useBigInt64) {\n          // int 64\n          this.writeU8(0xd3);\n          this.writeI64(object);\n        } else {\n          this.encodeNumberAsFloat(object);\n        }\n      }\n    } else {\n      this.encodeNumberAsFloat(object);\n    }\n  }\n\n  private encodeNumberAsFloat(object: number): void {\n    if (this.forceFloat32) {\n      // float 32\n      this.writeU8(0xca);\n      this.writeF32(object);\n    } else {\n      // float 64\n      this.writeU8(0xcb);\n      this.writeF64(object);\n    }\n  }\n\n  private encodeBigInt64(object: bigint): void {\n    if (object >= BigInt(0)) {\n      // uint 64\n      this.writeU8(0xcf);\n      this.writeBigUint64(object);\n    } else {\n      // int 64\n      this.writeU8(0xd3);\n      this.writeBigInt64(object);\n    }\n  }\n\n  private writeStringHeader(byteLength: number) {\n    if (byteLength < 32) {\n      // fixstr\n      this.writeU8(0xa0 + byteLength);\n    } else if (byteLength < 0x100) {\n      // str 8\n      this.writeU8(0xd9);\n      this.writeU8(byteLength);\n    } else if (byteLength < 0x10000) {\n      // str 16\n      this.writeU8(0xda);\n      this.writeU16(byteLength);\n    } else if (byteLength < 0x100000000) {\n      // str 32\n      this.writeU8(0xdb);\n      this.writeU32(byteLength);\n    } else {\n      throw new Error(`Too long string: ${byteLength} bytes in UTF-8`);\n    }\n  }\n\n  private encodeString(object: string) {\n    const maxHeaderSize = 1 + 4;\n\n    const byteLength = utf8Count(object);\n    this.ensureBufferSizeToWrite(maxHeaderSize + byteLength);\n    this.writeStringHeader(byteLength);\n    utf8Encode(object, this.bytes, this.pos);\n    this.pos += byteLength;\n  }\n\n  private encodeObject(object: unknown, depth: number) {\n    // try to encode objects with custom codec first of non-primitives\n    const ext = this.extensionCodec.tryToEncode(object, this.context);\n    if (ext != null) {\n      this.encodeExtension(ext);\n    } else if (Array.isArray(object)) {\n      this.encodeArray(object, depth);\n    } else if (ArrayBuffer.isView(object)) {\n      this.encodeBinary(object);\n    } else if (typeof object === \"object\") {\n      this.encodeMap(object as Record<string, unknown>, depth);\n    } else {\n      // symbol, function and other special object come here unless extensionCodec handles them.\n      throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(object)}`);\n    }\n  }\n\n  private encodeBinary(object: ArrayBufferView) {\n    const size = object.byteLength;\n    if (size < 0x100) {\n      // bin 8\n      this.writeU8(0xc4);\n      this.writeU8(size);\n    } else if (size < 0x10000) {\n      // bin 16\n      this.writeU8(0xc5);\n      this.writeU16(size);\n    } else if (size < 0x100000000) {\n      // bin 32\n      this.writeU8(0xc6);\n      this.writeU32(size);\n    } else {\n      throw new Error(`Too large binary: ${size}`);\n    }\n    const bytes = ensureUint8Array(object);\n    this.writeU8a(bytes);\n  }\n\n  private encodeArray(object: Array<unknown>, depth: number) {\n    const size = object.length;\n    if (size < 16) {\n      // fixarray\n      this.writeU8(0x90 + size);\n    } else if (size < 0x10000) {\n      // array 16\n      this.writeU8(0xdc);\n      this.writeU16(size);\n    } else if (size < 0x100000000) {\n      // array 32\n      this.writeU8(0xdd);\n      this.writeU32(size);\n    } else {\n      throw new Error(`Too large array: ${size}`);\n    }\n    for (const item of object) {\n      this.doEncode(item, depth + 1);\n    }\n  }\n\n  private countWithoutUndefined(object: Record<string, unknown>, keys: ReadonlyArray<string>): number {\n    let count = 0;\n\n    for (const key of keys) {\n      if (object[key] !== undefined) {\n        count++;\n      }\n    }\n\n    return count;\n  }\n\n  private encodeMap(object: Record<string, unknown>, depth: number) {\n    const keys = Object.keys(object);\n    if (this.sortKeys) {\n      keys.sort();\n    }\n\n    const size = this.ignoreUndefined ? this.countWithoutUndefined(object, keys) : keys.length;\n\n    if (size < 16) {\n      // fixmap\n      this.writeU8(0x80 + size);\n    } else if (size < 0x10000) {\n      // map 16\n      this.writeU8(0xde);\n      this.writeU16(size);\n    } else if (size < 0x100000000) {\n      // map 32\n      this.writeU8(0xdf);\n      this.writeU32(size);\n    } else {\n      throw new Error(`Too large map object: ${size}`);\n    }\n\n    for (const key of keys) {\n      const value = object[key];\n\n      if (!(this.ignoreUndefined && value === undefined)) {\n        this.encodeString(key);\n        this.doEncode(value, depth + 1);\n      }\n    }\n  }\n\n  private encodeExtension(ext: ExtData) {\n    if (typeof ext.data === \"function\") {\n      const data = ext.data(this.pos + 6);\n      const size = data.length;\n\n      if (size >= 0x100000000) {\n        throw new Error(`Too large extension object: ${size}`);\n      }\n\n      this.writeU8(0xc9);\n      this.writeU32(size);\n      this.writeI8(ext.type);\n      this.writeU8a(data);\n      return;\n    }\n\n    const size = ext.data.length;\n    if (size === 1) {\n      // fixext 1\n      this.writeU8(0xd4);\n    } else if (size === 2) {\n      // fixext 2\n      this.writeU8(0xd5);\n    } else if (size === 4) {\n      // fixext 4\n      this.writeU8(0xd6);\n    } else if (size === 8) {\n      // fixext 8\n      this.writeU8(0xd7);\n    } else if (size === 16) {\n      // fixext 16\n      this.writeU8(0xd8);\n    } else if (size < 0x100) {\n      // ext 8\n      this.writeU8(0xc7);\n      this.writeU8(size);\n    } else if (size < 0x10000) {\n      // ext 16\n      this.writeU8(0xc8);\n      this.writeU16(size);\n    } else if (size < 0x100000000) {\n      // ext 32\n      this.writeU8(0xc9);\n      this.writeU32(size);\n    } else {\n      throw new Error(`Too large extension object: ${size}`);\n    }\n    this.writeI8(ext.type);\n    this.writeU8a(ext.data);\n  }\n\n  private writeU8(value: number) {\n    this.ensureBufferSizeToWrite(1);\n\n    this.view.setUint8(this.pos, value);\n    this.pos++;\n  }\n\n  private writeU8a(values: ArrayLike<number>) {\n    const size = values.length;\n    this.ensureBufferSizeToWrite(size);\n\n    this.bytes.set(values, this.pos);\n    this.pos += size;\n  }\n\n  private writeI8(value: number) {\n    this.ensureBufferSizeToWrite(1);\n\n    this.view.setInt8(this.pos, value);\n    this.pos++;\n  }\n\n  private writeU16(value: number) {\n    this.ensureBufferSizeToWrite(2);\n\n    this.view.setUint16(this.pos, value);\n    this.pos += 2;\n  }\n\n  private writeI16(value: number) {\n    this.ensureBufferSizeToWrite(2);\n\n    this.view.setInt16(this.pos, value);\n    this.pos += 2;\n  }\n\n  private writeU32(value: number) {\n    this.ensureBufferSizeToWrite(4);\n\n    this.view.setUint32(this.pos, value);\n    this.pos += 4;\n  }\n\n  private writeI32(value: number) {\n    this.ensureBufferSizeToWrite(4);\n\n    this.view.setInt32(this.pos, value);\n    this.pos += 4;\n  }\n\n  private writeF32(value: number) {\n    this.ensureBufferSizeToWrite(4);\n\n    this.view.setFloat32(this.pos, value);\n    this.pos += 4;\n  }\n\n  private writeF64(value: number) {\n    this.ensureBufferSizeToWrite(8);\n\n    this.view.setFloat64(this.pos, value);\n    this.pos += 8;\n  }\n\n  private writeU64(value: number) {\n    this.ensureBufferSizeToWrite(8);\n\n    setUint64(this.view, this.pos, value);\n    this.pos += 8;\n  }\n\n  private writeI64(value: number) {\n    this.ensureBufferSizeToWrite(8);\n\n    setInt64(this.view, this.pos, value);\n    this.pos += 8;\n  }\n\n  private writeBigUint64(value: bigint) {\n    this.ensureBufferSizeToWrite(8);\n\n    this.view.setBigUint64(this.pos, value);\n    this.pos += 8;\n  }\n\n  private writeBigInt64(value: bigint) {\n    this.ensureBufferSizeToWrite(8);\n\n    this.view.setBigInt64(this.pos, value);\n    this.pos += 8;\n  }\n}\n", "import { Encoder } from \"./Encoder.ts\";\nimport type { EncoderOptions } from \"./Encoder.ts\";\nimport type { SplitUndefined } from \"./context.ts\";\n\n/**\n * It encodes `value` in the MessagePack format and\n * returns a byte buffer.\n *\n * The returned buffer is a slice of a larger `ArrayBuffer`, so you have to use its `#byteOffset` and `#byteLength` in order to convert it to another typed arrays including NodeJS `Buffer`.\n */\nexport function encode<ContextType = undefined>(\n  value: unknown,\n  options?: EncoderOptions<SplitUndefined<ContextType>>,\n): Uint8Array {\n  const encoder = new Encoder(options);\n  return encoder.encodeSharedRef(value);\n}\n", "export function prettyByte(byte: number): string {\n  return `${byte < 0 ? \"-\" : \"\"}0x${Math.abs(byte).toString(16).padStart(2, \"0\")}`;\n}\n", "import { utf8DecodeJs } from \"./utils/utf8.ts\";\n\nconst DEFAULT_MAX_KEY_LENGTH = 16;\nconst DEFAULT_MAX_LENGTH_PER_KEY = 16;\n\nexport interface KeyDecoder {\n  canBeCached(byteLength: number): boolean;\n  decode(bytes: Uint8Array, inputOffset: number, byteLength: number): string;\n}\ninterface KeyCacheRecord {\n  readonly bytes: Uint8Array;\n  readonly str: string;\n}\n\nexport class CachedKeyDecoder implements KeyDecoder {\n  hit = 0;\n  miss = 0;\n  private readonly caches: Array<Array<KeyCacheRecord>>;\n  readonly maxKeyLength: number;\n  readonly maxLengthPerKey: number;\n\n  constructor(maxKeyLength = DEFAULT_MAX_KEY_LENGTH, maxLengthPerKey = DEFAULT_MAX_LENGTH_PER_KEY) {\n    this.maxKeyLength = maxKeyLength;\n    this.maxLengthPerKey = maxLengthPerKey;\n\n    // avoid `new Array(N)`, which makes a sparse array,\n    // because a sparse array is typically slower than a non-sparse array.\n    this.caches = [];\n    for (let i = 0; i < this.maxKeyLength; i++) {\n      this.caches.push([]);\n    }\n  }\n\n  public canBeCached(byteLength: number): boolean {\n    return byteLength > 0 && byteLength <= this.maxKeyLength;\n  }\n\n  private find(bytes: Uint8Array, inputOffset: number, byteLength: number): string | null {\n    const records = this.caches[byteLength - 1]!;\n\n    FIND_CHUNK: for (const record of records) {\n      const recordBytes = record.bytes;\n\n      for (let j = 0; j < byteLength; j++) {\n        if (recordBytes[j] !== bytes[inputOffset + j]) {\n          continue FIND_CHUNK;\n        }\n      }\n      return record.str;\n    }\n    return null;\n  }\n\n  private store(bytes: Uint8Array, value: string) {\n    const records = this.caches[bytes.length - 1]!;\n    const record: KeyCacheRecord = { bytes, str: value };\n\n    if (records.length >= this.maxLengthPerKey) {\n      // `records` are full!\n      // Set `record` to an arbitrary position.\n      records[(Math.random() * records.length) | 0] = record;\n    } else {\n      records.push(record);\n    }\n  }\n\n  public decode(bytes: Uint8Array, inputOffset: number, byteLength: number): string {\n    const cachedValue = this.find(bytes, inputOffset, byteLength);\n    if (cachedValue != null) {\n      this.hit++;\n      return cachedValue;\n    }\n    this.miss++;\n\n    const str = utf8DecodeJs(bytes, inputOffset, byteLength);\n    // Ensure to copy a slice of bytes because the bytes may be a NodeJS Buffer and Buffer#slice() returns a reference to its internal ArrayBuffer.\n    const slicedCopyOfBytes = Uint8Array.prototype.slice.call(bytes, inputOffset, inputOffset + byteLength);\n    this.store(slicedCopyOfBytes, str);\n    return str;\n  }\n}\n", "import { prettyByte } from \"./utils/prettyByte.ts\";\nimport { ExtensionCodec } from \"./ExtensionCodec.ts\";\nimport { getInt64, getUint64, UINT32_MAX } from \"./utils/int.ts\";\nimport { utf8Decode } from \"./utils/utf8.ts\";\nimport { ensureUint8Array } from \"./utils/typedArrays.ts\";\nimport { CachedKeyDecoder } from \"./CachedKeyDecoder.ts\";\nimport { DecodeError } from \"./DecodeError.ts\";\nimport type { ContextOf } from \"./context.ts\";\nimport type { ExtensionCodecType } from \"./ExtensionCodec.ts\";\nimport type { KeyDecoder } from \"./CachedKeyDecoder.ts\";\n\nexport type DecoderOptions<ContextType = undefined> = Readonly<\n  Partial<{\n    extensionCodec: ExtensionCodecType<ContextType>;\n\n    /**\n     * Decodes Int64 and Uint64 as bigint if it's set to true.\n     * Depends on ES2020's {@link DataView#getBigInt64} and\n     * {@link DataView#getBigUint64}.\n     *\n     * Defaults to false.\n     */\n    useBigInt64: boolean;\n\n    /**\n     * By default, string values will be decoded as UTF-8 strings. However, if this option is true,\n     * string values will be returned as Uint8Arrays without additional decoding.\n     *\n     * This is useful if the strings may contain invalid UTF-8 sequences.\n     *\n     * Note that this option only applies to string values, not map keys. Additionally, when\n     * enabled, raw string length is limited by the maxBinLength option.\n     */\n    rawStrings: boolean;\n\n    /**\n     * Maximum string length.\n     *\n     * Defaults to 4_294_967_295 (UINT32_MAX).\n     */\n    maxStrLength: number;\n    /**\n     * Maximum binary length.\n     *\n     * Defaults to 4_294_967_295 (UINT32_MAX).\n     */\n    maxBinLength: number;\n    /**\n     * Maximum array length.\n     *\n     * Defaults to 4_294_967_295 (UINT32_MAX).\n     */\n    maxArrayLength: number;\n    /**\n     * Maximum map length.\n     *\n     * Defaults to 4_294_967_295 (UINT32_MAX).\n     */\n    maxMapLength: number;\n    /**\n     * Maximum extension length.\n     *\n     * Defaults to 4_294_967_295 (UINT32_MAX).\n     */\n    maxExtLength: number;\n\n    /**\n     * An object key decoder. Defaults to the shared instance of {@link CachedKeyDecoder}.\n     * `null` is a special value to disable the use of the key decoder at all.\n     */\n    keyDecoder: KeyDecoder | null;\n\n    /**\n     * A function to convert decoded map key to a valid JS key type.\n     *\n     * Defaults to a function that throws an error if the key is not a string or a number.\n     */\n    mapKeyConverter: (key: unknown) => MapKeyType;\n  }>\n> &\n  ContextOf<ContextType>;\n\nconst STATE_ARRAY = \"array\";\nconst STATE_MAP_KEY = \"map_key\";\nconst STATE_MAP_VALUE = \"map_value\";\n\ntype MapKeyType = string | number;\n\nconst mapKeyConverter = (key: unknown): MapKeyType => {\n  if (typeof key === \"string\" || typeof key === \"number\") {\n    return key;\n  }\n  throw new DecodeError(\"The type of key must be string or number but \" + typeof key);\n};\n\ntype StackMapState = {\n  type: typeof STATE_MAP_KEY | typeof STATE_MAP_VALUE;\n  size: number;\n  key: MapKeyType | null;\n  readCount: number;\n  map: Record<string, unknown>;\n};\n\ntype StackArrayState = {\n  type: typeof STATE_ARRAY;\n  size: number;\n  array: Array<unknown>;\n  position: number;\n};\n\nclass StackPool {\n  private readonly stack: Array<StackState> = [];\n  private stackHeadPosition = -1;\n\n  public get length(): number {\n    return this.stackHeadPosition + 1;\n  }\n\n  public top(): StackState | undefined {\n    return this.stack[this.stackHeadPosition];\n  }\n\n  public pushArrayState(size: number) {\n    const state = this.getUninitializedStateFromPool() as StackArrayState;\n\n    state.type = STATE_ARRAY;\n    state.position = 0;\n    state.size = size;\n    state.array = new Array(size);\n  }\n\n  public pushMapState(size: number) {\n    const state = this.getUninitializedStateFromPool() as StackMapState;\n\n    state.type = STATE_MAP_KEY;\n    state.readCount = 0;\n    state.size = size;\n    state.map = {};\n  }\n\n  private getUninitializedStateFromPool() {\n    this.stackHeadPosition++;\n\n    if (this.stackHeadPosition === this.stack.length) {\n      const partialState: Partial<StackState> = {\n        type: undefined,\n        size: 0,\n        array: undefined,\n        position: 0,\n        readCount: 0,\n        map: undefined,\n        key: null,\n      };\n\n      this.stack.push(partialState as StackState);\n    }\n\n    return this.stack[this.stackHeadPosition];\n  }\n\n  public release(state: StackState): void {\n    const topStackState = this.stack[this.stackHeadPosition];\n\n    if (topStackState !== state) {\n      throw new Error(\"Invalid stack state. Released state is not on top of the stack.\");\n    }\n\n    if (state.type === STATE_ARRAY) {\n      const partialState = state as Partial<StackArrayState>;\n      partialState.size = 0;\n      partialState.array = undefined;\n      partialState.position = 0;\n      partialState.type = undefined;\n    }\n\n    if (state.type === STATE_MAP_KEY || state.type === STATE_MAP_VALUE) {\n      const partialState = state as Partial<StackMapState>;\n      partialState.size = 0;\n      partialState.map = undefined;\n      partialState.readCount = 0;\n      partialState.type = undefined;\n    }\n\n    this.stackHeadPosition--;\n  }\n\n  public reset(): void {\n    this.stack.length = 0;\n    this.stackHeadPosition = -1;\n  }\n}\n\ntype StackState = StackArrayState | StackMapState;\n\nconst HEAD_BYTE_REQUIRED = -1;\n\nconst EMPTY_VIEW = new DataView<ArrayBufferLike>(new ArrayBuffer(0));\nconst EMPTY_BYTES = new Uint8Array<ArrayBufferLike>(EMPTY_VIEW.buffer);\n\ntry {\n  // IE11: The spec says it should throw RangeError,\n  // IE11: but in IE11 it throws TypeError.\n  EMPTY_VIEW.getInt8(0);\n} catch (e) {\n  if (!(e instanceof RangeError)) {\n    throw new Error(\n      \"This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access\",\n    );\n  }\n}\n\nconst MORE_DATA = new RangeError(\"Insufficient data\");\n\nconst sharedCachedKeyDecoder = new CachedKeyDecoder();\n\nexport class Decoder<ContextType = undefined> {\n  private readonly extensionCodec: ExtensionCodecType<ContextType>;\n  private readonly context: ContextType;\n  private readonly useBigInt64: boolean;\n  private readonly rawStrings: boolean;\n  private readonly maxStrLength: number;\n  private readonly maxBinLength: number;\n  private readonly maxArrayLength: number;\n  private readonly maxMapLength: number;\n  private readonly maxExtLength: number;\n  private readonly keyDecoder: KeyDecoder | null;\n  private readonly mapKeyConverter: (key: unknown) => MapKeyType;\n\n  private totalPos = 0;\n  private pos = 0;\n\n  private view = EMPTY_VIEW;\n  private bytes = EMPTY_BYTES;\n  private headByte = HEAD_BYTE_REQUIRED;\n  private readonly stack = new StackPool();\n\n  private entered = false;\n\n  public constructor(options?: DecoderOptions<ContextType>) {\n    this.extensionCodec = options?.extensionCodec ?? (ExtensionCodec.defaultCodec as ExtensionCodecType<ContextType>);\n    this.context = (options as { context: ContextType } | undefined)?.context as ContextType; // needs a type assertion because EncoderOptions has no context property when ContextType is undefined\n\n    this.useBigInt64 = options?.useBigInt64 ?? false;\n    this.rawStrings = options?.rawStrings ?? false;\n    this.maxStrLength = options?.maxStrLength ?? UINT32_MAX;\n    this.maxBinLength = options?.maxBinLength ?? UINT32_MAX;\n    this.maxArrayLength = options?.maxArrayLength ?? UINT32_MAX;\n    this.maxMapLength = options?.maxMapLength ?? UINT32_MAX;\n    this.maxExtLength = options?.maxExtLength ?? UINT32_MAX;\n    this.keyDecoder = options?.keyDecoder !== undefined ? options.keyDecoder : sharedCachedKeyDecoder;\n    this.mapKeyConverter = options?.mapKeyConverter ?? mapKeyConverter;\n  }\n\n  private clone(): Decoder<ContextType> {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n    return new Decoder({\n      extensionCodec: this.extensionCodec,\n      context: this.context,\n      useBigInt64: this.useBigInt64,\n      rawStrings: this.rawStrings,\n      maxStrLength: this.maxStrLength,\n      maxBinLength: this.maxBinLength,\n      maxArrayLength: this.maxArrayLength,\n      maxMapLength: this.maxMapLength,\n      maxExtLength: this.maxExtLength,\n      keyDecoder: this.keyDecoder,\n    } as any);\n  }\n\n  private reinitializeState() {\n    this.totalPos = 0;\n    this.headByte = HEAD_BYTE_REQUIRED;\n    this.stack.reset();\n\n    // view, bytes, and pos will be re-initialized in setBuffer()\n  }\n\n  private setBuffer(buffer: ArrayLike<number> | ArrayBufferView | ArrayBufferLike): void {\n    const bytes = ensureUint8Array(buffer);\n    this.bytes = bytes;\n    this.view = new DataView(bytes.buffer, bytes.byteOffset, bytes.byteLength);\n    this.pos = 0;\n  }\n\n  private appendBuffer(buffer: ArrayLike<number> | ArrayBufferView | ArrayBufferLike): void {\n    if (this.headByte === HEAD_BYTE_REQUIRED && !this.hasRemaining(1)) {\n      this.setBuffer(buffer);\n    } else {\n      const remainingData = this.bytes.subarray(this.pos);\n      const newData = ensureUint8Array(buffer);\n\n      // concat remainingData + newData\n      const newBuffer = new Uint8Array(remainingData.length + newData.length);\n      newBuffer.set(remainingData);\n      newBuffer.set(newData, remainingData.length);\n      this.setBuffer(newBuffer);\n    }\n  }\n\n  private hasRemaining(size: number) {\n    return this.view.byteLength - this.pos >= size;\n  }\n\n  private createExtraByteError(posToShow: number): Error {\n    const { view, pos } = this;\n    return new RangeError(`Extra ${view.byteLength - pos} of ${view.byteLength} byte(s) found at buffer[${posToShow}]`);\n  }\n\n  /**\n   * @throws {@link DecodeError}\n   * @throws {@link RangeError}\n   */\n  public decode(buffer: ArrayLike<number> | ArrayBufferView | ArrayBufferLike): unknown {\n    if (this.entered) {\n      const instance = this.clone();\n      return instance.decode(buffer);\n    }\n\n    try {\n      this.entered = true;\n\n      this.reinitializeState();\n      this.setBuffer(buffer);\n\n      const object = this.doDecodeSync();\n      if (this.hasRemaining(1)) {\n        throw this.createExtraByteError(this.pos);\n      }\n      return object;\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  public *decodeMulti(buffer: ArrayLike<number> | ArrayBufferView | ArrayBufferLike): Generator<unknown, void, unknown> {\n    if (this.entered) {\n      const instance = this.clone();\n      yield* instance.decodeMulti(buffer);\n      return;\n    }\n\n    try {\n      this.entered = true;\n\n      this.reinitializeState();\n      this.setBuffer(buffer);\n\n      while (this.hasRemaining(1)) {\n        yield this.doDecodeSync();\n      }\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  public async decodeAsync(stream: AsyncIterable<ArrayLike<number> | ArrayBufferView | ArrayBufferLike>): Promise<unknown> {\n    if (this.entered) {\n      const instance = this.clone();\n      return instance.decodeAsync(stream);\n    }\n\n    try {\n      this.entered = true;\n\n      let decoded = false;\n      let object: unknown;\n      for await (const buffer of stream) {\n        if (decoded) {\n          this.entered = false;\n          throw this.createExtraByteError(this.totalPos);\n        }\n\n        this.appendBuffer(buffer);\n\n        try {\n          object = this.doDecodeSync();\n          decoded = true;\n        } catch (e) {\n          if (!(e instanceof RangeError)) {\n            throw e; // rethrow\n          }\n          // fallthrough\n        }\n        this.totalPos += this.pos;\n      }\n\n      if (decoded) {\n        if (this.hasRemaining(1)) {\n          throw this.createExtraByteError(this.totalPos);\n        }\n        return object;\n      }\n\n      const { headByte, pos, totalPos } = this;\n      throw new RangeError(\n        `Insufficient data in parsing ${prettyByte(headByte)} at ${totalPos} (${pos} in the current buffer)`,\n      );\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  public decodeArrayStream(\n    stream: AsyncIterable<ArrayLike<number> | ArrayBufferView | ArrayBufferLike>,\n  ): AsyncGenerator<unknown, void, unknown> {\n    return this.decodeMultiAsync(stream, true);\n  }\n\n  public decodeStream(stream: AsyncIterable<ArrayLike<number> | ArrayBufferView | ArrayBufferLike>): AsyncGenerator<unknown, void, unknown> {\n    return this.decodeMultiAsync(stream, false);\n  }\n\n  private async *decodeMultiAsync(stream: AsyncIterable<ArrayLike<number> | ArrayBufferView | ArrayBufferLike>, isArray: boolean): AsyncGenerator<unknown, void, unknown> {\n    if (this.entered) {\n      const instance = this.clone();\n      yield* instance.decodeMultiAsync(stream, isArray);\n      return;\n    }\n\n    try {\n      this.entered = true;\n\n      let isArrayHeaderRequired = isArray;\n      let arrayItemsLeft = -1;\n\n      for await (const buffer of stream) {\n        if (isArray && arrayItemsLeft === 0) {\n          throw this.createExtraByteError(this.totalPos);\n        }\n\n        this.appendBuffer(buffer);\n\n        if (isArrayHeaderRequired) {\n          arrayItemsLeft = this.readArraySize();\n          isArrayHeaderRequired = false;\n          this.complete();\n        }\n\n        try {\n          while (true) {\n            yield this.doDecodeSync();\n            if (--arrayItemsLeft === 0) {\n              break;\n            }\n          }\n        } catch (e) {\n          if (!(e instanceof RangeError)) {\n            throw e; // rethrow\n          }\n          // fallthrough\n        }\n        this.totalPos += this.pos;\n      }\n    } finally {\n      this.entered = false;\n    }\n  }\n\n  private doDecodeSync(): unknown {\n    DECODE: while (true) {\n      const headByte = this.readHeadByte();\n      let object: unknown;\n\n      if (headByte >= 0xe0) {\n        // negative fixint (111x xxxx) 0xe0 - 0xff\n        object = headByte - 0x100;\n      } else if (headByte < 0xc0) {\n        if (headByte < 0x80) {\n          // positive fixint (0xxx xxxx) 0x00 - 0x7f\n          object = headByte;\n        } else if (headByte < 0x90) {\n          // fixmap (1000 xxxx) 0x80 - 0x8f\n          const size = headByte - 0x80;\n          if (size !== 0) {\n            this.pushMapState(size);\n            this.complete();\n            continue DECODE;\n          } else {\n            object = {};\n          }\n        } else if (headByte < 0xa0) {\n          // fixarray (1001 xxxx) 0x90 - 0x9f\n          const size = headByte - 0x90;\n          if (size !== 0) {\n            this.pushArrayState(size);\n            this.complete();\n            continue DECODE;\n          } else {\n            object = [];\n          }\n        } else {\n          // fixstr (101x xxxx) 0xa0 - 0xbf\n          const byteLength = headByte - 0xa0;\n          object = this.decodeString(byteLength, 0);\n        }\n      } else if (headByte === 0xc0) {\n        // nil\n        object = null;\n      } else if (headByte === 0xc2) {\n        // false\n        object = false;\n      } else if (headByte === 0xc3) {\n        // true\n        object = true;\n      } else if (headByte === 0xca) {\n        // float 32\n        object = this.readF32();\n      } else if (headByte === 0xcb) {\n        // float 64\n        object = this.readF64();\n      } else if (headByte === 0xcc) {\n        // uint 8\n        object = this.readU8();\n      } else if (headByte === 0xcd) {\n        // uint 16\n        object = this.readU16();\n      } else if (headByte === 0xce) {\n        // uint 32\n        object = this.readU32();\n      } else if (headByte === 0xcf) {\n        // uint 64\n        if (this.useBigInt64) {\n          object = this.readU64AsBigInt();\n        } else {\n          object = this.readU64();\n        }\n      } else if (headByte === 0xd0) {\n        // int 8\n        object = this.readI8();\n      } else if (headByte === 0xd1) {\n        // int 16\n        object = this.readI16();\n      } else if (headByte === 0xd2) {\n        // int 32\n        object = this.readI32();\n      } else if (headByte === 0xd3) {\n        // int 64\n        if (this.useBigInt64) {\n          object = this.readI64AsBigInt();\n        } else {\n          object = this.readI64();\n        }\n      } else if (headByte === 0xd9) {\n        // str 8\n        const byteLength = this.lookU8();\n        object = this.decodeString(byteLength, 1);\n      } else if (headByte === 0xda) {\n        // str 16\n        const byteLength = this.lookU16();\n        object = this.decodeString(byteLength, 2);\n      } else if (headByte === 0xdb) {\n        // str 32\n        const byteLength = this.lookU32();\n        object = this.decodeString(byteLength, 4);\n      } else if (headByte === 0xdc) {\n        // array 16\n        const size = this.readU16();\n        if (size !== 0) {\n          this.pushArrayState(size);\n          this.complete();\n          continue DECODE;\n        } else {\n          object = [];\n        }\n      } else if (headByte === 0xdd) {\n        // array 32\n        const size = this.readU32();\n        if (size !== 0) {\n          this.pushArrayState(size);\n          this.complete();\n          continue DECODE;\n        } else {\n          object = [];\n        }\n      } else if (headByte === 0xde) {\n        // map 16\n        const size = this.readU16();\n        if (size !== 0) {\n          this.pushMapState(size);\n          this.complete();\n          continue DECODE;\n        } else {\n          object = {};\n        }\n      } else if (headByte === 0xdf) {\n        // map 32\n        const size = this.readU32();\n        if (size !== 0) {\n          this.pushMapState(size);\n          this.complete();\n          continue DECODE;\n        } else {\n          object = {};\n        }\n      } else if (headByte === 0xc4) {\n        // bin 8\n        const size = this.lookU8();\n        object = this.decodeBinary(size, 1);\n      } else if (headByte === 0xc5) {\n        // bin 16\n        const size = this.lookU16();\n        object = this.decodeBinary(size, 2);\n      } else if (headByte === 0xc6) {\n        // bin 32\n        const size = this.lookU32();\n        object = this.decodeBinary(size, 4);\n      } else if (headByte === 0xd4) {\n        // fixext 1\n        object = this.decodeExtension(1, 0);\n      } else if (headByte === 0xd5) {\n        // fixext 2\n        object = this.decodeExtension(2, 0);\n      } else if (headByte === 0xd6) {\n        // fixext 4\n        object = this.decodeExtension(4, 0);\n      } else if (headByte === 0xd7) {\n        // fixext 8\n        object = this.decodeExtension(8, 0);\n      } else if (headByte === 0xd8) {\n        // fixext 16\n        object = this.decodeExtension(16, 0);\n      } else if (headByte === 0xc7) {\n        // ext 8\n        const size = this.lookU8();\n        object = this.decodeExtension(size, 1);\n      } else if (headByte === 0xc8) {\n        // ext 16\n        const size = this.lookU16();\n        object = this.decodeExtension(size, 2);\n      } else if (headByte === 0xc9) {\n        // ext 32\n        const size = this.lookU32();\n        object = this.decodeExtension(size, 4);\n      } else {\n        throw new DecodeError(`Unrecognized type byte: ${prettyByte(headByte)}`);\n      }\n\n      this.complete();\n\n      const stack = this.stack;\n      while (stack.length > 0) {\n        // arrays and maps\n        const state = stack.top()!;\n        if (state.type === STATE_ARRAY) {\n          state.array[state.position] = object;\n          state.position++;\n          if (state.position === state.size) {\n            object = state.array;\n            stack.release(state);\n          } else {\n            continue DECODE;\n          }\n        } else if (state.type === STATE_MAP_KEY) {\n          if (object === \"__proto__\") {\n            throw new DecodeError(\"The key __proto__ is not allowed\");\n          }\n\n          state.key = this.mapKeyConverter(object);\n          state.type = STATE_MAP_VALUE;\n          continue DECODE;\n        } else {\n          // it must be `state.type === State.MAP_VALUE` here\n\n          state.map[state.key!] = object;\n          state.readCount++;\n\n          if (state.readCount === state.size) {\n            object = state.map;\n            stack.release(state);\n          } else {\n            state.key = null;\n            state.type = STATE_MAP_KEY;\n            continue DECODE;\n          }\n        }\n      }\n\n      return object;\n    }\n  }\n\n  private readHeadByte(): number {\n    if (this.headByte === HEAD_BYTE_REQUIRED) {\n      this.headByte = this.readU8();\n      // console.log(\"headByte\", prettyByte(this.headByte));\n    }\n\n    return this.headByte;\n  }\n\n  private complete(): void {\n    this.headByte = HEAD_BYTE_REQUIRED;\n  }\n\n  private readArraySize(): number {\n    const headByte = this.readHeadByte();\n\n    switch (headByte) {\n      case 0xdc:\n        return this.readU16();\n      case 0xdd:\n        return this.readU32();\n      default: {\n        if (headByte < 0xa0) {\n          return headByte - 0x90;\n        } else {\n          throw new DecodeError(`Unrecognized array type byte: ${prettyByte(headByte)}`);\n        }\n      }\n    }\n  }\n\n  private pushMapState(size: number) {\n    if (size > this.maxMapLength) {\n      throw new DecodeError(`Max length exceeded: map length (${size}) > maxMapLengthLength (${this.maxMapLength})`);\n    }\n\n    this.stack.pushMapState(size);\n  }\n\n  private pushArrayState(size: number) {\n    if (size > this.maxArrayLength) {\n      throw new DecodeError(`Max length exceeded: array length (${size}) > maxArrayLength (${this.maxArrayLength})`);\n    }\n\n    this.stack.pushArrayState(size);\n  }\n\n  private decodeString(byteLength: number, headerOffset: number): string | Uint8Array {\n    if (!this.rawStrings || this.stateIsMapKey()) {\n      return this.decodeUtf8String(byteLength, headerOffset);\n    }\n    return this.decodeBinary(byteLength, headerOffset);\n  }\n\n  /**\n   * @throws {@link RangeError}\n   */\n  private decodeUtf8String(byteLength: number, headerOffset: number): string {\n    if (byteLength > this.maxStrLength) {\n      throw new DecodeError(\n        `Max length exceeded: UTF-8 byte length (${byteLength}) > maxStrLength (${this.maxStrLength})`,\n      );\n    }\n\n    if (this.bytes.byteLength < this.pos + headerOffset + byteLength) {\n      throw MORE_DATA;\n    }\n\n    const offset = this.pos + headerOffset;\n    let object: string;\n    if (this.stateIsMapKey() && this.keyDecoder?.canBeCached(byteLength)) {\n      object = this.keyDecoder.decode(this.bytes, offset, byteLength);\n    } else {\n      object = utf8Decode(this.bytes, offset, byteLength);\n    }\n    this.pos += headerOffset + byteLength;\n    return object;\n  }\n\n  private stateIsMapKey(): boolean {\n    if (this.stack.length > 0) {\n      const state = this.stack.top()!;\n      return state.type === STATE_MAP_KEY;\n    }\n    return false;\n  }\n\n  /**\n   * @throws {@link RangeError}\n   */\n  private decodeBinary(byteLength: number, headOffset: number): Uint8Array {\n    if (byteLength > this.maxBinLength) {\n      throw new DecodeError(`Max length exceeded: bin length (${byteLength}) > maxBinLength (${this.maxBinLength})`);\n    }\n\n    if (!this.hasRemaining(byteLength + headOffset)) {\n      throw MORE_DATA;\n    }\n\n    const offset = this.pos + headOffset;\n    const object = this.bytes.subarray(offset, offset + byteLength);\n    this.pos += headOffset + byteLength;\n    return object;\n  }\n\n  private decodeExtension(size: number, headOffset: number): unknown {\n    if (size > this.maxExtLength) {\n      throw new DecodeError(`Max length exceeded: ext length (${size}) > maxExtLength (${this.maxExtLength})`);\n    }\n\n    const extType = this.view.getInt8(this.pos + headOffset);\n    const data = this.decodeBinary(size, headOffset + 1 /* extType */);\n    return this.extensionCodec.decode(data, extType, this.context);\n  }\n\n  private lookU8() {\n    return this.view.getUint8(this.pos);\n  }\n\n  private lookU16() {\n    return this.view.getUint16(this.pos);\n  }\n\n  private lookU32() {\n    return this.view.getUint32(this.pos);\n  }\n\n  private readU8(): number {\n    const value = this.view.getUint8(this.pos);\n    this.pos++;\n    return value;\n  }\n\n  private readI8(): number {\n    const value = this.view.getInt8(this.pos);\n    this.pos++;\n    return value;\n  }\n\n  private readU16(): number {\n    const value = this.view.getUint16(this.pos);\n    this.pos += 2;\n    return value;\n  }\n\n  private readI16(): number {\n    const value = this.view.getInt16(this.pos);\n    this.pos += 2;\n    return value;\n  }\n\n  private readU32(): number {\n    const value = this.view.getUint32(this.pos);\n    this.pos += 4;\n    return value;\n  }\n\n  private readI32(): number {\n    const value = this.view.getInt32(this.pos);\n    this.pos += 4;\n    return value;\n  }\n\n  private readU64(): number {\n    const value = getUint64(this.view, this.pos);\n    this.pos += 8;\n    return value;\n  }\n\n  private readI64(): number {\n    const value = getInt64(this.view, this.pos);\n    this.pos += 8;\n    return value;\n  }\n\n  private readU64AsBigInt(): bigint {\n    const value = this.view.getBigUint64(this.pos);\n    this.pos += 8;\n    return value;\n  }\n\n  private readI64AsBigInt(): bigint {\n    const value = this.view.getBigInt64(this.pos);\n    this.pos += 8;\n    return value;\n  }\n\n  private readF32() {\n    const value = this.view.getFloat32(this.pos);\n    this.pos += 4;\n    return value;\n  }\n\n  private readF64() {\n    const value = this.view.getFloat64(this.pos);\n    this.pos += 8;\n    return value;\n  }\n}\n", "import { Decoder } from \"./Decoder.ts\";\nimport type { DecoderOptions } from \"./Decoder.ts\";\nimport type { SplitUndefined } from \"./context.ts\";\n\n/**\n * It decodes a single MessagePack object in a buffer.\n *\n * This is a synchronous decoding function.\n * See other variants for asynchronous decoding: {@link decodeAsync}, {@link decodeMultiStream}, or {@link decodeArrayStream}.\n *\n * @throws {@link RangeError} if the buffer is incomplete, including the case where the buffer is empty.\n * @throws {@link DecodeError} if the buffer contains invalid data.\n */\nexport function decode<ContextType = undefined>(\n  buffer: ArrayLike<number> | ArrayBufferView | ArrayBufferLike,\n  options?: DecoderOptions<SplitUndefined<ContextType>>,\n): unknown {\n  const decoder = new Decoder(options);\n  return decoder.decode(buffer);\n}\n\n/**\n * It decodes multiple MessagePack objects in a buffer.\n * This is corresponding to {@link decodeMultiStream}.\n *\n * @throws {@link RangeError} if the buffer is incomplete, including the case where the buffer is empty.\n * @throws {@link DecodeError} if the buffer contains invalid data.\n */\nexport function decodeMulti<ContextType = undefined>(\n  buffer: ArrayLike<number> | BufferSource,\n  options?: DecoderOptions<SplitUndefined<ContextType>>,\n): Generator<unknown, void, unknown> {\n  const decoder = new Decoder(options);\n  return decoder.decodeMulti(buffer);\n}\n", "export function asUint8Array(buf) {\n  if (globalThis.Buffer != null) {\n    return new Uint8Array(buf.buffer, buf.byteOffset, buf.byteLength);\n  }\n  return buf;\n}", "import { asUint8Array } from './util/as-uint8array.js';\nexport function alloc(size = 0) {\n  if (globalThis.Buffer != null && globalThis.Buffer.alloc != null) {\n    return asUint8Array(globalThis.Buffer.alloc(size));\n  }\n  return new Uint8Array(size);\n}\nexport function allocUnsafe(size = 0) {\n  if (globalThis.Buffer != null && globalThis.Buffer.allocUnsafe != null) {\n    return asUint8Array(globalThis.Buffer.allocUnsafe(size));\n  }\n  return new Uint8Array(size);\n}", "import { allocUnsafe } from './alloc.js';\nimport { asUint8Array } from './util/as-uint8array.js';\nexport function concat(arrays, length) {\n  if (!length) {\n    length = arrays.reduce((acc, curr) => acc + curr.length, 0);\n  }\n  const output = allocUnsafe(length);\n  let offset = 0;\n  for (const arr of arrays) {\n    output.set(arr, offset);\n    offset += arr.length;\n  }\n  return asUint8Array(output);\n}", "import { bases } from 'multiformats/basics';\nimport { allocUnsafe } from '../alloc.js';\nfunction createCodec(name, prefix, encode, decode) {\n  return {\n    name,\n    prefix,\n    encoder: {\n      name,\n      prefix,\n      encode\n    },\n    decoder: { decode }\n  };\n}\nconst string = createCodec('utf8', 'u', buf => {\n  const decoder = new TextDecoder('utf8');\n  return 'u' + decoder.decode(buf);\n}, str => {\n  const encoder = new TextEncoder();\n  return encoder.encode(str.substring(1));\n});\nconst ascii = createCodec('ascii', 'a', buf => {\n  let string = 'a';\n  for (let i = 0; i < buf.length; i++) {\n    string += String.fromCharCode(buf[i]);\n  }\n  return string;\n}, str => {\n  str = str.substring(1);\n  const buf = allocUnsafe(str.length);\n  for (let i = 0; i < str.length; i++) {\n    buf[i] = str.charCodeAt(i);\n  }\n  return buf;\n});\nconst BASES = {\n  utf8: string,\n  'utf-8': string,\n  hex: bases.base16,\n  latin1: ascii,\n  ascii: ascii,\n  binary: ascii,\n  ...bases\n};\nexport default BASES;", "import bases from './util/bases.js';\nimport { asUint8Array } from './util/as-uint8array.js';\nexport function fromString(string, encoding = 'utf8') {\n  const base = bases[encoding];\n  if (!base) {\n    throw new Error(`Unsupported encoding \"${ encoding }\"`);\n  }\n  if ((encoding === 'utf8' || encoding === 'utf-8') && globalThis.Buffer != null && globalThis.Buffer.from != null) {\n    return asUint8Array(globalThis.Buffer.from(string, 'utf-8'));\n  }\n  return base.decoder.decode(`${ base.prefix }${ string }`);\n}", "import bases from './util/bases.js';\nexport function toString(array, encoding = 'utf8') {\n  const base = bases[encoding];\n  if (!base) {\n    throw new Error(`Unsupported encoding \"${ encoding }\"`);\n  }\n  if ((encoding === 'utf8' || encoding === 'utf-8') && globalThis.Buffer != null && globalThis.Buffer.from != null) {\n    return globalThis.Buffer.from(array.buffer, array.byteOffset, array.byteLength).toString('utf8');\n  }\n  return base.encoder.encode(array).substring(1);\n}", "import _objectSpread from '@babel/runtime/helpers/objectSpread2';\nimport { bs58 } from '@toruslabs/bs58';\nimport { getAccountsFromNamespaces, parseAccountId } from '@walletconnect/utils';\nimport { providerErrors, rpcErrors } from '@web3auth/auth';\nimport { EVM_METHOD_TYPES, SOLANA_METHOD_TYPES } from '@web3auth/ws-embed';\nimport { WalletLoginError } from '../../base/errors/index.js';\nimport { SOLANA_CAIP_CHAIN_MAP } from '../../base/constants.js';\n\nasync function getLastActiveSession(signClient) {\n  if (signClient.session.length) {\n    const lastKeyIndex = signClient.session.keys.length - 1;\n    return signClient.session.get(signClient.session.keys[lastKeyIndex]);\n  }\n  return null;\n}\nfunction isMobileDevice() {\n  return /Mobi|Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(window.navigator.userAgent);\n}\nfunction isSolanaChain(chainId) {\n  return chainId.startsWith(\"solana:\");\n}\nasync function sendJrpcRequest(signClient, chainId, method, params) {\n  const session = await getLastActiveSession(signClient);\n  if (!session) {\n    throw providerErrors.disconnected();\n  }\n  if (typeof window !== \"undefined\" && isMobileDevice()) {\n    if (session.peer.metadata.redirect && session.peer.metadata.redirect.native) {\n      window.open(session.peer.metadata.redirect.native, \"_blank\");\n    }\n  }\n  return signClient.request({\n    topic: session.topic,\n    chainId,\n    request: {\n      method,\n      params: isSolanaChain(chainId) ? _objectSpread(_objectSpread({}, params), {}, {\n        pubkey: session.self.publicKey\n      }) : params\n    }\n  });\n}\nasync function getAccounts(signClient) {\n  const session = await getLastActiveSession(signClient);\n  if (!session) {\n    throw providerErrors.disconnected();\n  }\n  const accounts = getAccountsFromNamespaces(session.namespaces);\n  if (accounts && accounts.length) {\n    return [...new Set(accounts.map(add => {\n      return parseAccountId(add).address;\n    }))];\n  }\n  throw WalletLoginError.connectionError(\"Failed to get accounts\");\n}\nfunction getEthProviderHandlers({\n  connector,\n  chainId\n}) {\n  return {\n    getPrivateKey: async () => {\n      throw rpcErrors.methodNotSupported();\n    },\n    getPublicKey: async () => {\n      throw rpcErrors.methodNotSupported();\n    },\n    getAccounts: async _ => {\n      return getAccounts(connector);\n    },\n    processTransaction: async (txParams, _) => {\n      const methodRes = await sendJrpcRequest(connector, `eip155:${chainId}`, EVM_METHOD_TYPES.ETH_TRANSACTION, [txParams]);\n      return methodRes;\n    },\n    processSignTransaction: async (txParams, _) => {\n      const methodRes = await sendJrpcRequest(connector, `eip155:${chainId}`, \"eth_signTransaction\", [txParams]);\n      return methodRes;\n    },\n    processEthSignMessage: async (msgParams, _) => {\n      const methodRes = await sendJrpcRequest(connector, `eip155:${chainId}`, EVM_METHOD_TYPES.ETH_SIGN, [msgParams.from, msgParams.data]);\n      return methodRes;\n    },\n    processPersonalMessage: async (msgParams, _) => {\n      const methodRes = await sendJrpcRequest(connector, `eip155:${chainId}`, EVM_METHOD_TYPES.PERSONAL_SIGN, [msgParams.data, msgParams.from]);\n      return methodRes;\n    },\n    processTypedMessageV4: async msgParams => {\n      const methodRes = await sendJrpcRequest(connector, `eip155:${chainId}`, EVM_METHOD_TYPES.ETH_SIGN_TYPED_DATA_V4, [msgParams.from, msgParams.data]);\n      return methodRes;\n    }\n  };\n}\nfunction getSolProviderHandlers({\n  connector,\n  chainId\n}) {\n  return {\n    requestAccounts: async _ => {\n      return getAccounts(connector);\n    },\n    getPrivateKey: async () => {\n      throw rpcErrors.methodNotSupported();\n    },\n    getSecretKey: async () => {\n      throw rpcErrors.methodNotSupported();\n    },\n    getPublicKey: async () => {\n      throw rpcErrors.methodNotSupported();\n    },\n    getAccounts: async _ => {\n      return getAccounts(connector);\n    },\n    signAllTransactions: async _ => {\n      throw rpcErrors.methodNotSupported();\n    },\n    signAndSendTransaction: async _ => {\n      throw rpcErrors.methodNotSupported();\n    },\n    signMessage: async req => {\n      const methodRes = await sendJrpcRequest(connector, `solana:${SOLANA_CAIP_CHAIN_MAP[chainId]}`, SOLANA_METHOD_TYPES.SIGN_MESSAGE, {\n        message: bs58.encode(Buffer.from(req.params.data, \"utf-8\"))\n      });\n      return methodRes.signature;\n    },\n    signTransaction: async req => {\n      const accounts = await getAccounts(connector);\n      if (accounts.length === 0) {\n        throw providerErrors.disconnected();\n      }\n      const methodRes = await sendJrpcRequest(connector, `solana:${SOLANA_CAIP_CHAIN_MAP[chainId]}`, SOLANA_METHOD_TYPES.SIGN_TRANSACTION, {\n        transaction: req.params.message\n      });\n      return methodRes.signature;\n    }\n  };\n}\nasync function switchChain({\n  connector,\n  chainId,\n  newChainId\n}) {\n  await sendJrpcRequest(connector, `eip155:${chainId}`, \"wallet_switchEthereumChain\", [{\n    chainId: newChainId\n  }]);\n}\n\nexport { getAccounts, getEthProviderHandlers, getSolProviderHandlers, sendJrpcRequest, switchChain };\n", "import _objectSpread from '@babel/runtime/helpers/objectSpread2';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport { getAccountsFromNamespaces, parseAccountId } from '@walletconnect/utils';\nimport { providerErrors, JRPCEngine, providerFromEngine } from '@web3auth/auth';\nimport { switchChain, getAccounts, getEthProviderHandlers, getSolProviderHandlers } from './walletConnectV2Utils.js';\nimport { createEthMiddleware, createEthChainSwitchMiddleware } from '../../providers/ethereum-provider/rpc/ethRpcMiddlewares.js';\nimport { createEthJsonRpcClient } from '../../providers/ethereum-provider/rpc/jrpcClient.js';\nimport { createSolanaMiddleware } from '../../providers/solana-provider/rpc/solanaRpcMiddlewares.js';\nimport { createSolanaJsonRpcClient } from '../../providers/solana-provider/rpc/JrpcClient.js';\nimport { BaseProvider } from '../../providers/base-provider/baseProvider.js';\nimport { CHAIN_NAMESPACES } from '@toruslabs/base-controllers';\nimport { WalletLoginError } from '../../base/errors/index.js';\nimport { log } from '../../base/loglevel.js';\n\nvar _WalletConnectV2Provider;\nclass WalletConnectV2Provider extends BaseProvider {\n  constructor({\n    config,\n    state,\n    connector\n  }) {\n    super({\n      config: {\n        chain: config.chain,\n        chains: config.chains,\n        skipLookupNetwork: !!config.skipLookupNetwork\n      },\n      state: _objectSpread(_objectSpread({}, state || {}), {}, {\n        chainId: \"loading\",\n        accounts: []\n      })\n    });\n    _defineProperty(this, \"connector\", null);\n    this.connector = connector || null;\n  }\n  async enable() {\n    if (!this.connector) throw providerErrors.custom({\n      message: \"Connector is not initialized, pass wallet connect connector in constructor\",\n      code: 4902\n    });\n    await this.setupProvider(this.connector);\n    return this._providerEngineProxy.request({\n      method: \"eth_accounts\"\n    });\n  }\n  async setupProvider(connector) {\n    this.onConnectorStateUpdate(connector);\n    await this.setupEngine(connector, this.config.chain.chainId);\n  }\n  async switchChain({\n    chainId\n  }) {\n    if (!this.connector) throw providerErrors.custom({\n      message: \"Connector is not initialized, pass wallet connect connector in constructor\",\n      code: 4902\n    });\n    const currentChainConfig = this.getChain(chainId);\n    const {\n      chainId: currentChainId\n    } = currentChainConfig;\n    const currentNumChainId = parseInt(currentChainId, 16);\n    await switchChain({\n      connector: this.connector,\n      chainId: currentNumChainId,\n      newChainId: chainId\n    });\n    await this.setupEngine(this.connector, chainId);\n    this.lookupNetwork(this.connector, chainId);\n    this.update({\n      chainId\n    });\n  }\n\n  // no need to implement this method in wallet connect v2.\n  async lookupNetwork(_, chainId) {\n    return chainId;\n  }\n  async setupEngine(connector, chainId) {\n    const chain = this.getChain(chainId);\n    if (chain.chainNamespace === CHAIN_NAMESPACES.EIP155) {\n      await this.setupEthEngine(connector, chainId);\n    } else if (chain.chainNamespace === CHAIN_NAMESPACES.SOLANA) {\n      await this.setupSolEngine(connector, chainId);\n    } else {\n      throw new Error(`Unsupported chainNamespace: ${chain.chainNamespace}`);\n    }\n    this.emit(\"chainChanged\", chainId);\n    this.emit(\"connect\", {\n      chainId\n    });\n    this.update({\n      chainId\n    });\n  }\n  async setupEthEngine(connector, chainId) {\n    const chain = this.getChain(chainId);\n    const numChainId = parseInt(chainId, 16);\n    const providerHandlers = getEthProviderHandlers({\n      connector,\n      chainId: numChainId\n    });\n    const jrpcRes = await getAccounts(connector);\n    this.update({\n      accounts: jrpcRes || []\n    });\n    const ethMiddleware = createEthMiddleware(providerHandlers);\n    const chainSwitchMiddleware = this.getEthChainSwitchMiddleware();\n    const engine = new JRPCEngine();\n    const {\n      networkMiddleware\n    } = createEthJsonRpcClient(chain);\n    engine.push(ethMiddleware);\n    engine.push(chainSwitchMiddleware);\n    engine.push(networkMiddleware);\n    const provider = providerFromEngine(engine);\n    this.updateProviderEngineProxy(provider);\n  }\n  async setupSolEngine(connector, chainId) {\n    const chain = this.getChain(chainId);\n    const providerHandlers = getSolProviderHandlers({\n      connector,\n      chainId\n    });\n    const jrpcRes = await getAccounts(connector);\n    this.update({\n      accounts: jrpcRes || []\n    });\n    const solMiddleware = createSolanaMiddleware(providerHandlers);\n    const engine = new JRPCEngine();\n    const {\n      networkMiddleware\n    } = createSolanaJsonRpcClient(chain);\n    engine.push(solMiddleware);\n    engine.push(networkMiddleware);\n    const provider = providerFromEngine(engine);\n    this.updateProviderEngineProxy(provider);\n  }\n  getEthChainSwitchMiddleware() {\n    const chainSwitchHandlers = {\n      switchChain: async params => {\n        const {\n          chainId\n        } = params;\n        await this.switchChain({\n          chainId\n        });\n      }\n    };\n    const chainSwitchMiddleware = createEthChainSwitchMiddleware(chainSwitchHandlers);\n    return chainSwitchMiddleware;\n  }\n  connectedTopic() {\n    var _this$connector;\n    if (!this.connector) throw WalletLoginError.notConnectedError(\"Wallet connect connector is not connected\");\n    if ((_this$connector = this.connector) !== null && _this$connector !== void 0 && (_this$connector = _this$connector.session) !== null && _this$connector !== void 0 && _this$connector.length) {\n      var _this$connector$sessi;\n      // currently we are supporting only 1 active session\n      const lastKeyIndex = this.connector.session.keys.length - 1;\n      return (_this$connector$sessi = this.connector.session.get(this.connector.session.keys[lastKeyIndex])) === null || _this$connector$sessi === void 0 ? void 0 : _this$connector$sessi.topic;\n    }\n    return undefined;\n  }\n  checkIfAccountAllowed(address) {\n    if (!this.connector || !this.connectedTopic()) return false;\n    const sessionData = this.connector.session.get(this.connectedTopic());\n    const allAccounts = getAccountsFromNamespaces(sessionData.namespaces);\n    let accountAllowed = false;\n    for (const account of allAccounts) {\n      var _parsedAccount$addres;\n      const parsedAccount = parseAccountId(account);\n      if (((_parsedAccount$addres = parsedAccount.address) === null || _parsedAccount$addres === void 0 ? void 0 : _parsedAccount$addres.toLowerCase()) === (address === null || address === void 0 ? void 0 : address.toLowerCase())) {\n        accountAllowed = true;\n        break;\n      }\n    }\n    return accountAllowed;\n  }\n  async onConnectorStateUpdate(connector) {\n    connector.events.on(\"session_event\", async payload => {\n      log.debug(\"session_event data\", payload);\n      if (!this.provider) throw WalletLoginError.notConnectedError(\"Wallet connect connector is not connected\");\n      const {\n        event\n      } = payload.params;\n      const {\n        name,\n        data\n      } = event || {};\n      // Check if accounts changed and trigger event\n      if (name === \"accountsChanged\" && data !== null && data !== void 0 && data.length && this.state.accounts[0] !== data[0] && this.checkIfAccountAllowed(data[0])) {\n        this.update({\n          accounts: data\n        });\n        this.emit(\"accountsChanged\", data);\n      }\n      if (event.name === \"chainChanged\") {\n        if (!data) return;\n        const connectedChainId = data;\n        const connectedHexChainId = `0x${connectedChainId.toString(16)}`;\n\n        // Check if chainId changed and trigger event\n        const {\n          currentChain\n        } = this;\n        if (connectedHexChainId && currentChain.chainId !== connectedHexChainId) {\n          // Handle rpcUrl update\n          await this.setupEngine(connector, connectedHexChainId);\n        }\n      }\n    });\n  }\n}\n_WalletConnectV2Provider = WalletConnectV2Provider;\n_defineProperty(WalletConnectV2Provider, \"getProviderInstance\", async params => {\n  const providerFactory = new _WalletConnectV2Provider({\n    config: {\n      chain: params.chain,\n      chains: params.chains,\n      skipLookupNetwork: params.skipLookupNetwork\n    }\n  });\n  await providerFactory.setupProvider(params.connector);\n  return providerFactory;\n});\n\nexport { WalletConnectV2Provider };\n", "import _objectSpread from '@babel/runtime/helpers/objectSpread2';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport { CHAIN_NAMESPACES, getErrorAnalyticsProperties, signChallenge, verifySignedChallenge } from '@toruslabs/base-controllers';\nimport Client from '@walletconnect/sign-client';\nimport { isValidArray, getSdkError } from '@walletconnect/utils';\nimport { EVM_METHOD_TYPES, SOLANA_METHOD_TYPES } from '@web3auth/ws-embed';\nimport deepmerge from 'deepmerge';\nimport { getWalletConnectV2Settings } from './config.js';\nimport { WalletConnectV2Provider } from './WalletConnectV2Provider.js';\nimport { BaseConnector } from '../../base/connector/baseConnector.js';\nimport { WALLET_CONNECTORS } from '../../base/wallet/index.js';\nimport { CONNECTOR_NAMESPACES } from '../../base/chain/IChainInterface.js';\nimport { CONNECTOR_CATEGORY, CONNECTOR_STATUS, CONNECTOR_EVENTS } from '../../base/connector/constants.js';\nimport { WalletInitializationError, WalletLoginError, Web3AuthError } from '../../base/errors/index.js';\nimport { log } from '../../base/loglevel.js';\nimport { getCaipChainId } from '../../base/utils.js';\nimport { ANALYTICS_EVENTS } from '../../base/analytics.js';\nimport { getSavedToken, checkIfTokenIsExpired, saveToken } from '../../base/connector/utils.js';\n\nclass WalletConnectV2Connector extends BaseConnector {\n  constructor(options) {\n    var _this$connectorOption, _this$connectorOption2, _this$connectorOption3, _this$connectorOption4, _this$connectorOption5;\n    super(options);\n    _defineProperty(this, \"name\", WALLET_CONNECTORS.WALLET_CONNECT_V2);\n    _defineProperty(this, \"connectorNamespace\", CONNECTOR_NAMESPACES.MULTICHAIN);\n    _defineProperty(this, \"currentChainNamespace\", CHAIN_NAMESPACES.OTHER);\n    _defineProperty(this, \"type\", CONNECTOR_CATEGORY.EXTERNAL);\n    _defineProperty(this, \"connectorOptions\", void 0);\n    _defineProperty(this, \"status\", CONNECTOR_STATUS.NOT_READY);\n    _defineProperty(this, \"connectorData\", {\n      uri: \"\"\n    });\n    _defineProperty(this, \"connector\", null);\n    _defineProperty(this, \"activeSession\", null);\n    _defineProperty(this, \"wcProvider\", null);\n    _defineProperty(this, \"analytics\", void 0);\n    this.connectorOptions = _objectSpread({}, options);\n    const {\n      qrcodeModal,\n      walletConnectInitOptions\n    } = (options === null || options === void 0 ? void 0 : options.connectorSettings) || {};\n    this.connectorOptions = _objectSpread(_objectSpread({}, this.connectorOptions), {}, {\n      connectorSettings: (_this$connectorOption = (_this$connectorOption2 = this.connectorOptions) === null || _this$connectorOption2 === void 0 ? void 0 : _this$connectorOption2.connectorSettings) !== null && _this$connectorOption !== void 0 ? _this$connectorOption : {},\n      loginSettings: (_this$connectorOption3 = (_this$connectorOption4 = this.connectorOptions) === null || _this$connectorOption4 === void 0 ? void 0 : _this$connectorOption4.loginSettings) !== null && _this$connectorOption3 !== void 0 ? _this$connectorOption3 : {}\n    });\n    this.analytics = options.analytics;\n    if (qrcodeModal) this.connectorOptions.connectorSettings.qrcodeModal = qrcodeModal;\n    if (walletConnectInitOptions) this.connectorOptions.connectorSettings.walletConnectInitOptions = _objectSpread(_objectSpread({}, (_this$connectorOption5 = this.connectorOptions.connectorSettings.walletConnectInitOptions) !== null && _this$connectorOption5 !== void 0 ? _this$connectorOption5 : {}), walletConnectInitOptions);\n    const {\n      loginSettings\n    } = options;\n    if (loginSettings) this.connectorOptions.loginSettings = _objectSpread(_objectSpread({}, this.connectorOptions.loginSettings || {}), loginSettings);\n  }\n  get connected() {\n    return !!this.activeSession;\n  }\n  get provider() {\n    if (this.status !== CONNECTOR_STATUS.NOT_READY && this.wcProvider) {\n      return this.wcProvider;\n    }\n    return null;\n  }\n  set provider(_) {\n    throw new Error(\"Not implemented\");\n  }\n  async init(options) {\n    var _this$connectorOption6;\n    const chainConfig = this.coreOptions.chains.find(x => x.chainId === options.chainId);\n    super.checkInitializationRequirements({\n      chainConfig\n    });\n    const projectId = (_this$connectorOption6 = this.connectorOptions.connectorSettings) === null || _this$connectorOption6 === void 0 || (_this$connectorOption6 = _this$connectorOption6.walletConnectInitOptions) === null || _this$connectorOption6 === void 0 ? void 0 : _this$connectorOption6.projectId;\n    const filteredChains = this.coreOptions.chains.filter(x => x.chainNamespace === CHAIN_NAMESPACES.EIP155 || x.chainNamespace === CHAIN_NAMESPACES.SOLANA);\n    if (filteredChains.length === 0) {\n      throw WalletInitializationError.invalidParams(\"No supported chains found\");\n    }\n    const wc2Settings = await getWalletConnectV2Settings(filteredChains, projectId);\n    if (!this.connectorOptions.loginSettings || Object.keys(this.connectorOptions.loginSettings).length === 0) {\n      this.connectorOptions.loginSettings = wc2Settings.loginSettings;\n    }\n    this.connectorOptions.connectorSettings = deepmerge(wc2Settings.connectorSettings || {}, this.connectorOptions.connectorSettings || {});\n    const {\n      connectorSettings\n    } = this.connectorOptions;\n    this.connector = await Client.init(connectorSettings === null || connectorSettings === void 0 ? void 0 : connectorSettings.walletConnectInitOptions);\n    this.wcProvider = new WalletConnectV2Provider({\n      config: {\n        chain: chainConfig,\n        chains: this.coreOptions.chains\n      },\n      connector: this.connector\n    });\n    this.emit(CONNECTOR_EVENTS.READY, WALLET_CONNECTORS.WALLET_CONNECT_V2);\n    this.status = CONNECTOR_STATUS.READY;\n    log.debug(\"initializing wallet connect v2 connector\");\n    if (options.autoConnect) {\n      await this.checkForPersistedSession();\n      if (this.connected) {\n        this.rehydrated = true;\n        try {\n          await this.onConnectHandler({\n            chain: chainConfig\n          });\n        } catch (error) {\n          log.error(\"wallet auto connect\", error);\n          this.emit(CONNECTOR_EVENTS.REHYDRATION_ERROR, error);\n        }\n      } else {\n        this.status = CONNECTOR_STATUS.NOT_READY;\n        this.emit(CONNECTOR_EVENTS.CACHE_CLEAR);\n      }\n    }\n  }\n  async connect({\n    chainId\n  }) {\n    super.checkConnectionRequirements();\n    const chainConfig = this.coreOptions.chains.find(x => x.chainId === chainId);\n    if (!chainConfig) throw WalletLoginError.connectionError(\"Chain config is not available\");\n    if (!this.connector) throw WalletInitializationError.notReady(\"Wallet connector is not ready yet\");\n\n    // Skip tracking for rehydration since only new connections are tracked\n    // Track when connection completes since it auto-initializes to generate QR code\n    const shouldTrack = !this.connected && !this.rehydrated;\n    const startTime = Date.now();\n    let eventData = {\n      connector: this.name,\n      connector_type: this.type,\n      is_injected: this.isInjected,\n      is_wallet_connect: true,\n      chain_id: getCaipChainId(chainConfig),\n      chain_name: chainConfig === null || chainConfig === void 0 ? void 0 : chainConfig.displayName,\n      chain_namespace: chainConfig === null || chainConfig === void 0 ? void 0 : chainConfig.chainNamespace\n    };\n    try {\n      const trackCompletionEvents = () => {\n        // track connection events\n        if (shouldTrack) {\n          var _this$activeSession, _this$analytics, _this$analytics2;\n          const {\n            name,\n            url,\n            redirect\n          } = ((_this$activeSession = this.activeSession) === null || _this$activeSession === void 0 || (_this$activeSession = _this$activeSession.peer) === null || _this$activeSession === void 0 ? void 0 : _this$activeSession.metadata) || {};\n          const {\n            native,\n            universal,\n            linkMode\n          } = redirect || {};\n          eventData = _objectSpread(_objectSpread({}, eventData), {}, {\n            connector: name || this.name,\n            wallet_url: url,\n            redirect_native: native,\n            redirect_universal: universal,\n            redirect_link_mode_enabled: linkMode\n          });\n          (_this$analytics = this.analytics) === null || _this$analytics === void 0 || _this$analytics.track(ANALYTICS_EVENTS.CONNECTION_STARTED, eventData);\n          (_this$analytics2 = this.analytics) === null || _this$analytics2 === void 0 || _this$analytics2.track(ANALYTICS_EVENTS.CONNECTION_COMPLETED, _objectSpread(_objectSpread({}, eventData), {}, {\n            duration: Date.now() - startTime\n          }));\n        }\n      };\n\n      // if already connected\n      if (this.connected) {\n        await this.onConnectHandler({\n          chain: chainConfig\n        });\n        return this.provider;\n      }\n      if (this.status !== CONNECTOR_STATUS.CONNECTING) {\n        await this.createNewSession({\n          chainConfig,\n          trackCompletionEvents\n        });\n      }\n      return this.provider;\n    } catch (error) {\n      log.error(\"Wallet connect v2 connector error while connecting\", error);\n      // ready again to be connected\n      this.status = CONNECTOR_STATUS.READY;\n      this.rehydrated = true;\n      this.emit(CONNECTOR_EVENTS.ERRORED, error);\n\n      // track connection events\n      if (shouldTrack) {\n        var _this$analytics3, _this$analytics4;\n        (_this$analytics3 = this.analytics) === null || _this$analytics3 === void 0 || _this$analytics3.track(ANALYTICS_EVENTS.CONNECTION_STARTED, eventData);\n        (_this$analytics4 = this.analytics) === null || _this$analytics4 === void 0 || _this$analytics4.track(ANALYTICS_EVENTS.CONNECTION_FAILED, _objectSpread(_objectSpread(_objectSpread({}, eventData), getErrorAnalyticsProperties(error)), {}, {\n          duration: Date.now() - startTime\n        }));\n      }\n      const finalError = error instanceof Web3AuthError ? error : WalletLoginError.connectionError(`Failed to login with wallet connect: ${(error === null || error === void 0 ? void 0 : error.message) || \"\"}`, error);\n      throw finalError;\n    }\n  }\n  async switchChain(params, init = false) {\n    super.checkSwitchChainRequirements(params, init);\n    if (!this.wcProvider) throw WalletInitializationError.notReady(\"Wallet Connect provider is not ready yet\");\n    try {\n      await this.wcProvider.switchChain({\n        chainId: params.chainId\n      });\n    } catch (error) {\n      log.error(\"error while switching chain\", error);\n      throw error;\n    }\n  }\n  async getUserInfo() {\n    if (!this.connected) throw WalletLoginError.notConnectedError(\"Not connected with wallet, Please login/connect first\");\n    return {};\n  }\n  async disconnect(options = {\n    cleanup: false,\n    sessionRemovedByWallet: false\n  }) {\n    var _this$activeSession2, _this$activeSession3;\n    const {\n      cleanup\n    } = options;\n    if (!this.connector || !this.connected || !((_this$activeSession2 = this.activeSession) !== null && _this$activeSession2 !== void 0 && _this$activeSession2.topic)) throw WalletLoginError.notConnectedError(\"Not connected with wallet\");\n    if (!options.sessionRemovedByWallet) await this.connector.disconnect({\n      topic: (_this$activeSession3 = this.activeSession) === null || _this$activeSession3 === void 0 ? void 0 : _this$activeSession3.topic,\n      reason: getSdkError(\"USER_DISCONNECTED\")\n    });\n    this.rehydrated = false;\n    if (cleanup) {\n      this.connector = null;\n      this.status = CONNECTOR_STATUS.NOT_READY;\n      this.wcProvider = null;\n    } else {\n      // ready to connect again\n      this.status = CONNECTOR_STATUS.READY;\n    }\n    this.activeSession = null;\n    this.emit(CONNECTOR_EVENTS.DISCONNECTED);\n  }\n  async getIdentityToken() {\n    if (!this.provider || this.status !== CONNECTOR_STATUS.CONNECTED) throw WalletLoginError.notConnectedError();\n    const {\n      chainId\n    } = this.provider;\n    const currentChainConfig = this.coreOptions.chains.find(x => x.chainId === chainId);\n    if (!currentChainConfig) throw WalletLoginError.connectionError(\"Chain config is not available\");\n    const {\n      chainNamespace\n    } = currentChainConfig;\n    const accounts = await this.provider.request({\n      method: chainNamespace === CHAIN_NAMESPACES.EIP155 ? EVM_METHOD_TYPES.GET_ACCOUNTS : SOLANA_METHOD_TYPES.GET_ACCOUNTS\n    });\n    if (accounts && accounts.length > 0) {\n      const existingToken = getSavedToken(accounts[0], this.name);\n      if (existingToken) {\n        const isExpired = checkIfTokenIsExpired(existingToken);\n        if (!isExpired) {\n          return {\n            idToken: existingToken\n          };\n        }\n      }\n      const payload = {\n        domain: window.location.origin,\n        uri: window.location.href,\n        address: accounts[0],\n        chainId: parseInt(chainId, 16),\n        version: \"1\",\n        nonce: Math.random().toString(36).slice(2),\n        issuedAt: new Date().toISOString()\n      };\n      const challenge = await signChallenge(payload, chainNamespace);\n      const signedMessage = await this._getSignedMessage(challenge, accounts, chainNamespace);\n      const idToken = await verifySignedChallenge(chainNamespace, signedMessage, challenge, this.name, this.coreOptions.sessionTime, this.coreOptions.clientId, this.coreOptions.web3AuthNetwork);\n      saveToken(accounts[0], this.name, idToken);\n      return {\n        idToken\n      };\n    }\n    throw WalletLoginError.notConnectedError(\"Not connected with wallet, Please login/connect first\");\n  }\n  async enableMFA() {\n    throw new Error(\"Method Not implemented\");\n  }\n  async manageMFA() {\n    throw new Error(\"Method Not implemented\");\n  }\n  cleanupPendingPairings() {\n    if (!this.connector) throw WalletInitializationError.notReady(\"Wallet connector is not ready yet\");\n    const inactivePairings = this.connector.pairing.getAll({\n      active: false\n    });\n    if (!isValidArray(inactivePairings)) return;\n    inactivePairings.forEach(pairing => {\n      if (this.connector) {\n        this.connector.pairing.delete(pairing.topic, getSdkError(\"USER_DISCONNECTED\"));\n      }\n    });\n  }\n  async checkForPersistedSession() {\n    if (!this.connector) throw WalletInitializationError.notReady(\"Wallet connector is not ready yet\");\n    if (this.connector.session.length) {\n      const lastKeyIndex = this.connector.session.keys.length - 1;\n      this.activeSession = this.connector.session.get(this.connector.session.keys[lastKeyIndex]);\n    }\n    return this.activeSession;\n  }\n  async createNewSession({\n    forceNewSession = false,\n    chainConfig,\n    trackCompletionEvents\n  }) {\n    try {\n      var _this$activeSession4, _this$connectorOption7;\n      if (!this.connector) throw WalletInitializationError.notReady(\"Wallet connector is not ready yet\");\n      if (!this.connectorOptions.loginSettings || Object.keys(this.connectorOptions.loginSettings).length === 0) throw WalletInitializationError.notReady(\"login settings are not set yet\");\n      this.status = CONNECTOR_STATUS.CONNECTING;\n      this.emit(CONNECTOR_EVENTS.CONNECTING, {\n        connector: WALLET_CONNECTORS.WALLET_CONNECT_V2\n      });\n      if (forceNewSession && (_this$activeSession4 = this.activeSession) !== null && _this$activeSession4 !== void 0 && _this$activeSession4.topic) {\n        var _this$activeSession5;\n        await this.connector.disconnect({\n          topic: (_this$activeSession5 = this.activeSession) === null || _this$activeSession5 === void 0 ? void 0 : _this$activeSession5.topic,\n          reason: getSdkError(\"USER_DISCONNECTED\")\n        });\n      }\n      const {\n        uri,\n        approval\n      } = await this.connector.connect(this.connectorOptions.loginSettings);\n      const qrcodeModal = (_this$connectorOption7 = this.connectorOptions) === null || _this$connectorOption7 === void 0 || (_this$connectorOption7 = _this$connectorOption7.connectorSettings) === null || _this$connectorOption7 === void 0 ? void 0 : _this$connectorOption7.qrcodeModal;\n      // Open QRCode modal if a URI was returned (i.e. we're not connecting with an existing pairing).\n      if (uri) {\n        if (qrcodeModal) {\n          try {\n            await qrcodeModal.openModal({\n              uri\n            });\n            log.debug(\"EVENT\", \"QR Code Modal closed\");\n            this.status = CONNECTOR_STATUS.READY;\n            this.emit(CONNECTOR_EVENTS.READY, WALLET_CONNECTORS.WALLET_CONNECT_V2);\n          } catch (error) {\n            log.error(\"unable to open qr code modal\", error);\n          }\n        } else {\n          this.updateConnectorData({\n            uri\n          });\n        }\n      }\n      log.info(\"awaiting session approval from wallet\");\n\n      // Await session approval from the wallet.\n      const session = await approval();\n      this.activeSession = session;\n      // Handle the returned session (e.g. update UI to \"connected\" state).\n      await this.onConnectHandler({\n        chain: chainConfig,\n        trackCompletionEvents\n      });\n      if (qrcodeModal) {\n        qrcodeModal.closeModal();\n      }\n    } catch (error) {\n      var _message;\n      if ((_message = error.message) !== null && _message !== void 0 && _message.toLowerCase().includes(\"proposal expired\")) {\n        // Retry if connector status is still connecting\n        log.info(\"current connector status: \", this.status);\n        if (this.status === CONNECTOR_STATUS.CONNECTING) {\n          log.info(\"retrying to create new wallet connect session since proposal expired\");\n          return this.createNewSession({\n            forceNewSession: true,\n            chainConfig\n          });\n        }\n        if (this.status === CONNECTOR_STATUS.READY) {\n          log.info(\"ignoring proposal expired error since some other connector is connected\");\n          return;\n        }\n      }\n      log.error(\"error while creating new wallet connect session\", error);\n      this.emit(CONNECTOR_EVENTS.ERRORED, error);\n      throw error;\n    }\n  }\n  async onConnectHandler({\n    chain,\n    trackCompletionEvents\n  }) {\n    var _this$connectorOption8;\n    if (!this.connector || !this.wcProvider) throw WalletInitializationError.notReady(\"Wallet connect connector is not ready yet\");\n    this.subscribeEvents();\n    if ((_this$connectorOption8 = this.connectorOptions.connectorSettings) !== null && _this$connectorOption8 !== void 0 && _this$connectorOption8.qrcodeModal) {\n      this.wcProvider = new WalletConnectV2Provider({\n        config: {\n          chain,\n          chains: this.coreOptions.chains,\n          skipLookupNetwork: true\n        },\n        connector: this.connector\n      });\n    }\n    await this.wcProvider.setupProvider(this.connector);\n    this.cleanupPendingPairings();\n    this.status = CONNECTOR_STATUS.CONNECTED;\n\n    // track connection events\n    if (trackCompletionEvents) trackCompletionEvents();\n    this.emit(CONNECTOR_EVENTS.CONNECTED, {\n      connector: WALLET_CONNECTORS.WALLET_CONNECT_V2,\n      reconnected: this.rehydrated,\n      provider: this.provider\n    });\n  }\n  subscribeEvents() {\n    if (!this.connector) throw WalletInitializationError.notReady(\"Wallet connector is not ready yet\");\n    this.connector.events.on(\"session_update\", ({\n      topic,\n      params\n    }) => {\n      if (!this.connector) return;\n      const {\n        namespaces\n      } = params;\n      const _session = this.connector.session.get(topic);\n      // Overwrite the `namespaces` of the existing session with the incoming one.\n      const updatedSession = _objectSpread(_objectSpread({}, _session), {}, {\n        namespaces\n      });\n      // Integrate the updated session state into your dapp state.\n      this.activeSession = updatedSession;\n    });\n    this.connector.events.on(\"session_delete\", () => {\n      // Session was deleted -> reset the dapp state, clean up from user session, etc.\n      this.disconnect({\n        sessionRemovedByWallet: true\n      });\n    });\n  }\n  async _getSignedMessage(challenge, accounts, chainNamespace) {\n    const signedMessage = await this.provider.request({\n      method: chainNamespace === CHAIN_NAMESPACES.EIP155 ? EVM_METHOD_TYPES.PERSONAL_SIGN : SOLANA_METHOD_TYPES.SIGN_MESSAGE,\n      params: chainNamespace === CHAIN_NAMESPACES.EIP155 ? [challenge, accounts[0]] : {\n        data: challenge\n      }\n    });\n    return signedMessage;\n  }\n}\nconst walletConnectV2Connector = params => {\n  return ({\n    coreOptions,\n    projectConfig,\n    analytics\n  }) => {\n    var _params$walletConnect;\n    const projectId = (params === null || params === void 0 || (_params$walletConnect = params.walletConnectInitOptions) === null || _params$walletConnect === void 0 ? void 0 : _params$walletConnect.projectId) || (projectConfig === null || projectConfig === void 0 ? void 0 : projectConfig.walletConnectProjectId);\n    const connectorSettings = _objectSpread(_objectSpread({}, params), {}, {\n      walletConnectInitOptions: _objectSpread(_objectSpread({}, params === null || params === void 0 ? void 0 : params.walletConnectInitOptions), {}, {\n        projectId: projectId\n      })\n    });\n    return new WalletConnectV2Connector({\n      connectorSettings,\n      coreOptions,\n      analytics\n    });\n  };\n};\n\nexport { walletConnectV2Connector };\n"],
  "mappings": "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ACA;AAAA,IACF,CAAC;AAED,QAAM,QAAQ,IAAI,WAAW;AAAA,MAC3B;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,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;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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",
  "names": ["n", "i", "N", "M", "ms", "v", "a", "b", "i", "c", "d", "m", "x", "v", "i", "a", "b", "c", "d", "x", "y", "m", "_a", "_i", "_b", "_c", "to", "isPlainObject", "k", "_e", "c", "keys", "_a", "EventFactory", "_a", "to", "EventQueue", "_i", "_a", "i", "set", "get", "converter", "levels", "i", "_a", "_", "CookieStorage", "_a", "LocalStorage", "_a", "MemoryStorage", "_a", "UniversalStorage", "_i", "_a", "cookieOptions", "User", "cookieOptions", "_a", "_b", "_c", "Group", "c", "_a", "_i", "_b", "m", "PreInitMethodCall", "PreInitMethodCallBuffer", "_i", "_a", "wa", "_a", "AnalyticsBuffered", "_i", "RateLimitError", "batch", "_a", "_b", "fetch", "attempt", "scheduleFlush", "dispatch", "dispatch", "fetch", "_a", "_i", "_b", "_a", "xt", "_a", "scheduleFlush", "_c", "_b", "_a", "segmentio", "global", "AnalyticsInstanceSettings", "_a", "_b", "Analytics", "cookieOptions", "_a", "_b", "_i", "to", "xt", "p", "fn", "plugin", "i", "an", "NullAnalytics", "_i", "_a", "k", "v", "_b", "ampId", "EnvironmentEnrichmentPlugin", "_", "ActionDestination", "fn", "_i", "_a", "_b", "_c", "_a", "_b", "_c", "plugin", "_a", "fetch", "_c", "_b", "_a", "_e", "_f", "AnalyticsBrowser", "AnalyticsNode", "Analytics", "window", "document", "DEFAULT_EIP155_METHODS", "DEFAULT_SOLANA_METHODS", "DEFAULT_EIP_155_EVENTS", "DEFAULT_SOLANA_EVENTS", "getAccounts", "getAccounts", "switchChain", "encode", "decode", "i", "keys", "size", "i", "j", "_a", "encode", "decode", "string", "i", "string", "_", "_", "_", "x", "deepmerge", "fe", "init"]
}
